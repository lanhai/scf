(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61f74440"],{"28a5":function(t,e,s){"use strict";var n=s("aae3"),i=s("cb7c"),a=s("ebd6"),l=s("0390"),o=s("9def"),r=s("5f1b"),c=s("520a"),p=s("79e5"),u=Math.min,d=[].push,g="split",m="length",v="lastIndex",f=4294967295,_=!p((function(){RegExp(f,"y")}));s("214f")("split",2,(function(t,e,s,p){var h;return h="c"=="abbc"[g](/(b)*/)[1]||4!="test"[g](/(?:)/,-1)[m]||2!="ab"[g](/(?:ab)*/)[m]||4!="."[g](/(.?)(.?)/)[m]||"."[g](/()()/)[m]>1||""[g](/.?/)[m]?function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!n(t))return s.call(i,t,e);var a,l,o,r=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,g=void 0===e?f:e>>>0,_=new RegExp(t.source,p+"g");while(a=c.call(_,i)){if(l=_[v],l>u&&(r.push(i.slice(u,a.index)),a[m]>1&&a.index<i[m]&&d.apply(r,a.slice(1)),o=a[0][m],u=l,r[m]>=g))break;_[v]===a.index&&_[v]++}return u===i[m]?!o&&_.test("")||r.push(""):r.push(i.slice(u)),r[m]>g?r.slice(0,g):r}:"0"[g](void 0,0)[m]?function(t,e){return void 0===t&&0===e?[]:s.call(this,t,e)}:s,[function(s,n){var i=t(this),a=void 0==s?void 0:s[e];return void 0!==a?a.call(s,i,n):h.call(String(i),s,n)},function(t,e){var n=p(h,t,this,e,h!==s);if(n.done)return n.value;var c=i(t),d=String(this),g=a(c,RegExp),m=c.unicode,v=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(_?"y":"g"),b=new g(_?c:"^(?:"+c.source+")",v),y=void 0===e?f:e>>>0;if(0===y)return[];if(0===d.length)return null===r(b,d)?[d]:[];var k=0,w=0,S=[];while(w<d.length){b.lastIndex=_?w:0;var C,x=r(b,_?d:d.slice(w));if(null===x||(C=u(o(b.lastIndex+(_?0:w)),d.length))===k)w=l(d,w,m);else{if(S.push(d.slice(k,w)),S.length===y)return S;for(var L=1;L<=x.length-1;L++)if(S.push(x[L]),S.length===y)return S;w=k=C}}return S.push(d.slice(k)),S}]}))},9186:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-descriptions",{staticClass:"margin-top",attrs:{direction:"vertical",title:"守护进程",column:15,border:""}},[s("template",{slot:"title"},[s("h4",[t._v("【应用信息】App Info")])]),s("template",{slot:"extra"},[0===t.connectStatus.status?s("el-button",{attrs:{type:"primary",size:"mini",loading:!t.socektUrl||t.isLoading},on:{click:function(e){return t.initWebSocket()}}},[t.socektUrl&&!t.isLoading?s("i",{staticClass:"el-icon-link el-icon--left"}):t._e(),t._v("连接\n            ")]):t._e(),1===t.connectStatus.status?s("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[s("span",{staticClass:"el-dropdown-link cursor-pointer"},[s("el-tag",{attrs:{type:1===t.connectStatus.status?"success":"danger"}},[t._v(t._s(1===t.connectStatus.status?"已连接":"未连接")+"\n                    "),1===t.connectStatus.status?s("i",{class:{"el-icon-arrow-down":!t.isRestartting,"el-icon-loading":t.isRestartting}}):t._e()])],1),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"refreshServer",divided:"",disabled:0===t.connectStatus.status}},[s("i",{staticClass:"el-icon-refresh"}),t._v("刷新\n                    ")]),s("el-dropdown-item",{attrs:{command:"restartServer",disabled:0===t.connectStatus.status}},[s("i",{class:{"el-icon-refresh-right":1!==t.running,"el-icon-video-play":0===t.running}}),t._v("重启\n                    ")])],1)],1):t._e()],1),1===t.connectStatus.status?[s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-time"}),t._v("\n                    APPID\n                ")]),t._v("\n                "+t._s(t.info.appid||"--")+"\n            ")],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-folder-opened"}),t._v("\n                    应用路径\n                ")]),s("span",[t._v(t._s(t.info.app_path||"--"))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-document"}),t._v("\n                    内核版本\n                ")]),s("span",{staticClass:"cursor-pointer c-blue",on:{click:function(e){return t.displayVersions("app")}}},[t._v(" "+t._s(t.latestVersion.app||"--"))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-files"}),t._v("\n                    资源版本\n                ")]),s("span",{staticClass:"cursor-pointer c-blue",on:{click:function(e){return t.displayVersions("public")}}},[t._v("  "+t._s(t.latestVersion.public||"--"))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-date"}),t._v("\n                    更新时间\n                ")]),s("span",[t._v(t._s(t.info.updated||"--"))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-date"}),t._v("\n                    框架源码\n                    "),t.framework.is_phar&&t.framework.version!==t.framework.latest_version?s("el-tooltip",{attrs:{content:"最新版本 "+t.framework.latest_version+" @ "+t.framework.latest_build,placement:"top"}},[s("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-refresh"},on:{click:t.upgradeFramework}})],1):t._e()],1),s("span",[s("el-tag",{attrs:{type:t.framework.version===t.framework.latest_version?"success":"warning"}},[t._v(t._s(t.framework.version))])],1)],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-share"}),t._v("\n                    子节点\n                    "),s("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-plus"},on:{click:t.addNode}})],1),t._v("\n                "+t._s(t.info.slave||0)+"\n\n            ")],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-document"}),t._v("\n                    运行日志\n                    "),s("i",{staticClass:"el-icon-more cursor-pointer fs-14 fr",on:{click:function(e){return t.showLogs("info")}}})]),s("span",{staticClass:"fs-36 cursor-pointer",on:{click:function(e){return t.showLogs("info")}}},[t._v(t._s(t.logs.info.total))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-warning-outline",class:{"c-orange":t.logs.slow.total>0}}),t._v("\n                    慢日志\n                    "),s("i",{staticClass:"el-icon-more cursor-pointer fs-14 fr",on:{click:function(e){return t.showLogs("slow")}}})]),s("span",{staticClass:"fs-36 cursor-pointer",on:{click:function(e){return t.showLogs("slow")}}},[t._v(t._s(t.logs.slow.total))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-warning-outline",class:{"c-red":t.logs.error.total>0}}),t._v("\n                    错误日志\n                    "),s("i",{staticClass:"el-icon-more cursor-pointer fs-14 fr",on:{click:function(e){return t.showLogs("error")}}})]),s("span",{staticClass:"fs-36 cursor-pointer",on:{click:function(e){return t.showLogs("error")}}},[t._v(t._s(t.logs.error.total))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-monitor"}),t._v("\n                    控制台消息\n                    "),s("i",{staticClass:"el-icon-more cursor-pointer fs-14 fr",on:{click:function(e){t.consoleDisplay=!0}}})]),s("span",{staticClass:"fs-36 cursor-pointer",on:{click:function(e){t.consoleDisplay=!0}}},[t._v(t._s(t.consoleLogs.length))])],2)]:t._e()],2),s("el-divider"),1===t.connectStatus.status?t._l(t.servers,(function(e,n){return s("div",{key:n},[s("el-descriptions",{staticClass:"margin-top",attrs:{title:"【"+e.name+"】"+e.script,column:11,border:"",labelStyle:{"max-width":"100px"}}},[s("template",{slot:"title"},[s("h4",[t._v(t._s("【"+e.id+"@"+e.ip+":"+e.port+"】"))])]),s("template",{slot:"extra"},[s("span",[s("el-tag",{attrs:{type:t.isWaitting||t.isRestartting?"info":e.online?"success":"danger"}},[t._v(t._s(t.isWaitting||t.isRestartting?"等待中":e.online?"在线":"离线")+"\n                        ")])],1)]),[s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-star-off"}),t._v("\n                            节点角色\n                        ")]),t._v("\n                        "+t._s(e.role)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-connection"}),t._v("\n                            IP地址\n                        ")]),t._v("\n                        "+t._s(e.ip+":"+e.port)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-s-unfold"},[t._v(" 运行模式")])]),t._v("\n                        "+t._s(e.server_run_mode)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-receiving"},[t._v(" swoole版本")])]),t._v("\n                        "+t._s(e.swoole_version)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-receiving"},[t._v(" 框架版本")])]),t._v("\n                        "+t._s(e.scf_version)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-receiving"},[t._v(" 框架源码")])]),s("el-tag",{attrs:{type:e.framework_build_version===t.framework.latest_version?"success":"warning"}},[t._v(" "+t._s(e.framework_build_version))]),e.framework_update_ready&&t.framework.is_phar?s("el-tag",{staticStyle:{"margin-left":"5px"},attrs:{type:"success"}},[t._v("升级就绪")]):t._e()],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-files"}),t._v("\n                            内核版本\n                        ")]),s("el-tooltip",{attrs:{content:"updated at "+e.app_version+" from "+e.app_version+",comment:"+e.app_version,placement:"top"}},[s("el-tag",{attrs:{type:e.app_version===t.latestVersion.app?"success":"warning"}},[t._v(" "+t._s(e.app_version))]),t._v("\n                            >\n                        ")],1)],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-document"}),t._v("\n                            资源版本\n                        ")]),s("el-tooltip",{attrs:{content:"updated at "+e.public_version+" from "+e.public_version+",comment:"+e.public_version,placement:"top"}},[s("el-tag",{attrs:{type:e.public_version===t.latestVersion.public?"success":"warning"}},[t._v(t._s(e.public_version))])],1)],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-s-unfold"}),t._v("\n                            MID\n                        ")]),t._v("\n                        "+t._s(e.manager_pid)+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-aim"}),t._v("\n                            PID\n                        ")]),t._v("\n                        "+t._s(e.master_pid||"--")+"\n                    ")],2),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-refresh"}),t._v("\n                            重启次数\n                        ")]),s("span",[t._v(t._s(e.restart_times))])],2)]],2),null!==e.server_stats?s("el-descriptions",{staticClass:"mt-20",attrs:{title:"",column:20,direction:"vertical",border:"",colon:!1}},[s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-time"}),t._v("\n                        运行时间\n                    ")]),e.online?s("span",[t._v(t._s(t._f("secondToHour")(Math.floor((new Date).getTime()-1e3*e.started)/1e3)))]):s("span",[t._v("--")])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-s-custom"}),t._v("\n                        连接数量\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.server_stats.connection_num||0))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-share"}),t._v("\n                        并发请求\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.http_request_count_current))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-loading"}),t._v("\n                        等待响应\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.http_request_processing))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-coin"}),t._v("\n                        Mysql并发\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.mysql_execute_count))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-s-unfold"}),t._v("\n                        今日请求\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.http_request_count_today))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-scissors"}),t._v("\n                        拒绝请求\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.http_request_reject))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        Task数量\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.server_stats.tasking_num||0))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-user"}),t._v("\n                        空闲Worker\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.server_stats.idle_worker_num||0))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        CPU核数\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.cpu_num))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        内存表\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.tables.length))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        协程数量\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.threads))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        事件数量\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.thread_status.event_num))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-cpu"}),t._v("\n                        IO线程数\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(t._s(e.thread_status.aio_worker_num))])],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-film"}),t._v("\n                        协程C栈\n                    ")]),s("span",{staticClass:"fs-36"},[t._v(" "+t._s((e.thread_status.c_stack_size/1024/1024).toFixed(0)))]),t._v("M\n                    ")],2),s("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-tickets"}),t._v("\n                        定时任务\n                        "),s("i",{staticClass:"el-icon-more cursor-pointer fs-14 fr",on:{click:function(e){return t.showTasks()}}})]),s("span",{staticClass:"fs-36 cursor-pointer",on:{click:function(e){return t.showTasks()}}},[t._v(t._s(e.tasks.length))])],2)],1):t._e(),n!==t.servers.length-1?s("el-divider"):t._e()],1)})):t._e(),s("el-drawer",{attrs:{title:t.logParams.type,visible:t.logDialogDisplay,direction:t.direction,size:"80%","show-close":!0},on:{"update:visible":function(e){t.logDialogDisplay=e}}},[s("div",{staticStyle:{"padding-left":"10px"},attrs:{slot:"title"},slot:"title"},[s("span",[t._v("["+t._s(t.logParams.type)+"]累计"+t._s(t.logParams.count)+"条日志"),s("i",{staticClass:"el-icon-refresh cursor-pointer",on:{click:function(e){return t.getLogs()}}})]),s("el-date-picker",{staticClass:"fr",attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",editable:!1,clearable:!1,placeholder:"选择日期"},on:{change:function(e){return t.getLogs()}},model:{value:t.logParams.day,callback:function(e){t.$set(t.logParams,"day",e)},expression:"logParams.day"}})],1),s("div",{staticClass:"block pd-20"},[t.logList.length?t._e():s("span",[t._v("暂无日志")]),t.logList.length?s("el-timeline",t._l(t.logList,(function(e,n){return s("el-timeline-item",{key:n,attrs:{placement:"top",timestamp:e.date}},[s("el-card",[s("h4",[t._v("【"+t._s(e.host||"--")+"】"+t._s(e.module||"Server")+":"+t._s(e.file||"--"))]),s("p",{staticClass:"mt-10"},["slow"===t.logParams.type?s("json-viewer",{attrs:{value:e.message,"expand-depth":10,copyable:"",expanded:""}}):s("el-alert",{attrs:{type:void 0!==e.backtrace?"error":"info",closable:!1}},[t._v(t._s(e.message))])],1),void 0!==e.backtrace&&e.backtrace.length>0?t._l(e.backtrace,(function(e,n){return s("p",{key:n,staticStyle:{"margin-top":"5px","word-break":"break-all"}},[t._v(t._s((e.file||e.class)+":"+(e.line||e.function)))])})):t._e()],2)],1)})),1):t._e()],1),t.logList.length?s("el-pagination",{attrs:{background:"","current-page":t.logParams.page,"page-sizes":[10,20,50,100],"page-size":t.logParams.size,layout:"total,sizes, prev, pager, next",total:t.logParams.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.logParams,"page",e)},"update:current-page":function(e){return t.$set(t.logParams,"page",e)}}}):t._e()],1),s("el-drawer",{attrs:{title:"控制台",visible:t.consoleDisplay,direction:t.direction,size:"80%","show-close":!0},on:{"update:visible":function(e){t.consoleDisplay=e}}},[s("div",{staticClass:"block pd-20"},[t.consoleLogs.length?t._e():s("span",[t._v("暂无日志")]),t.consoleLogs.length?s("el-timeline",t._l(t.consoleLogs,(function(e,n){return s("el-timeline-item",{key:n,attrs:{placement:"top",timestamp:e.time}},[s("el-card",[s("h4",[t._v(t._s(e.node))]),s("p",{staticStyle:{"margin-top":"5px","word-break":"break-all"}},[t._v(t._s(e.message.data))])])],1)})),1):t._e()],1)]),t.servers.length?s("el-dialog",{attrs:{title:"版本管理",visible:t.dialogVersionsVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(e){t.dialogVersionsVisible=e}}},[s("versions",{attrs:{versionsType:t.versionsType,current:{app:t.servers[0].app_version,public:t.servers[0].public_version}},on:{updated:t.updated}})],1):t._e(),t.servers.length?s("el-dialog",{attrs:{title:"新增节点",visible:t.dialogAddnodeVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(e){t.dialogAddnodeVisible=e}}},[s("el-form",{ref:"form",attrs:{model:t.input,"status-icon":"","label-width":"120px"}},[s("el-form-item",{staticClass:"ml-5",attrs:{label:"主机地址："}},[s("el-input",{attrs:{placeholder:"请输入主机地址,确保master节点可访问",type:"text"},model:{value:t.input.host,callback:function(e){t.$set(t.input,"host",e)},expression:"input.host"}})],1),s("el-form-item",{staticClass:"ml-5",attrs:{label:"端口号："}},[s("el-input",{attrs:{placeholder:"示范:9582",type:"text"},model:{value:t.input.port,callback:function(e){t.$set(t.input,"port",e)},expression:"input.port"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogAddnodeVisible=!1}}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary",loading:t.isLoading},on:{click:function(e){return t.installNode()}}},[t._v("新增节点")])],1)],1):t._e()],2)},i=[],a=(s("28a5"),s("c1df")),l=s.n(a),o=(s("ac6a"),s("f3e2"),{socket:null,events:[],init:function(){return this.events=[],this},connect:function(t){var e=this;this.socket=new WebSocket(t),this.socket.onerror=function(t){e.emit("error",t)},this.socket.onopen=function(){e.emit("connected"),e.socket.onmessage=function(t){e.emit("message",t.data)},e.socket.onclose=function(){e.emit("close")}}},close:function(){this.socket&&this.socket.close()},send:function(t,e){this.socket.send(JSON.stringify({event:t,data:e||null}))},on:function(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),this},emit:function(){for(var t=this,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];var i=s[0],a=[].slice.call(s,1),l=this.events[i];return void 0===l||l.forEach((function(e){e.apply(t,a)})),this}}),r=o,c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"","max-height":600}},[s("el-table-column",{attrs:{prop:"release_date",label:"发布时间",width:"180"}}),s("el-table-column",{attrs:{prop:"version",label:"版本号",width:"180"}}),"app"===t.versionsType?s("el-table-column",{attrs:{prop:"app_object",label:"文件"}}):t._e(),"public"===t.versionsType?s("el-table-column",{attrs:{prop:"public_object",label:"文件"}}):t._e(),s("el-table-column",{attrs:{prop:"remark",label:"说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.remark||"--")+"\n        ")]}}])}),s("el-table-column",{attrs:{prop:"version",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return["app"===t.versionsType&&t.current.app===e.row.version||"public"===t.versionsType&&t.current.public===e.row.version?s("el-tag",[t._v("当前版本")]):s("el-button",{staticClass:"el-icon-upload2",attrs:{size:"mini"},on:{click:function(s){return t.update(e.row.version)}}})]}}])})],1)},p=[],u={name:"Versions",props:{versionsType:{type:String,default:"app"},current:{type:Object,default:{app:"0.0.0",public:"0.0.0"}}},data:function(){return{isLoading:!1,tableData:[]}},watch:{versionsType:function(){this.load()}},mounted:function(){this.load()},methods:{update:function(t){var e=this;this.$confirm("确定将".concat("app"===this.versionsType?"应用内核":"资源文件","更新至").concat(t,"吗?")).then((function(){e.$loading.show("升级中"),e.$request.post("/update",{type:e.versionsType,version:t}).then((function(t){t.errCode?e.$message.error(t.message):(e.$message.success("".concat(t.data,"个节点更新完毕")),e.$emit("updated",t.data))})).catch((function(t){e.$message.error(t)})).finally((function(){e.$loading.close()}))}))},load:function(){var t=this;this.tableData=[],this.isLoading=!0,this.$request.get("/versions",{type:this.versionsType}).then((function(e){e.errCode?(t.$message.error(e.message),t.isLoading=!1):t.tableData=e.data})).catch((function(e){t.$message.error(e)}))}}},d=u,g=s("2877"),m=Object(g["a"])(d,c,p,!1,null,null,null),v=m.exports,f=s("349e"),_=s.n(f);window.serverStatusTimer=null;var h={name:"Manage",components:{Versions:v,JsonViewer:_.a},data:function(){return{isLoading:!1,text:"新增节点",input:{host:"http://",port:""},dialogVersionsVisible:!1,dialogAddnodeVisible:!1,versionsType:"app",customColors:[{color:"#5cb87a",percentage:85},{color:"#1989fa",percentage:88},{color:"#e6a23c",percentage:90},{color:"#f56c6c",percentage:100}],isWaitting:!1,isRestartting:!1,socket:null,logDialogDisplay:!1,consoleDisplay:!1,taskDisplay:!1,direction:"rtl",socektUrl:"",running:0,connectStatus:{status:0},servers:[],logs:{error:{count:0,list:[]},info:{count:0,list:[]},slow:{count:0,list:[]}},info:{},latestVersion:{app:"",public:""},logList:[],logParams:{type:"error",page:1,count:1,size:10,day:l()().format("YYYY-MM-DD"),task:""},isPageActivation:!1,serverStatusTimer:null,consoleLogs:[],bgTasks:[],selectedTaskIndex:"",selectedTask:{logs:[]},selectedTaskLogs:[],framework:{is_phar:!1,version:"--",latest_version:"--",latest_build:"--",build:"--"}}},mounted:function(){var t=this;this.$user.checkLogin((function(){t.getServers()}))},methods:{upgradeFramework:function(){var t=this;this.$confirm("确定更新框架版本至版本".concat(this.framework.latest_version,"吗?")).then((function(){t.isLoading=!0,t.$request.post("/update",{type:"framework",version:t.framework.latest_version}).then((function(e){e.errCode?t.$message.error(e.message):t.$message.success("升级请求已发送")})).catch((function(e){t.$message.error(e)})).finally((function(){t.isLoading=!1}))})).catch((function(){}))},addNode:function(){this.dialogAddnodeVisible=!0},updated:function(){this.getServers(),this.dialogVersionsVisible=!1},installNode:function(){var t=this;this.isLoading=!0,this.$request.post("/install_slave_node",this.$copy(this.input)).then((function(e){e.errCode?(t.$message.error(e.message),t.isLoading=!1):t.checkNode()})).catch((function(e){t.$message.error(e)}))},checkNode:function(){var t=this;this.$request.post("/check_slave_node",this.$copy(this.input)).then((function(e){e.data?(t.isLoading=!1,t.dialogAddnodeVisible=!1,t.getServers()):setTimeout((function(){t.checkNode()}),5e3)})).catch((function(e){t.$message.error(e),setTimeout((function(){t.checkNode()}),5e3)}))},displayVersions:function(t){this.versionsType=t,this.dialogVersionsVisible=!0},displayTask:function(){this.selectedTask=this.bgTasks[this.selectedTaskIndex],this.selectedTaskLogs=this.$copy(this.selectedTask.logs).reverse()},initWebSocket:function(){var t=this;this.socket=r.init(),this.socket.on("connected",(function(){t.connectStatus.status=1,setTimeout((function(){t.socket.send("server_status")}),100)})).on("message",(function(e){var s=JSON.parse(e);switch(s.event){case"server_status":t.servers=s.servers,t.logs=s.logs,t.info=s.info;break;case"console":t.consoleLogs.unshift(s),t.consoleLogs.length>=300&&t.consoleLogs.splice(-1);break}})).on("close",(function(){t.connectStatus.status=0,t.isLoading=!0,setTimeout((function(){t.reConnent(30)}),2e3)})).on("error",(function(t){console.warn(t)})).connect(this.socektUrl)},reConnent:function(t){var e=this;1===this.connectStatus.status||t<=0||!this.isPageActivation?(this.isLoading=!1,this.isWaitting=!1):(t--,this.initWebSocket(),setTimeout((function(){e.reConnent(t)}),2e3))},showTasks:function(){this.$router.push("/server/crontab")},showLogs:function(t){this.logParams.type=t,this.logDialogDisplay=!0,this.logList=[],this.getLogs()},getLogs:function(){var t=this;this.isLoading=!0,this.$request.get("/logs",this.logParams).then((function(e){e.errCode?t.$message.error(e.message):(t.logList=e.data.list,t.logParams.count=e.data.total)})).catch((function(e){t.$message.error(e)})).finally((function(){t.isLoading=!1}))},handleSizeChange:function(t){this.logParams.size=t,this.getLogs()},handleCurrentChange:function(t){this.logParams.page=t,this.getLogs()},getServers:function(){var t=this;window.clearTimeout(window.serverStatusTimer),this.$api.system.servers().then((function(e){if(e.errCode)return t.$message.error(e.message);t.servers=e.data.servers,t.framework=e.data.framework,t.logs=e.data.logs,t.info=e.data.info,t.latestVersion=e.data.latest_version,t.isPageActivation=!0,t.socektUrl=e.data.socket_host,t.socket||t.initWebSocket()})).catch((function(e){t.$message.error(e)})).finally((function(){}))},handleCommand:function(t){var e=this;if("refreshServer"===t)this.getServers();else if("restartServer"===t)this.$confirm("确定重启所有节点吗").then((function(){e.isWaitting=!0,e.socket.send("restartAll")})).catch((function(){}));else{var s=t.split(":"),n=s[0],i=this.apps[s[1]].id;this.isWaitting=!0,this.socket.emit("command",{action:n,app:i}),"showLog"===n||(this.apps[s[1]].status=0)}}},beforeDestroy:function(){this.socket&&this.socket.close(),window.clearTimeout(window.serverStatusTimer),window.serverStatusTimer=null,this.isPageActivation=!1},destroyed:function(){this.socket&&this.socket.close(),window.clearTimeout(window.serverStatusTimer),window.serverStatusTimer=null,this.isPageActivation=!1}},b=h,y=(s("a889"),Object(g["a"])(b,n,i,!1,null,"49edb3b2",null));e["default"]=y.exports},a889:function(t,e,s){"use strict";var n=s("e91c"),i=s.n(n);i.a},e91c:function(t,e,s){}}]);
//# sourceMappingURL=chunk-61f74440.09ab022a.js.map