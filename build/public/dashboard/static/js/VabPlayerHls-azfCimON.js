/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-09-24 10:24:53 
 */
import{a9 as Rl,d as bl,r as _l,w as Il,C as Dl,ab as Cl,a as kl,o as Pl}from"./vsv-element-plus-Cu8LirE2.js";import{U as Ol,B as Pr,P as Ml}from"./index.min-DllbqQmz.js";function wl(B,X){if(!(B instanceof X))throw new TypeError("Cannot call a class as a function")}function Wn(B,X){for(var re=0;re<X.length;re++){var $=X[re];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(B,Kl($.key),$)}}function Fl(B,X,re){return X&&Wn(B.prototype,X),re&&Wn(B,re),Object.defineProperty(B,"prototype",{writable:!1}),B}function Nl(B,X){if(typeof X!="function"&&X!==null)throw new TypeError("Super expression must either be null or a function");B.prototype=Object.create(X&&X.prototype,{constructor:{value:B,writable:!0,configurable:!0}}),Object.defineProperty(B,"prototype",{writable:!1}),X&&Mr(B,X)}function Kt(B){return Kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(re){return re.__proto__||Object.getPrototypeOf(re)},Kt(B)}function Mr(B,X){return Mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function($,z){return $.__proto__=z,$},Mr(B,X)}function Bl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ul(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}function Gl(B,X){if(X&&(typeof X=="object"||typeof X=="function"))return X;if(X!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ul(B)}function Hl(B){var X=Bl();return function(){var $=Kt(B),z;if(X){var W=Kt(this).constructor;z=Reflect.construct($,arguments,W)}else z=$.apply(this,arguments);return Gl(this,z)}}function Vl(B,X){if(typeof B!="object"||B===null)return B;var re=B[Symbol.toPrimitive];if(re!==void 0){var $=re.call(B,X);if(typeof $!="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(B)}function Kl(B){var X=Vl(B,"string");return typeof X=="symbol"?X:String(X)}var Or={exports:{}},Yn;function Wl(){return Yn||(Yn=1,function(B,X){(function re($){(function(z,W){B.exports=W()})(this,function(){function z(a,s,i){if(wr())return Reflect.construct.apply(null,arguments);var t=[null];t.push.apply(t,s);var e=new(a.bind.apply(a,t));return i&&ut(e,i.prototype),e}function W(a,s){for(var i=0;i<s.length;i++){var t=s[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,Nr(t.key),t)}}function Z(a,s,i){return s&&W(a.prototype,s),i&&W(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function Ge(a,s,i){return(s=Nr(s))in a?Object.defineProperty(a,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[s]=i,a}function ee(){return ee=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var t in i)({}).hasOwnProperty.call(i,t)&&(a[t]=i[t])}return a},ee.apply(null,arguments)}function ne(a){return ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ne(a)}function he(a,s){a.prototype=Object.create(s.prototype),a.prototype.constructor=a,ut(a,s)}function We(a){try{return Function.toString.call(a).indexOf("[native code]")!==-1}catch{return typeof a=="function"}}function wr(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wr=function(){return!!a})()}function Fr(a,s){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)}return i}function be(a){for(var s=1;s<arguments.length;s++){var i=arguments[s]!=null?arguments[s]:{};s%2?Fr(Object(i),!0).forEach(function(t){Ge(a,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):Fr(Object(i)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(i,t))})}return a}function ut(a,s){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,t){return i.__proto__=t,i},ut(a,s)}function jn(a,s){if(typeof a!="object"||!a)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,s);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function Nr(a){var s=jn(a,"string");return typeof s=="symbol"?s:s+""}function ft(a){var s=typeof Map=="function"?new Map:void 0;return ft=function(i){if(i===null||!We(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(i))return s.get(i);s.set(i,t)}function t(){return z(i,arguments,ne(this).constructor)}return t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),ut(t,i)},ft(a)}function Xn(){try{return crypto.randomUUID()}catch{try{var a=URL.createObjectURL(new Blob),s=a.toString();return URL.revokeObjectURL(a),s.slice(s.lastIndexOf("/")+1)}catch{var i=new Date().getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var o=(i+Math.random()*16)%16|0;return i=Math.floor(i/16),(n=="x"?o:o&3|8).toString(16)});return t}}}function Br(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Wt={exports:{}},Ur;function $n(){return Ur||(Ur=1,function(a){var s=Object.prototype.hasOwnProperty,i="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(i=!1));function e(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function r(l,u,f,d,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var v=new e(f,d||l,h),c=i?i+u:u;return l._events[c]?l._events[c].fn?l._events[c]=[l._events[c],v]:l._events[c].push(v):(l._events[c]=v,l._eventsCount++),l}function n(l,u){--l._eventsCount===0?l._events=new t:delete l._events[u]}function o(){this._events=new t,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],f,d;if(this._eventsCount===0)return u;for(d in f=this._events)s.call(f,d)&&u.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},o.prototype.listeners=function(u){var f=i?i+u:u,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,v=d.length,c=new Array(v);h<v;h++)c[h]=d[h].fn;return c},o.prototype.listenerCount=function(u){var f=i?i+u:u,d=this._events[f];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,f,d,h,v,c){var g=i?i+u:u;if(!this._events[g])return!1;var m=this._events[g],p=arguments.length,y,S;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),p){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,d),!0;case 4:return m.fn.call(m.context,f,d,h),!0;case 5:return m.fn.call(m.context,f,d,h,v),!0;case 6:return m.fn.call(m.context,f,d,h,v,c),!0}for(S=1,y=new Array(p-1);S<p;S++)y[S-1]=arguments[S];m.fn.apply(m.context,y)}else{var T=m.length,x;for(S=0;S<T;S++)switch(m[S].once&&this.removeListener(u,m[S].fn,void 0,!0),p){case 1:m[S].fn.call(m[S].context);break;case 2:m[S].fn.call(m[S].context,f);break;case 3:m[S].fn.call(m[S].context,f,d);break;case 4:m[S].fn.call(m[S].context,f,d,h);break;default:if(!y)for(x=1,y=new Array(p-1);x<p;x++)y[x-1]=arguments[x];m[S].fn.apply(m[S].context,y)}}return!0},o.prototype.on=function(u,f,d){return r(this,u,f,d,!1)},o.prototype.once=function(u,f,d){return r(this,u,f,d,!0)},o.prototype.removeListener=function(u,f,d,h){var v=i?i+u:u;if(!this._events[v])return this;if(!f)return n(this,v),this;var c=this._events[v];if(c.fn)c.fn===f&&(!h||c.once)&&(!d||c.context===d)&&n(this,v);else{for(var g=0,m=[],p=c.length;g<p;g++)(c[g].fn!==f||h&&!c[g].once||d&&c[g].context!==d)&&m.push(c[g]);m.length?this._events[v]=m.length===1?m[0]:m:n(this,v)}return this},o.prototype.removeAllListeners=function(u){var f;return u?(f=i?i+u:u,this._events[f]&&n(this,f)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,a.exports=o}(Wt)),Wt.exports}var zn=$n(),Yt=Br(zn),qt={exports:{}},Gr;function Qn(){return Gr||(Gr=1,function(a,s){(function(i){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,f){if(f=f||{},l=l.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return f.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var v=o.parseURL(l);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var c=e.exec(v.path);v.netLoc=c[1],v.path=c[2]}v.netLoc&&!v.path&&(v.path="/");var g={scheme:v.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=v.netLoc,h.path[0]!=="/"))if(!h.path)g.path=v.path,h.params||(g.params=v.params,h.query||(g.query=v.query));else{var m=v.path,p=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=o.normalizePath(p)}return g.path===null&&(g.path=f.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(g)},parseURL:function(l){var u=t.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(n,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};a.exports=o})()}(qt)),qt.exports}var jt=Qn(),U=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},Zn=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=Jn},Jn=Number.MAX_SAFE_INTEGER||9007199254740991,Y=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),C=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),E=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({}),J={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},q={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},et=function(){function a(i,t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=i,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=t,this.totalWeight_=e}var s=a.prototype;return s.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},s.getTotalWeight=function(){return this.totalWeight_},s.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},a}(),ea=function(){function a(i,t,e,r){r===void 0&&(r=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new et(i),this.fast_=new et(t),this.defaultTTFB_=r,this.ttfb_=new et(i)}var s=a.prototype;return s.update=function(t,e){var r=this.slow_,n=this.fast_,o=this.ttfb_;r.halfLife!==t&&(this.slow_=new et(t,r.getEstimate(),r.getTotalWeight())),n.halfLife!==e&&(this.fast_=new et(e,n.getEstimate(),n.getTotalWeight())),o.halfLife!==t&&(this.ttfb_=new et(t,o.getEstimate(),o.getTotalWeight()))},s.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var r=8*e,n=t/1e3,o=r/n;this.fast_.sample(n,o),this.slow_.sample(n,o)},s.sampleTTFB=function(t){var e=t/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(r,Math.max(t,5))},s.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},s.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},s.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},s.destroy=function(){},Z(a,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),tt=function(s,i){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var t="["+s+"]:";this.trace=$e,this.debug=i.debug.bind(null,t),this.log=i.log.bind(null,t),this.warn=i.warn.bind(null,t),this.info=i.info.bind(null,t),this.error=i.error.bind(null,t)},$e=function(){},ta={trace:$e,debug:$e,log:$e,warn:$e,info:$e,error:$e};function Xt(){return ee({},ta)}function ra(a,s){var i=self.console[a];return i?i.bind(self.console,(s?"["+s+"] ":"")+"["+a+"] >"):$e}function Hr(a,s,i){return s[a]?s[a].bind(s):ra(a,i)}var $t=Xt();function Vr(a,s,i){var t=Xt();if(typeof console=="object"&&a===!0||typeof a=="object"){var e=["debug","log","info","warn","error"];e.forEach(function(r){t[r]=Hr(r,a,i)});try{t.log('Debug logs enabled for "'+s+'" in hls.js version 1.6.2')}catch{return Xt()}e.forEach(function(r){$t[r]=Hr(r,a)})}else ee($t,t);return t}var te=$t,zt,Kr;function ia(){return Kr||(Kr=1,zt=void 0),zt}var Wr=ia(),na=Br(Wr);function Me(a,s){if(s===void 0&&(s=!1),typeof TextDecoder<"u"){var i=new TextDecoder("utf-8"),t=i.decode(a);if(s){var e=t.indexOf("\0");return e!==-1?t.substring(0,e):t}return t.replace(/\0/g,"")}for(var r=a.length,n,o,l,u="",f=0;f<r;){if(n=a[f++],n===0&&s)return u;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(n);break;case 12:case 13:o=a[f++],u+=String.fromCharCode((n&31)<<6|o&63);break;case 14:o=a[f++],l=a[f++],u+=String.fromCharCode((n&15)<<12|(o&63)<<6|(l&63)<<0);break}}return u}var Yr={hexDump:function(s){for(var i="",t=0;t<s.length;t++){var e=s[t].toString(16);e.length<2&&(e="0"+e),i+=e}return i}},Qt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},fe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},qr=function(){function a(i){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof i=="string"&&(i={url:i}),this.base=i,sa(this,"stats")}var s=a.prototype;return s.setByteRange=function(t,e){var r=t.split("@",2),n;r.length===1?n=(e==null?void 0:e.byteRangeEndOffset)||0:n=parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]},s.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[fe.AUDIO]=null,t[fe.VIDEO]=null,t[fe.AUDIOVIDEO]=null},Z(a,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var t;this._streams=(t={},t[fe.AUDIO]=null,t[fe.VIDEO]=null,t[fe.AUDIOVIDEO]=null,t)}return this._streams},set:function(t){this._streams=t}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new Qt),this._stats},set:function(t){this._stats=t}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=jt.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}])}();function we(a){return a.sn!=="initSegment"}var Zt=function(a){function s(t,e){var r;return r=a.call(this,e)||this,r._decryptdata=null,r._programDateTime=null,r._ref=null,r._bitrate=void 0,r.rawProgramDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkeys=void 0,r.type=void 0,r.loader=null,r.keyLoader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.playlistOffset=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.endList=void 0,r.gap=void 0,r.urlId=0,r.type=t,r}he(s,a);var i=s.prototype;return i.addStart=function(e){this.setStart(this.start+e)},i.setStart=function(e){this.start=e,this._ref&&(this._ref.start=e)},i.setDuration=function(e){this.duration=e,this._ref&&(this._ref.duration=e)},i.setKeyFormat=function(e){if(this.levelkeys){var r=this.levelkeys[e];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},i.abortRequests=function(){var e,r;(e=this.loader)==null||e.abort(),(r=this.keyLoader)==null||r.abort()},i.setElementaryStreamInfo=function(e,r,n,o,l,u){u===void 0&&(u=!1);var f=this.elementaryStreams,d=f[e];if(!d){f[e]={startPTS:r,endPTS:n,startDTS:o,endDTS:l,partial:u};return}d.startPTS=Math.min(d.startPTS,r),d.endPTS=Math.max(d.endPTS,n),d.startDTS=Math.min(d.startDTS,o),d.endDTS=Math.max(d.endDTS,l)},Z(s,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange){var r=this.byteRange[0],n=this.byteRange[1];if(U(r)&&U(n))return n-r}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var r=this.levelkeys.identity;if(r)this._decryptdata=r.getDecryptData(this.sn);else{var n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var e=U(this.duration)?this.duration:0;return this.programDateTime+e*1e3}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),n=r.length;if(n>1||n===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!U(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return we(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(qr),aa=function(a){function s(i,t,e,r,n){var o;o=a.call(this,e)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.duration=i.decimalFloatingPoint("DURATION"),o.gap=i.bool("GAP"),o.independent=i.bool("INDEPENDENT"),o.relurl=i.enumeratedString("URI"),o.fragment=t,o.index=r;var l=i.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,n),n&&(o.fragOffset=n.fragOffset+n.duration),o}return he(s,a),Z(s,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}])}(qr);function jr(a,s){var i=Object.getPrototypeOf(a);if(i){var t=Object.getOwnPropertyDescriptor(i,s);return t||jr(i,s)}}function sa(a,s){var i=jr(a,s);i&&(i.enumerable=!0,Object.defineProperty(a,s,i))}var yt=Math.pow(2,32)-1,oa=[].push,Xr={video:1,audio:2,id3:3,text:4};function Ee(a){return String.fromCharCode.apply(null,a)}function $r(a,s){var i=a[s]<<8|a[s+1];return i<0?65536+i:i}function H(a,s){var i=Qr(a,s);return i<0?4294967296+i:i}function zr(a,s){var i=H(a,s);return i*=Math.pow(2,32),i+=H(a,s+4),i}function Qr(a,s){return a[s]<<24|a[s+1]<<16|a[s+2]<<8|a[s+3]}function Jt(a,s,i){a[s]=i>>24,a[s+1]=i>>16&255,a[s+2]=i>>8&255,a[s+3]=i&255}function la(a){for(var s=a.byteLength,i=0;i<s;){var t=H(a,i);if(t>8&&a[i+4]===109&&a[i+5]===111&&a[i+6]===111&&a[i+7]===102)return!0;i=t>1?i+t:s}return!1}function K(a,s){var i=[];if(!s.length)return i;for(var t=a.byteLength,e=0;e<t;){var r=H(a,e),n=Ee(a.subarray(e+4,e+8)),o=r>1?e+r:t;if(n===s[0])if(s.length===1)i.push(a.subarray(e+8,o));else{var l=K(a.subarray(e+8,o),s.slice(1));l.length&&oa.apply(i,l)}e=o}return i}function ua(a){var s=[],i=a[0],t=8,e=H(a,t);t+=4;var r=0,n=0;i===0?(r=H(a,t),n=H(a,t+4),t+=8):(r=zr(a,t),n=zr(a,t+8),t+=16),t+=2;var o=a.length+n,l=$r(a,t);t+=2;for(var u=0;u<l;u++){var f=t,d=H(a,f);f+=4;var h=d&2147483647,v=(d&2147483648)>>>31;if(v===1)return te.warn("SIDX has hierarchical references (not supported)"),null;var c=H(a,f);f+=4,s.push({referenceSize:h,subsegmentDuration:c,info:{duration:c/e,start:o,end:o+h-1}}),o+=h,f+=4,t=f}return{earliestPresentationTime:r,timescale:e,version:i,referencesCount:l,references:s}}function Zr(a){for(var s=[],i=K(a,["moov","trak"]),t=0;t<i.length;t++){var e=i[t],r=K(e,["tkhd"])[0];if(r){var n=r[0],o=H(r,n===0?12:20),l=K(e,["mdia","mdhd"])[0];if(l){n=l[0];var u=H(l,n===0?12:20),f=K(e,["mdia","hdlr"])[0];if(f){var d=Ee(f.subarray(8,12)),h={soun:fe.AUDIO,vide:fe.VIDEO}[d],v=K(e,["mdia","minf","stbl","stsd"])[0],c=fa(v);h?(s[o]={timescale:u,type:h,stsd:c},s[h]=be({timescale:u,id:o},c)):s[o]={timescale:u,type:d,stsd:c}}}}}var g=K(a,["moov","mvex","trex"]);return g.forEach(function(m){var p=H(m,4),y=s[p];y&&(y.default={duration:H(m,12),flags:H(m,20)})}),s}function fa(a){var s=a.subarray(8),i=s.subarray(86),t=Ee(s.subarray(4,8)),e=t,r,n=t==="enca"||t==="encv";if(n){var o=K(s,[t])[0],l=o.subarray(t==="enca"?28:78),u=K(l,["sinf"]);u.forEach(function(Re){var Le=K(Re,["schm"])[0];if(Le){var Pe=Ee(Le.subarray(4,8));if(Pe==="cbcs"||Pe==="cenc"){var ue=K(Re,["frma"])[0];ue&&(e=Ee(ue))}}})}var f=e;switch(e){case"avc1":case"avc2":case"avc3":case"avc4":{var d=K(i,["avcC"])[0];d&&d.length>3&&(e+="."+St(d[1])+St(d[2])+St(d[3]),r=Tt(f==="avc1"?"dva1":"dvav",i));break}case"mp4a":{var h=K(s,[t])[0],v=K(h.subarray(28),["esds"])[0];if(v&&v.length>7){var c=4;if(v[c++]!==3)break;c=er(v,c),c+=2;var g=v[c++];if(g&128&&(c+=2),g&64&&(c+=v[c++]),v[c++]!==4)break;c=er(v,c);var m=v[c++];if(m===64)e+="."+St(m);else break;if(c+=12,v[c++]!==5)break;c=er(v,c);var p=v[c++],y=(p&248)>>3;y===31&&(y+=1+((p&7)<<3)+((v[c]&224)>>5)),e+="."+y}break}case"hvc1":case"hev1":{var S=K(i,["hvcC"])[0];if(S&&S.length>12){var T=S[1],x=["","A","B","C"][T>>6],A=T&31,L=H(S,2),R=(T&32)>>5?"H":"L",D=S[12],_=S.subarray(6,12);e+="."+x+A,e+="."+L.toString(16).toUpperCase(),e+="."+R+D;for(var b="",I=_.length;I--;){var k=_[I];if(k||b){var w=k.toString(16).toUpperCase();b="."+w+b}}e+=b}r=Tt(f=="hev1"?"dvhe":"dvh1",i);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{e=Tt(e,i)||e;break}case"vp09":{var O=K(i,["vpcC"])[0];if(O&&O.length>6){var P=O[4],N=O[5],G=O[6]>>4&15;e+="."+He(P)+"."+He(N)+"."+He(G)}break}case"av01":{var F=K(i,["av1C"])[0];if(F&&F.length>2){var V=F[1]>>>5,ie=F[1]&31,j=F[2]>>>7?"H":"M",se=(F[2]&64)>>6,Q=(F[2]&32)>>5,ve=V===2&&se?Q?12:10:se?10:8,oe=(F[2]&16)>>4,ce=(F[2]&8)>>3,Ie=(F[2]&4)>>2,Te=F[2]&3,le=1,De=1,me=1,de=0;e+="."+V+"."+He(ie)+j+"."+He(ve)+"."+oe+"."+ce+Ie+Te+"."+He(le)+"."+He(De)+"."+He(me)+"."+de,r=Tt("dav1",i)}break}}return{codec:e,encrypted:n,supplemental:r}}function Tt(a,s){var i=K(s,["dvvC"]),t=i.length?i[0]:K(s,["dvcC"])[0];if(t){var e=t[2]>>1&127,r=t[2]<<5&32|t[3]>>3&31;return a+"."+He(e)+"."+He(r)}}function er(a,s){for(var i=s+5;a[s++]&128&&s<i;);return s}function St(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function He(a){return(a<10?"0":"")+a}function da(a,s){if(!a||!s)return a;var i=s.keyId;if(i&&s.isCommonEncryption){var t=K(a,["moov","trak"]);t.forEach(function(e){var r=K(e,["mdia","minf","stbl","stsd"])[0],n=r.subarray(8),o=K(n,["enca"]),l=o.length>0;l||(o=K(n,["encv"])),o.forEach(function(u){var f=l?u.subarray(28):u.subarray(78),d=K(f,["sinf"]);d.forEach(function(h){var v=ha(h);if(v){var c=v.subarray(8,24);c.some(function(g){return g!==0})||(te.log("[eme] Patching keyId in 'enc"+(l?"a":"v")+">sinf>>tenc' box: "+Yr.hexDump(c)+" -> "+Yr.hexDump(i)),v.set(i,8))}})})})}return a}function ha(a){var s=K(a,["schm"])[0];if(s){var i=Ee(s.subarray(4,8));if(i==="cbcs"||i==="cenc")return K(a,["schi","tenc"])[0]}return null}function ca(a,s){return K(s,["moof","traf"]).reduce(function(i,t){var e=K(t,["tfdt"])[0],r=e[0],n=K(t,["tfhd"]).reduce(function(o,l){var u=H(l,4),f=a[u];if(f){var d=H(e,4);if(r===1){if(d===yt)return te.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;d*=yt+1,d+=H(e,8)}var h=f.timescale||9e4,v=d/h;if(U(v)&&(o===null||v<o))return v}return o},null);return n!==null&&U(n)&&(i===null||n<i)?n:i},null)}function va(a,s){for(var i=0,t=0,e=0,r=K(a,["moof","traf"]),n=0;n<r.length;n++){var o=r[n],l=K(o,["tfhd"])[0],u=H(l,4),f=s[u];if(f){var d=f.default,h=H(l,0)|(d==null?void 0:d.flags),v=d==null?void 0:d.duration;h&8&&(h&2?v=H(l,12):v=H(l,8));for(var c=f.timescale||9e4,g=K(o,["trun"]),m=0;m<g.length;m++){if(i=ga(g[m]),!i&&v){var p=H(g[m],4);i=v*p}f.type===fe.VIDEO?t+=i/c:f.type===fe.AUDIO&&(e+=i/c)}}}if(t===0&&e===0){for(var y=1/0,S=0,T=0,x=K(a,["sidx"]),A=0;A<x.length;A++){var L=ua(x[A]);if(L!=null&&L.references){y=Math.min(y,L.earliestPresentationTime/L.timescale);var R=L.references.reduce(function(D,_){return D+_.info.duration||0},0);S=Math.max(S,R+L.earliestPresentationTime/L.timescale),T=S-y}}if(T&&U(T))return T}return t||e}function ga(a){var s=H(a,0),i=8;s&1&&(i+=4),s&4&&(i+=4);for(var t=0,e=H(a,4),r=0;r<e;r++){if(s&256){var n=H(a,i);t+=n,i+=4}s&512&&(i+=4),s&1024&&(i+=4),s&2048&&(i+=4)}return t}function ma(a,s,i){K(s,["moof","traf"]).forEach(function(t){K(t,["tfhd"]).forEach(function(e){var r=H(e,4),n=a[r];if(n){var o=n.timescale||9e4;K(t,["tfdt"]).forEach(function(l){var u=l[0],f=i*o;if(f){var d=H(l,4);if(u===0)d-=f,d=Math.max(d,0),Jt(l,4,d);else{d*=Math.pow(2,32),d+=H(l,8),d-=f,d=Math.max(d,0);var h=Math.floor(d/(yt+1)),v=Math.floor(d%(yt+1));Jt(l,4,h),Jt(l,8,v)}}})}})})}function pa(a){var s={valid:null,remainder:null},i=K(a,["moof"]);if(i.length<2)return s.remainder=a,s;var t=i[i.length-1];return s.valid=a.slice(0,t.byteOffset-8),s.remainder=a.slice(t.byteOffset-8),s}function Fe(a,s){var i=new Uint8Array(a.length+s.length);return i.set(a),i.set(s,a.length),i}function Jr(a,s){var i=[],t=s.samples,e=s.timescale,r=s.id,n=!1,o=K(t,["moof"]);return o.map(function(l){var u=l.byteOffset-8,f=K(l,["traf"]);f.map(function(d){var h=K(d,["tfdt"]).map(function(v){var c=v[0],g=H(v,4);return c===1&&(g*=Math.pow(2,32),g+=H(v,8)),g/e})[0];return h!==void 0&&(a=h),K(d,["tfhd"]).map(function(v){var c=H(v,4),g=H(v,0)&16777215,m=(g&1)!==0,p=(g&2)!==0,y=(g&8)!==0,S=0,T=(g&16)!==0,x=0,A=(g&32)!==0,L=8;c===r&&(m&&(L+=8),p&&(L+=4),y&&(S=H(v,L),L+=4),T&&(x=H(v,L),L+=4),A&&(L+=4),s.type==="video"&&(n=tr(s.codec)),K(d,["trun"]).map(function(R){var D=R[0],_=H(R,0)&16777215,b=(_&1)!==0,I=0,k=(_&4)!==0,w=(_&256)!==0,O=0,P=(_&512)!==0,N=0,G=(_&1024)!==0,F=(_&2048)!==0,V=0,ie=H(R,4),j=8;b&&(I=H(R,j),j+=4),k&&(j+=4);for(var se=I+u,Q=0;Q<ie;Q++){if(w?(O=H(R,j),j+=4):O=S,P?(N=H(R,j),j+=4):N=x,G&&(j+=4),F&&(D===0?V=H(R,j):V=Qr(R,j),j+=4),s.type===fe.VIDEO)for(var ve=0;ve<N;){var oe=H(t,se);if(se+=4,Ea(n,t[se])){var ce=t.subarray(se,se+oe);ei(ce,n?2:1,a+V/e,i)}se+=oe,ve+=oe+4}a+=O/e}}))})})}),i}function tr(a){if(!a)return!1;var s=a.substring(0,4);return s==="hvc1"||s==="hev1"||s==="dvh1"||s==="dvhe"}function Ea(a,s){if(a){var i=s>>1&63;return i===39||i===40}else{var t=s&31;return t===6}}function ei(a,s,i,t){var e=ti(a),r=0;r+=s;for(var n=0,o=0,l=0;r<e.length;){n=0;do{if(r>=e.length)break;l=e[r++],n+=l}while(l===255);o=0;do{if(r>=e.length)break;l=e[r++],o+=l}while(l===255);var u=e.length-r,f=r;if(o<u)r+=o;else if(o>u){te.error("Malformed SEI payload. "+o+" is too small, only "+u+" bytes left to parse.");break}if(n===4){var d=e[f++];if(d===181){var h=$r(e,f);if(f+=2,h===49){var v=H(e,f);if(f+=4,v===1195456820){var c=e[f++];if(c===3){var g=e[f++],m=31&g,p=64&g,y=p?2+m*3:0,S=new Uint8Array(y);if(p){S[0]=g;for(var T=1;T<y;T++)S[T]=e[f++]}t.push({type:c,payloadType:n,pts:i,bytes:S})}}}}}else if(n===5&&o>16){for(var x=[],A=0;A<16;A++){var L=e[f++].toString(16);x.push(L.length==1?"0"+L:L),(A===3||A===5||A===7||A===9)&&x.push("-")}for(var R=o-16,D=new Uint8Array(R),_=0;_<R;_++)D[_]=e[f++];t.push({payloadType:n,pts:i,uuid:x.join(""),userData:Me(D),userDataBytes:D})}}}function ti(a){for(var s=a.byteLength,i=[],t=1;t<s-2;)a[t]===0&&a[t+1]===0&&a[t+2]===3?(i.push(t+2),t+=2):t++;if(i.length===0)return a;var e=s-i.length,r=new Uint8Array(e),n=0;for(t=0;t<e;n++,t++)n===i[0]&&(n++,i.shift()),r[t]=a[n];return r}function ya(a){var s=a[0],i="",t="",e=0,r=0,n=0,o=0,l=0,u=0;if(s===0){for(;Ee(a.subarray(u,u+1))!=="\0";)i+=Ee(a.subarray(u,u+1)),u+=1;for(i+=Ee(a.subarray(u,u+1)),u+=1;Ee(a.subarray(u,u+1))!=="\0";)t+=Ee(a.subarray(u,u+1)),u+=1;t+=Ee(a.subarray(u,u+1)),u+=1,e=H(a,12),r=H(a,16),o=H(a,20),l=H(a,24),u=28}else if(s===1){u+=4,e=H(a,u),u+=4;var f=H(a,u);u+=4;var d=H(a,u);for(u+=4,n=Math.pow(2,32)*f+d,Zn(n)||(n=Number.MAX_SAFE_INTEGER,te.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=H(a,u),u+=4,l=H(a,u),u+=4;Ee(a.subarray(u,u+1))!=="\0";)i+=Ee(a.subarray(u,u+1)),u+=1;for(i+=Ee(a.subarray(u,u+1)),u+=1;Ee(a.subarray(u,u+1))!=="\0";)t+=Ee(a.subarray(u,u+1)),u+=1;t+=Ee(a.subarray(u,u+1)),u+=1}var h=a.subarray(u,a.byteLength);return{schemeIdUri:i,value:t,timeScale:e,presentationTime:n,presentationTimeDelta:r,eventDuration:o,id:l,payload:h}}function ze(a){if(a===void 0&&(a=!0),!(typeof self>"u")){var s=(a||!self.MediaSource)&&self.ManagedMediaSource;return s||self.MediaSource||self.WebKitMediaSource}}function Ta(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Sa(a,s){var i=Object.keys(a),t=Object.keys(s),e=i.length,r=t.length;return!e||!r||e===r&&!i.some(function(n){return t.indexOf(n)===-1})}var ri=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},rt={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ii(a,s){var i=rt[s];return!!i&&!!i[a.slice(0,4)]}function rr(a,s,i){return i===void 0&&(i=!0),!a.split(",").some(function(t){return!ni(t,s,i)})}function ni(a,s,i){var t;i===void 0&&(i=!0);var e=ze(i);return(t=e==null?void 0:e.isTypeSupported(dt(a,s)))!=null?t:!1}function dt(a,s){return s+"/mp4;codecs="+a}function ai(a){if(a){var s=a.substring(0,4);return rt.video[s]}return 2}function xt(a){var s=ri();return a.split(",").reduce(function(i,t){var e=s&&tr(t),r=e?9:rt.video[t];return r?(r*2+i)/(i?3:2):(rt.audio[t]+i)/(i?2:1)},0)}var ir={};function xa(a,s){if(s===void 0&&(s=!0),ir[a])return ir[a];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a],t=0;t<i.length;t++){var e;if(ni(i[t],"audio",s))return ir[a]=i[t],i[t];if(i[t]==="mp3"&&(e=ze(s))!=null&&e.isTypeSupported("audio/mpeg"))return""}return a}var La=/flac|opus|mp4a\.40\.34/i;function Lt(a,s){return s===void 0&&(s=!0),a.replace(La,function(i){return xa(i.toLowerCase(),s)})}function Aa(a,s){var i=[];if(a)for(var t=a.split(","),e=0;e<t.length;e++)ii(t[e],"video")||i.push(t[e]);return s&&i.push(s),i.join(",")}function At(a,s){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1))return a;if(s){var i=s.split(",");if(i.length>1){if(a){for(var t=i.length;t--;)if(i[t].substring(0,4)===a.substring(0,4))return i[t]}return i[0]}}return s||a}function Ra(a){for(var s=a.split(","),i=0;i<s.length;i++){var t=s[i].split(".");if(t.length>2){var e=t.shift()+".";e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),s[i]=e}}return s.join(",")}function ba(a){if(a.startsWith("av01.")){for(var s=a.split("."),i=["0","111","01","01","01","0"],t=s.length;t>4&&t<10;t++)s[t]=i[t-4];return s.join(".")}return a}function si(a){var s=ze(a)||{isTypeSupported:function(){return!1}};return{mpeg:s.isTypeSupported("audio/mpeg"),mp3:s.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:!1}}function oi(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var nr=["NONE","TYPE-0","TYPE-1",null];function _a(a){return nr.indexOf(a)>-1}var Rt=["SDR","PQ","HLG"];function Ia(a){return!!a&&Rt.indexOf(a)>-1}var bt={No:"",Yes:"YES",v2:"v2"};function li(a){var s=a.canSkipUntil,i=a.canSkipDateRanges,t=a.age,e=t<s/2;return s&&e?i?bt.v2:bt.Yes:bt.No}var ui=function(){function a(i,t,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=i,this.part=t,this.skip=e}var s=a.prototype;return s.addDirectives=function(t){var e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},a}(),fi=function(){function a(i){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[i.url],this._attrs=[i.attrs],this.bitrate=i.bitrate,i.details&&(this.details=i.details),this.id=i.id||0,this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.frameRate=i.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=i.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.codecSet=[i.videoCodec,i.audioCodec].filter(function(r){return!!r}).map(function(r){return r.substring(0,4)}).join(","),"supplemental"in i){var t;this.supplemental=i.supplemental;var e=(t=i.supplemental)==null?void 0:t.videoCodec;e&&e!==i.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",i.attrs.AUDIO),this.addGroupId("text",i.attrs.SUBTITLES)}var s=a.prototype;return s.hasAudioGroup=function(t){return di(this._audioGroups,t)},s.hasSubtitleGroup=function(t){return di(this._subtitleGroups,t)},s.addGroupId=function(t,e){if(e){if(t==="audio"){var r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(e)===-1&&r.push(e)}else if(t==="text"){var n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(e)===-1&&n.push(e)}}},s.addFallback=function(){},Z(a,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(t){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var t;return(t=this.audioGroups)==null?void 0:t[0]}},{key:"textGroupId",get:function(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}}])}();function di(a,s){return!s||!a?!1:a.indexOf(s)!==-1}function Da(){if(typeof matchMedia=="function"){var a=matchMedia("(dynamic-range: high)"),s=matchMedia("bad query");if(a.media!==s.media)return a.matches===!0}return!1}function Ca(a,s){var i=!1,t=[];if(a&&(i=a!=="SDR",t=[a]),s){t=s.allowedVideoRanges||Rt.slice(0);var e=t.join("")!=="SDR"&&!s.videoCodec;i=s.preferHDR!==void 0?s.preferHDR:e&&Da(),i||(t=["SDR"])}return{preferHDR:i,allowedVideoRanges:t}}var ka=function(s){var i=new WeakSet;return function(t,e){if(s&&(e=s(t,e)),typeof e=="object"&&e!==null){if(i.has(e))return;i.add(e)}return e}},Ae=function(s,i){return JSON.stringify(s,ka(i))};function Pa(a,s,i,t,e){for(var r=Object.keys(a),n=t==null?void 0:t.channels,o=t==null?void 0:t.audioCodec,l=e==null?void 0:e.videoCodec,u=n&&parseInt(n)===2,f=!1,d=!1,h=1/0,v=1/0,c=1/0,g=1/0,m=0,p=[],y=Ca(s,e),S=y.preferHDR,T=y.allowedVideoRanges,x=function(){var I=a[r[A]];f||(f=I.channels[2]>0),h=Math.min(h,I.minHeight),v=Math.min(v,I.minFramerate),c=Math.min(c,I.minBitrate);var k=T.filter(function(w){return I.videoRanges[w]>0});k.length>0&&(d=!0)},A=r.length;A--;)x();h=U(h)?h:0,v=U(v)?v:0;var L=Math.max(1080,h),R=Math.max(30,v);c=U(c)?c:i,i=Math.max(c,i),d||(s=void 0);var D=r.length>1,_=r.reduce(function(b,I){var k=a[I];if(I===b)return b;if(p=d?T.filter(function(w){return k.videoRanges[w]>0}):[],D){if(k.minBitrate>i)return Ve(I,"min bitrate of "+k.minBitrate+" > current estimate of "+i),b;if(!k.hasDefaultAudio)return Ve(I,"no renditions with default or auto-select sound found"),b;if(o&&I.indexOf(o.substring(0,4))%5!==0)return Ve(I,'audio codec preference "'+o+'" not found'),b;if(n&&!u){if(!k.channels[n])return Ve(I,"no renditions with "+n+" channel sound found (channels options: "+Object.keys(k.channels)+")"),b}else if((!o||u)&&f&&k.channels[2]===0)return Ve(I,"no renditions with stereo sound found"),b;if(k.minHeight>L)return Ve(I,"min resolution of "+k.minHeight+" > maximum of "+L),b;if(k.minFramerate>R)return Ve(I,"min framerate of "+k.minFramerate+" > maximum of "+R),b;if(!p.some(function(w){return k.videoRanges[w]>0}))return Ve(I,"no variants with VIDEO-RANGE of "+Ae(p)+" found"),b;if(l&&I.indexOf(l.substring(0,4))%5!==0)return Ve(I,'video codec preference "'+l+'" not found'),b;if(k.maxScore<m)return Ve(I,"max score of "+k.maxScore+" < selected max of "+m),b}return b&&(xt(I)>=xt(b)||k.fragmentError>a[b].fragmentError)?b:(g=k.minIndex,m=k.maxScore,I)},void 0);return{codecSet:_,videoRanges:p,preferHDR:S,minFramerate:v,minBitrate:c,minIndex:g}}function Ve(a,s){te.log('[abr] start candidates with "'+a+'" ignored because '+s)}function hi(a){return a.reduce(function(s,i){var t=s.groups[i.groupId];t||(t=s.groups[i.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),t.tracks.push(i);var e=i.channels||"2";return t.channels[e]=(t.channels[e]||0)+1,t.hasDefault=t.hasDefault||i.default,t.hasAutoSelect=t.hasAutoSelect||i.autoselect,t.hasDefault&&(s.hasDefaultAudio=!0),t.hasAutoSelect&&(s.hasAutoSelectAudio=!0),s},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Oa(a,s,i,t){return a.slice(i,t+1).reduce(function(e,r,n){if(!r.codecSet)return e;var o=r.audioGroups,l=e[r.codecSet];l||(e[r.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,r.bitrate);var u=Math.min(r.height,r.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,r.frameRate),l.minIndex=Math.min(l.minIndex,n),l.maxScore=Math.max(l.maxScore,r.score),l.fragmentError+=r.fragmentError,l.videoRanges[r.videoRange]=(l.videoRanges[r.videoRange]||0)+1,e},{})}function ci(a,s){var i;return!!a&&a!==((i=s.loadLevelObj)==null?void 0:i.uri)}var Ma=function(a){function s(t){var e;return e=a.call(this,"abr",t.logger)||this,e.hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.bwEstimator=void 0,e._abandonRulesCheck=function(r){var n,o=e,l=o.fragCurrent,u=o.partCurrent,f=o.hls,d=f.autoLevelEnabled,h=f.media;if(!(!l||!h)){var v=performance.now(),c=u?u.stats:l.stats,g=u?u.duration:l.duration,m=v-c.loading.start,p=f.minAutoLevel,y=l.level,S=e._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||y<=p){e.clearTimer(),e._nextAutoLevel=-1;return}if(d){var T=S>-1&&S!==y,x=!!r||T;if(!(!x&&(h.paused||!h.playbackRate||!h.readyState))){var A=f.mainForwardBufferInfo;if(!(!x&&A===null)){var L=e.bwEstimator.getEstimateTTFB(),R=Math.abs(h.playbackRate);if(!(m<=Math.max(L,1e3*(g/(R*2))))){var D=A?A.len/R:0,_=c.loading.first?c.loading.first-c.loading.start:-1,b=c.loaded&&_>-1,I=e.getBwEstimate(),k=f.levels,w=k[y],O=Math.max(c.loaded,Math.round(g*(l.bitrate||w.averageBitrate)/8)),P=b?m-_:m;P<1&&b&&(P=Math.min(m,c.loaded*8/I));var N=b?c.loaded*1e3/P:0,G=L/1e3,F=N?(O-c.loaded)/N:O*8/I+G;if(!(F<=D)){var V=N?N*8:I,ie=((n=(r==null?void 0:r.details)||e.hls.latestLevelDetails)==null?void 0:n.live)===!0,j=e.hls.config.abrBandWidthUpFactor,se=Number.POSITIVE_INFINITY,Q;for(Q=y-1;Q>p;Q--){var ve=k[Q].maxBitrate,oe=!k[Q].details||ie;if(se=e.getTimeToLoadFrag(G,V,g*ve,oe),se<Math.min(D,g+G))break}if(!(se>=F)&&!(se>g*10)){b?e.bwEstimator.sample(m-Math.min(L,_),c.loaded):e.bwEstimator.sampleTTFB(m);var ce=k[Q].maxBitrate;e.getBwEstimate()*j>ce&&e.resetEstimator(ce);var Ie=e.findBestLevel(ce,p,Q,0,D,1,1);Ie>-1&&(Q=Ie),e.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+y+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+D.toFixed(3)+` s
      Estimated load time for current fragment: `+F.toFixed(3)+` s
      Estimated load time for down switch fragment: `+se.toFixed(3)+` s
      TTFB estimate: `+(_|0)+` ms
      Current BW estimate: `+(U(I)?I|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+Q+" @ "+(ce|0)+" bps"),f.nextLoadLevel=f.nextAutoLevel=Q,e.clearTimer();var Te=function(){if(e.clearTimer(),e.fragCurrent===l&&e.hls.loadLevel===Q&&Q>0){var De=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(Q>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+De.toFixed(3)+" s"),l.abortRequests(),e.fragCurrent=e.partCurrent=null,Q>p){var me=e.findBestLevel(e.hls.levels[p].bitrate,p,Q,0,De,1,1);me===-1&&(me=p),e.hls.nextLoadLevel=e.hls.nextAutoLevel=me,e.resetEstimator(e.hls.levels[me].bitrate)}}};T||F>se*2?Te():e.timer=self.setInterval(Te,se*1e3),f.trigger(E.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:c})}}}}}}}},e.hls=t,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}he(s,a);var i=s.prototype;return i.resetEstimator=function(e){e&&(this.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},i.initEstimator=function(){var e=this.hls.config;return new ea(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},i.registerListeners=function(){var e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(E.ERROR,this.onError,this)},i.unregisterListeners=function(){var e=this.hls;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(E.ERROR,this.onError,this))},i.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},i.onManifestLoading=function(e,r){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},i.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},i.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},i.onFragLoading=function(e,r){var n=r.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var o;this.fragCurrent=n,this.partCurrent=(o=r.part)!=null?o:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},i.onLevelSwitching=function(e,r){this.clearTimer()},i.onError=function(e,r){if(!r.fatal)switch(r.details){case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case C.FRAG_LOAD_TIMEOUT:{var n=r.frag,o=this.fragCurrent,l=this.partCurrent;if(n&&o&&n.sn===o.sn&&n.level===o.level){var u=performance.now(),f=l?l.stats:n.stats,d=u-f.loading.start,h=f.loading.first?f.loading.first-f.loading.start:-1,v=f.loaded&&h>-1;if(v){var c=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(c,h),f.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}},i.getTimeToLoadFrag=function(e,r,n,o){var l=e+n/r,u=o?e+this.lastLevelLoadSec:0;return l+u},i.onLevelLoaded=function(e,r){var n=this.hls.config,o=r.stats.loading,l=o.end-o.first;U(l)&&(this.lastLevelLoadSec=l/1e3),r.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(r.levelInfo)},i.onFragLoaded=function(e,r){var n=r.frag,o=r.part,l=o?o.stats:n.stats;if(n.type===q.MAIN&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var u=o?o.duration:n.duration,f=this.hls.levels[n.level],d=(f.loaded?f.loaded.bytes:0)+l.loaded,h=(f.loaded?f.loaded.duration:0)+u;f.loaded={bytes:d,duration:h},f.realBitrate=Math.round(8*d/h)}if(n.bitrateTest){var v={stats:l,frag:n,part:o,id:n.type};this.onFragBuffered(E.FRAG_BUFFERED,v),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}},i.onFragBuffered=function(e,r){var n=r.frag,o=r.part,l=o!=null&&o.stats.loaded?o.stats:n.stats;if(!l.aborted&&!this.ignoreFragment(n)){var u=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,l.loaded),l.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},i.ignoreFragment=function(e){return e.type!==q.MAIN||e.sn==="initSegment"},i.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},i.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},i.getNextABRAutoLevel=function(){var e=this.fragCurrent,r=this.partCurrent,n=this.hls;if(n.levels.length<=1)return n.loadLevel;var o=n.maxAutoLevel,l=n.config,u=n.minAutoLevel,f=r?r.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),v=l.abrBandWidthFactor,c=l.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,u,o,h,0,v,c);if(g>=0)return this.rebufferNotice=-1,g}var m=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!h){var p=this.bitrateTestDelay;if(p){var y=f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay;m=y-p,this.info("bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),v=c=1}}var S=this.findBestLevel(d,u,o,h,m,v,c);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+S)),S>-1)return S;var T=n.levels[u],x=n.loadLevelObj;return x&&(T==null?void 0:T.bitrate)<x.bitrate?u:n.loadLevel},i.getStarvationDelay=function(){var e=this.hls,r=e.media;if(!r)return 1/0;var n=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,o=e.mainForwardBufferInfo;return(o?o.len:0)/n},i.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},i.findBestLevel=function(e,r,n,o,l,u,f){var d,h=this,v=o+l,c=this.lastLoadedFragLevel,g=c===-1?this.hls.firstLevel:c,m=this.fragCurrent,p=this.partCurrent,y=this.hls,S=y.levels,T=y.allAudioTracks,x=y.loadLevel,A=y.config;if(S.length===1)return 0;var L=S[g],R=!!((d=this.hls.latestLevelDetails)!=null&&d.live),D=x===-1||c===-1,_,b="SDR",I=(L==null?void 0:L.frameRate)||0,k=A.audioPreference,w=A.videoPreference,O=this.audioTracksByGroup||(this.audioTracksByGroup=hi(T)),P=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;var N=this.codecTiers||(this.codecTiers=Oa(S,O,r,n)),G=Pa(N,b,e,k,w),F=G.codecSet,V=G.videoRanges,ie=G.minFramerate,j=G.minBitrate,se=G.minIndex,Q=G.preferHDR;P=se,_=F,b=Q?V[V.length-1]:V[0],I=ie,e=Math.max(e,j),this.log("picked start tier "+Ae(G))}else _=L==null?void 0:L.codecSet,b=L==null?void 0:L.videoRange;for(var ve=p?p.duration:m?m.duration:0,oe=this.bwEstimator.getEstimateTTFB()/1e3,ce=[],Ie=function(){var me,de=S[le],Re=le>g;if(!de)return 0;if((_&&de.codecSet!==_||b&&de.videoRange!==b||Re&&I>de.frameRate||!Re&&I>0&&I<de.frameRate||de.supportedResult&&!((me=de.supportedResult.decodingInfoResults)!=null&&me[0].smooth))&&(!D||le!==P))return ce.push(le),0;var Le=de.details,Pe=(p?Le==null?void 0:Le.partTarget:Le==null?void 0:Le.averagetargetduration)||ve,ue;Re?ue=f*e:ue=u*e;var Oe=ve&&o>=ve*2&&l===0?de.averageBitrate:de.maxBitrate,pe=h.getTimeToLoadFrag(oe,ue,Oe*Pe,Le===void 0),Ce=ue>=Oe&&(le===c||de.loadError===0&&de.fragmentError===0)&&(pe<=oe||!U(pe)||R&&!h.bitrateTestDelay||pe<v);if(Ce){var Et=h.forcedAutoLevel;return le!==x&&(Et===-1||Et!==x)&&(ce.length&&h.trace("Skipped level(s) "+ce.join(",")+" of "+n+' max with CODECS and VIDEO-RANGE:"'+S[ce[0]].codecs+'" '+S[ce[0]].videoRange+'; not compatible with "'+_+'" '+b),h.info("switch candidate:"+g+"->"+le+" adjustedbw("+Math.round(ue)+")-bitrate="+Math.round(ue-Oe)+" ttfb:"+oe.toFixed(1)+" avgDuration:"+Pe.toFixed(1)+" maxFetchDuration:"+v.toFixed(1)+" fetchDuration:"+pe.toFixed(1)+" firstSelection:"+D+" codecSet:"+de.codecSet+" videoRange:"+de.videoRange+" hls.loadLevel:"+x)),D&&(h.firstSelection=le),{v:le}}},Te,le=n;le>=r;le--)if(Te=Ie(),Te!==0&&Te)return Te.v;return-1},i.deriveNextAutoLevel=function(e){var r=this.hls,n=r.maxAutoLevel,o=r.minAutoLevel;return Math.min(Math.max(e,o),n)},Z(s,[{key:"firstAutoLevel",get:function(){var e=this.hls,r=e.maxAutoLevel,n=e.minAutoLevel,o=this.getBwEstimate(),l=this.hls.config.maxStarvationDelay,u=this.findBestLevel(o,n,r,0,l,1,1);if(u>-1)return u;var f=this.hls.firstLevel,d=Math.min(Math.max(f,n),r);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+f+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,r=this.bwEstimator,n=r.canEstimate(),o=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!o||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var l=n&&o?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var u=this.hls.levels;if(u.length>Math.max(e,l)&&u[e].loadError<=u[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l},set:function(e){var r=this.deriveNextAutoLevel(e);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}}])}(tt),wa=function(){function a(i){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=i}var s=a.prototype;return s.destroy=function(){this.tracks=this.queues=null},s.append=function(t,e,r){if(!(this.queues===null||this.tracks===null)){var n=this.queues[e];n.push(t),n.length===1&&!r&&this.executeNext(e)}},s.appendBlocker=function(t){var e=this;return new Promise(function(r){var n={label:"async-blocker",execute:r,onStart:function(){},onComplete:function(){},onError:function(){}};e.append(n,t)})},s.prependBlocker=function(t){var e=this;return new Promise(function(r){if(e.queues){var n={label:"async-blocker-prepend",execute:r,onStart:function(){},onComplete:function(){},onError:function(){}};e.queues[t].unshift(n)}})},s.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(t){var e,r=(e=t[0])==null?void 0:e.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(t[0].execute(),t.splice(0,1))})},s.unblockAudio=function(t){if(this.queues!==null){var e=this.queues.audio;e[0]===t&&this.shiftAndExecuteNext("audio")}},s.executeNext=function(t){if(!(this.queues===null||this.tracks===null)){var e=this.queues[t];if(e.length){var r=e[0];try{r.execute()}catch(l){var n;if(r.onError(l),this.queues===null||this.tracks===null)return;var o=(n=this.tracks[t])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(t)}}}},s.shiftAndExecuteNext=function(t){this.queues!==null&&(this.queues[t].shift(),this.executeNext(t))},s.current=function(t){var e;return((e=this.queues)==null?void 0:e[t][0])||null},s.toString=function(){var t=this.queues,e=this.tracks;return t===null||e===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},s.list=function(t){var e,r;return(e=this.queues)!=null&&e[t]||(r=this.tracks)!=null&&r[t]?t+": ("+this.listSbInfo(t)+") "+this.listOps(t):""},s.listSbInfo=function(t){var e,r=(e=this.tracks)==null?void 0:e[t],n=r==null?void 0:r.buffer;return n?"SourceBuffer"+(n.updating?" updating":"")+(r.ended?" ended":"")+(r.ending?" ending":""):"none"},s.listOps=function(t){var e;return((e=this.queues)==null?void 0:e[t].map(function(r){return r.label}).join(", "))||""},a}(),vi={search:function(s,i){for(var t=0,e=s.length-1,r=null,n=null;t<=e;){r=(t+e)/2|0,n=s[r];var o=i(n);if(o>0)t=r+1;else if(o<0)e=r-1;else return n}return null}};function Fa(a,s,i){if(s===null||!Array.isArray(a)||!a.length||!U(s))return null;var t=a[0].programDateTime;if(s<(t||0))return null;var e=a[a.length-1].endProgramDateTime;if(s>=(e||0))return null;i=i||0;for(var r=0;r<a.length;++r){var n=a[r];if(Ba(s,i,n))return n}return null}function ar(a,s,i,t,e){i===void 0&&(i=0),t===void 0&&(t=0),e===void 0&&(e=.005);var r=null;if(a){r=s[1+a.sn-s[0].sn]||null;var n=a.endDTS-i;n>0&&n<15e-7&&(i+=15e-7),r&&a.level!==r.level&&r.end<=a.end&&(r=s[2+a.sn-s[0].sn]||null)}else i===0&&s[0].start===0&&(r=s[0]);if(r&&((!a||a.level===r.level)&&gi(i,t,r)===0||Na(r,a,Math.min(e,t))))return r;var o=vi.search(s,gi.bind(null,i,t));return o&&(o!==a||!r)?o:r}function Na(a,s,i){if(s&&s.start===0&&s.level<a.level&&(s.endPTS||0)>0){var t=s.tagList.reduce(function(e,r){return r[0]==="INF"&&(e+=parseFloat(r[1])),e},i);return a.start<=t}return!1}function gi(a,s,i){if(a===void 0&&(a=0),s===void 0&&(s=0),i.start<=a&&i.start+i.duration>a)return 0;var t=Math.min(s,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-t<=a?1:i.start-t>a&&i.start?-1:0}function Ba(a,s,i){var t=Math.min(s,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3,e=i.endProgramDateTime||0;return e-t>a}function Ua(a,s){return vi.search(a,function(i){return i.cc<s?1:i.cc>s?-1:0})}function _t(a){switch(a.details){case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_TIMEOUT:case C.LEVEL_LOAD_TIMEOUT:case C.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function mi(a,s){var i=_t(s);return a.default[(i?"timeout":"error")+"Retry"]}function sr(a,s){var i=a.backoff==="linear"?1:Math.pow(2,s);return Math.min(i*a.retryDelayMs,a.maxRetryDelayMs)}function pi(a){return be(be({},a),{errorRetry:null,timeoutRetry:null})}function It(a,s,i,t){if(!a)return!1;var e=t==null?void 0:t.code,r=s<a.maxNumRetry&&(Ga(e)||!!i);return a.shouldRetry?a.shouldRetry(a,s,i,t,r):r}function Ga(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}var xe={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ne={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},Ha=function(a){function s(t){var e;return e=a.call(this,"error-controller",t.logger)||this,e.hls=void 0,e.playlistError=0,e.penalizedRenditions={},e.hls=t,e.registerListeners(),e}he(s,a);var i=s.prototype;return i.registerListeners=function(){var e=this.hls;e.on(E.ERROR,this.onError,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)},i.unregisterListeners=function(){var e=this.hls;e&&(e.off(E.ERROR,this.onError,this),e.off(E.ERROR,this.onErrorOut,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this))},i.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},i.startLoad=function(e){},i.stopLoad=function(){this.playlistError=0},i.getVariantLevelIndex=function(e){return(e==null?void 0:e.type)===q.MAIN?e.level:this.hls.loadLevel},i.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},i.onLevelUpdated=function(){this.playlistError=0},i.onError=function(e,r){var n;if(!r.fatal){var o=this.hls,l=r.context;switch(r.details){case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:r.errorAction=this.getFragRetryOrSwitchAction(r);return;case C.FRAG_PARSING_ERROR:if((n=r.frag)!=null&&n.gap){r.errorAction=Dt();return}case C.FRAG_GAP:case C.FRAG_DECRYPT_ERROR:{r.errorAction=this.getFragRetryOrSwitchAction(r),r.errorAction.action=xe.SendAlternateToPenaltyBox;return}case C.LEVEL_EMPTY_ERROR:case C.LEVEL_PARSING_ERROR:{var u,f,d=r.parent===q.MAIN?r.level:o.loadLevel;r.details===C.LEVEL_EMPTY_ERROR&&((u=r.context)!=null&&(f=u.levelDetails)!=null&&f.live)?r.errorAction=this.getPlaylistRetryOrSwitchAction(r,d):(r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,d))}return;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(r.errorAction=this.getPlaylistRetryOrSwitchAction(r,l.level));return;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.SUBTITLE_LOAD_ERROR:case C.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){var h=o.loadLevelObj;if(h&&(l.type===J.AUDIO_TRACK&&h.hasAudioGroup(l.groupId)||l.type===J.SUBTITLE_TRACK&&h.hasSubtitleGroup(l.groupId))){r.errorAction=this.getPlaylistRetryOrSwitchAction(r,o.loadLevel),r.errorAction.action=xe.SendAlternateToPenaltyBox,r.errorAction.flags=Ne.MoveAllAlternatesMatchingHost;return}}return;case C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var v=o.loadLevelObj,c=v==null?void 0:v.attrs["HDCP-LEVEL"];c?r.errorAction={action:xe.SendAlternateToPenaltyBox,flags:Ne.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(r)}return;case C.BUFFER_ADD_CODEC_ERROR:case C.REMUX_ALLOC_ERROR:case C.BUFFER_APPEND_ERROR:if(!r.errorAction){var g;r.errorAction=this.getLevelSwitchAction(r,(g=r.level)!=null?g:o.loadLevel)}return;case C.INTERNAL_EXCEPTION:case C.BUFFER_APPENDING_ERROR:case C.BUFFER_FULL_ERROR:case C.LEVEL_SWITCH_ERROR:case C.BUFFER_STALLED_ERROR:case C.BUFFER_SEEK_OVER_HOLE:case C.BUFFER_NUDGE_ON_STALL:r.errorAction=Dt();return}r.type===Y.KEY_SYSTEM_ERROR&&this.keySystemError(r)}},i.keySystemError=function(e){var r=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,r)},i.getPlaylistRetryOrSwitchAction=function(e,r){var n=this.hls,o=mi(n.config.playlistLoadPolicy,e),l=this.playlistError++,u=It(o,l,_t(e),e.response);if(u)return{action:xe.RetryRequest,flags:Ne.None,retryConfig:o,retryCount:l};var f=this.getLevelSwitchAction(e,r);return o&&(f.retryConfig=o,f.retryCount=l),f},i.getFragRetryOrSwitchAction=function(e){var r=this.hls,n=this.getVariantLevelIndex(e.frag),o=r.levels[n],l=r.config,u=l.fragLoadPolicy,f=l.keyLoadPolicy,d=mi(e.details.startsWith("key")?f:u,e),h=r.levels.reduce(function(g,m){return g+m.fragmentError},0);if(o){e.details!==C.FRAG_GAP&&o.fragmentError++;var v=It(d,h,_t(e),e.response);if(v)return{action:xe.RetryRequest,flags:Ne.None,retryConfig:d,retryCount:h}}var c=this.getLevelSwitchAction(e,n);return d&&(c.retryConfig=d,c.retryCount=h),c},i.getLevelSwitchAction=function(e,r){var n=this.hls;r==null&&(r=n.loadLevel);var o=this.hls.levels[r];if(o){var l,u,f=e.details;o.loadError++,f===C.BUFFER_APPEND_ERROR&&o.fragmentError++;var d=-1,h=n.levels,v=n.loadLevel,c=n.minAutoLevel,g=n.maxAutoLevel;n.autoLevelEnabled||(n.loadLevel=-1);for(var m=(l=e.frag)==null?void 0:l.type,p=m===q.AUDIO&&f===C.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===C.BUFFER_ADD_CODEC_ERROR||f===C.BUFFER_APPEND_ERROR),y=p&&h.some(function(b){var I=b.audioCodec;return o.audioCodec!==I}),S=e.sourceBufferName==="video"&&(f===C.BUFFER_ADD_CODEC_ERROR||f===C.BUFFER_APPEND_ERROR),T=S&&h.some(function(b){var I=b.codecSet,k=b.audioCodec;return o.codecSet!==I&&o.audioCodec===k}),x=(u=e.context)!=null?u:{},A=x.type,L=x.groupId,R=function(){var I=(_+v)%h.length;if(I!==v&&I>=c&&I<=g&&h[I].loadError===0){var k,w,O=h[I];if(f===C.FRAG_GAP&&m===q.MAIN&&e.frag){var P=h[I].details;if(P){var N=ar(e.frag,P.fragments,e.frag.start);if(N!=null&&N.gap)return 0}}else{if(A===J.AUDIO_TRACK&&O.hasAudioGroup(L)||A===J.SUBTITLE_TRACK&&O.hasSubtitleGroup(L))return 0;if(m===q.AUDIO&&(k=o.audioGroups)!=null&&k.some(function(G){return O.hasAudioGroup(G)})||m===q.SUBTITLE&&(w=o.subtitleGroups)!=null&&w.some(function(G){return O.hasSubtitleGroup(G)})||y&&o.audioCodec===O.audioCodec||!y&&o.audioCodec!==O.audioCodec||T&&o.codecSet===O.codecSet)return 0}return d=I,1}},D,_=h.length;_--&&(D=R(),!(D!==0&&D===1)););if(d>-1&&n.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:xe.SendAlternateToPenaltyBox,flags:Ne.None,nextAutoLevel:d}}return{action:xe.SendAlternateToPenaltyBox,flags:Ne.MoveAllAlternatesMatchingHost}},i.onErrorOut=function(e,r){var n;switch((n=r.errorAction)==null?void 0:n.action){case xe.DoNothing:break;case xe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(r),!r.errorAction.resolved&&r.details!==C.FRAG_GAP?r.fatal=!0:/MediaSource readyState: ended/.test(r.error.message)&&(this.warn('MediaSource ended after "'+r.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(r.fatal){this.hls.stopLoad();return}},i.sendAlternateToPenaltyBox=function(e){var r=this.hls,n=e.errorAction;if(n){var o=n.flags,l=n.hdcpLevel,u=n.nextAutoLevel;switch(o){case Ne.None:this.switchLevel(e,u);break;case Ne.MoveAllAlternatesMatchingHDCP:l&&(r.maxHdcpLevel=nr[nr.indexOf(l)-1],n.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+r.maxHdcpLevel+'" or lower');break}n.resolved||this.switchLevel(e,u)}},i.switchLevel=function(e,r){if(r!==void 0&&e.errorAction&&(this.warn("switching to level "+r+" after "+e.details),this.hls.nextAutoLevel=r,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===C.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo"))for(var n=oi(e.mimeType),o=this.hls.levels,l=o.length;l--;)o[l][e.sourceBufferName+"Codec"]===n&&this.hls.removeLevel(l)},s}(tt);function Dt(a){var s={action:xe.DoNothing,flags:Ne.None};return a&&(s.resolved=!0),s}var Ei={length:0,start:function(){return 0},end:function(){return 0}},ae=function(){function a(){}return a.isBuffered=function(i,t){if(i){for(var e=a.getBuffered(i),r=e.length;r--;)if(t>=e.start(r)&&t<=e.end(r))return!0}return!1},a.bufferedRanges=function(i){if(i){var t=a.getBuffered(i);return a.timeRangesToArray(t)}return[]},a.timeRangesToArray=function(i){for(var t=[],e=0;e<i.length;e++)t.push({start:i.start(e),end:i.end(e)});return t},a.bufferInfo=function(i,t,e){if(i){var r=a.bufferedRanges(i);if(r.length)return a.bufferedInfo(r,t,e)}return{len:0,start:t,end:t,bufferedIndex:-1}},a.bufferedInfo=function(i,t,e){t=Math.max(0,t),i.length>1&&i.sort(function(p,y){return p.start-y.start||y.end-p.end});var r=-1,n=[];if(e)for(var o=0;o<i.length;o++){t>=i[o].start&&t<=i[o].end&&(r=o);var l=n.length;if(l){var u=n[l-1].end;i[o].start-u<e?i[o].end>u&&(n[l-1].end=i[o].end):n.push(i[o])}else n.push(i[o])}else n=i;for(var f=0,d,h=t,v=t,c=0;c<n.length;c++){var g=n[c].start,m=n[c].end;if(r===-1&&t>=g&&t<=m&&(r=c),t+e>=g&&t<m)h=g,v=m,f=v-t;else if(t+e<g){d=g;break}}return{len:f,start:h||0,end:v||0,nextStart:d,buffered:i,bufferedIndex:r}},a.getBuffered=function(i){try{return i.buffered||Ei}catch(t){return te.log("failed to get media.buffered",t),Ei}},a}(),yi=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ti="HlsJsTrackRemovedError",Va=function(a){function s(i){var t;return t=a.call(this,i)||this,t.name=Ti,t}return he(s,a),s}(ft(Error)),Ka=function(a){function s(t,e){var r;return r=a.call(this,"buffer-controller",t.logger)||this,r.hls=void 0,r.fragmentTracker=void 0,r.details=null,r._objectUrl=null,r.operationQueue=null,r.bufferCodecEventsTotal=0,r.media=null,r.mediaSource=null,r.lastMpegAudioChunk=null,r.blockedAudioAppend=null,r.lastVideoAppendEnd=0,r.appendSource=void 0,r.transferData=void 0,r.overrides=void 0,r.appendErrors={audio:0,video:0,audiovideo:0},r.tracks={},r.sourceBuffers=[[null,null],[null,null]],r._onEndStreaming=function(n){var o;r.hls&&((o=r.mediaSource)==null?void 0:o.readyState)==="open"&&r.hls.pauseBuffering()},r._onStartStreaming=function(n){r.hls&&r.hls.resumeBuffering()},r._onMediaSourceOpen=function(n){var o=r,l=o.media,u=o.mediaSource;n&&r.log("Media source opened"),!(!l||!u)&&(u.removeEventListener("sourceopen",r._onMediaSourceOpen),l.removeEventListener("emptied",r._onMediaEmptied),r.updateDuration(),r.hls.trigger(E.MEDIA_ATTACHED,{media:l,mediaSource:u}),r.mediaSource!==null&&r.checkPendingTracks())},r._onMediaSourceClose=function(){r.log("Media source closed")},r._onMediaSourceEnded=function(){r.log("Media source ended")},r._onMediaEmptied=function(){var n=r,o=n.mediaSrc,l=n._objectUrl;o!==l&&r.error("Media element src was set while attaching MediaSource ("+l+" > "+o+")")},r.hls=t,r.fragmentTracker=e,r.appendSource=Ta(ze(t.config.preferManagedMediaSource)),r.initTracks(),r.registerListeners(),r}he(s,a);var i=s.prototype;return i.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},i.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},i.registerListeners=function(){var e=this.hls;e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_APPENDING,this.onBufferAppending,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.BUFFER_EOS,this.onBufferEos,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(E.FRAG_PARSED,this.onFragParsed,this),e.on(E.FRAG_CHANGED,this.onFragChanged,this),e.on(E.ERROR,this.onError,this)},i.unregisterListeners=function(){var e=this.hls;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_APPENDING,this.onBufferAppending,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.BUFFER_EOS,this.onBufferEos,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(E.FRAG_PARSED,this.onFragParsed,this),e.off(E.FRAG_CHANGED,this.onFragChanged,this),e.off(E.ERROR,this.onError,this)},i.transferMedia=function(){var e=this,r=this.media,n=this.mediaSource;if(!r)return null;var o={};if(this.operationQueue){var l=this.isUpdating();l||this.operationQueue.removeBlockers();var u=this.isQueued();(l||u)&&this.warn("Transfering MediaSource with"+(u?" operations in queue":"")+(l?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var f=this.transferData;return!this.sourceBufferCount&&f&&f.mediaSource===n?ee(o,f.tracks):this.sourceBuffers.forEach(function(d){var h=d[0];h&&(o[h]=ee({},e.tracks[h]),e.removeBuffer(h)),d[0]=d[1]=null}),{media:r,mediaSource:n,tracks:o}},i.initTracks=function(){var e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},i.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},i.onManifestParsed=function(e,r){var n,o=2;(r.audio&&!r.video||!r.altAudio)&&(o=1),this.bufferCodecEventsTotal=o,this.log(o+" bufferCodec event(s) expected."),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&o&&this.bufferCreated()},i.onMediaAttaching=function(e,r){var n=this.media=r.media,o=ze(this.appendSource);if(this.transferData=this.overrides=void 0,n&&o){var l=!!r.mediaSource;(l||r.overrides)&&(this.transferData=r,this.overrides=r.overrides);var u=this.mediaSource=r.mediaSource||new o;if(this.assignMediaSource(u),l)this._objectUrl=n.src,this.attachTransferred();else{var f=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{n.removeAttribute("src");var d=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||d&&u instanceof d,Si(n),Wa(n,f),n.load()}catch{n.src=f}else n.src=f}n.addEventListener("emptied",this._onMediaEmptied)}},i.assignMediaSource=function(e){var r,n;this.log((((r=this.transferData)==null?void 0:r.mediaSource)===e?"transferred":"created")+" media source: "+((n=e.constructor)==null?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))},i.attachTransferred=function(){var e=this,r=this.media,n=this.transferData;if(!(!n||!r)){var o=this.tracks,l=n.tracks,u=l?Object.keys(l):null,f=u?u.length:0,d=function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()};if(l&&u&&f){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+Ae(o,function(g,m){return g==="initSegment"?void 0:m})+`;
transfer tracks: `+Ae(l,function(g,m){return g==="initSegment"?void 0:m})+"}"),!Sa(l,o)){n.mediaSource=null,n.tracks=void 0;var h=r.currentTime,v=this.details,c=Math.max(h,(v==null?void 0:v.fragments[0].start)||0);if(c-h>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+c);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(l)+'"->"'+Object.keys(o)+'") start time: '+c+" currentTime: "+h),this.onMediaDetaching(E.MEDIA_DETACHING,{}),this.onMediaAttaching(E.MEDIA_ATTACHING,n),r.currentTime=c;return}this.transferData=void 0,u.forEach(function(g){var m=g,p=l[m];if(p){var y=p.buffer;if(y){var S=e.fragmentTracker,T=p.id;if(S.hasFragments(T)||S.hasParts(T)){var x=ae.getBuffered(y);S.detectEvictedFragments(m,x,T,null,!0)}var A=or(m),L=[m,y];e.sourceBuffers[A]=L,y.updating&&e.operationQueue&&e.operationQueue.prependBlocker(m),e.trackSourceBuffer(m,p)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},i.onMediaDetaching=function(e,r){var n=this,o=!!r.transferMedia;this.transferData=this.overrides=void 0;var l=this.media,u=this.mediaSource,f=this._objectUrl;if(u){if(this.log("media source "+(o?"transferring":"detaching")),o)this.sourceBuffers.forEach(function(c){var g=c[0];g&&n.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=u.readyState==="open";try{for(var h=u.sourceBuffers,v=h.length;v--;)d&&h[v].abort(),u.removeSourceBuffer(h[v]);d&&u.endOfStream()}catch(c){this.warn("onMediaDetaching: "+c.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(u.removeEventListener("startstreaming",this._onStartStreaming),u.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}l&&(l.removeEventListener("emptied",this._onMediaEmptied),o||(f&&self.URL.revokeObjectURL(f),this.mediaSrc===f?(l.removeAttribute("src"),this.appendSource&&Si(l),l.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(E.MEDIA_DETACHED,r)},i.onBufferReset=function(){var e=this;this.sourceBuffers.forEach(function(r){var n=r[0];n&&e.resetBuffer(n)}),this.initTracks()},i.resetBuffer=function(e){var r,n=(r=this.tracks[e])==null?void 0:r.buffer;if(this.removeBuffer(e),n)try{var o;(o=this.mediaSource)!=null&&o.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(l){this.warn("onBufferReset "+e,l)}delete this.tracks[e]},i.removeBuffer=function(e){this.removeBufferListeners(e),this.sourceBuffers[or(e)]=[null,null];var r=this.tracks[e];r&&(r.buffer=void 0)},i.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new wa(this.tracks)},i.onBufferCodecs=function(e,r){var n=this,o=this.tracks,l=Object.keys(r);this.log('BUFFER_CODECS: "'+l+'" (current SB count '+this.sourceBufferCount+")");var u="audiovideo"in r&&(o.audio||o.video)||o.audiovideo&&("audio"in r||"video"in r),f=!u&&this.sourceBufferCount&&this.media&&l.some(function(d){return!o[d]});if(u||f){this.warn('Unsupported transition between "'+Object.keys(o)+'" and "'+l+'" SourceBuffers');return}l.forEach(function(d){var h,v,c,g=r[d],m=g.id,p=g.codec,y=g.levelCodec,S=g.container,T=g.metadata,x=g.supplemental,A=o[d],L=(h=n.transferData)==null||(v=h.tracks)==null?void 0:v[d],R=L!=null&&L.buffer?L:A,D=(R==null?void 0:R.pendingCodec)||(R==null?void 0:R.codec),_=R==null?void 0:R.levelCodec;A||(A=o[d]={buffer:void 0,listeners:[],codec:p,supplemental:x,container:S,levelCodec:y,metadata:T,id:m});var b=At(D,_),I=b==null?void 0:b.replace(yi,"$1"),k=At(p,y),w=(c=k)==null?void 0:c.replace(yi,"$1");k&&b&&I!==w&&(d.slice(0,5)==="audio"&&(k=Lt(k,n.appendSource)),n.log("switching codec "+D+" to "+k),k!==(A.pendingCodec||A.codec)&&(A.pendingCodec=k),A.container=S,n.appendChangeType(d,S,k))}),(this.tracksReady||this.sourceBufferCount)&&(r.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},i.appendChangeType=function(e,r,n){var o=this,l=r+";codecs="+n,u={label:"change-type="+l,execute:function(){var d=o.tracks[e];if(d){var h=d.buffer;h!=null&&h.changeType&&(o.log("changing "+e+" sourceBuffer type to "+l),h.changeType(l),d.codec=n,d.container=r)}o.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){o.warn("Failed to change "+e+" SourceBuffer type",d)}};this.append(u,e,this.isPending(this.tracks[e]))},i.blockAudio=function(e){var r,n=this,o=e.start,l=o+e.duration*.05,u=((r=this.fragmentTracker.getAppendedFrag(o,q.MAIN))==null?void 0:r.gap)===!0;if(!u){var f={label:"block-audio",execute:function(){var h,v=n.tracks.video;(n.lastVideoAppendEnd>l||v!=null&&v.buffer&&ae.isBuffered(v.buffer,l)||((h=n.fragmentTracker.getAppendedFrag(l,q.MAIN))==null?void 0:h.gap)===!0)&&(n.blockedAudioAppend=null,n.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(h){n.warn("Error executing block-audio operation",h)}};this.blockedAudioAppend={op:f,frag:e},this.append(f,"audio",!0)}},i.unblockAudio=function(){var e=this.blockedAudioAppend,r=this.operationQueue;e&&r&&(this.blockedAudioAppend=null,r.unblockAudio(e.op))},i.onBufferAppending=function(e,r){var n=this,o=this.tracks,l=r.data,u=r.type,f=r.parent,d=r.frag,h=r.part,v=r.chunkMeta,c=v.buffering[u],g=d.sn,m=self.performance.now();c.start=m;var p=d.stats.buffering,y=h?h.stats.buffering:null;p.start===0&&(p.start=m),y&&y.start===0&&(y.start=m);var S=o.audio,T=!1;u==="audio"&&(S==null?void 0:S.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||v.id===1||this.lastMpegAudioChunk.sn!==v.sn,this.lastMpegAudioChunk=v);var x=this.tracks.video,A=x==null?void 0:x.buffer;if(A&&g!=="initSegment"){var L=h||d,R=this.blockedAudioAppend;if(u==="audio"&&f!=="main"&&!this.blockedAudioAppend){var D=L.start,_=D+L.duration*.05,b=A.buffered,I=this.currentOp("video");!b.length&&!I?this.blockAudio(L):!I&&!ae.isBuffered(A,_)&&this.lastVideoAppendEnd<_&&this.blockAudio(L)}else if(u==="video"){var k=L.end;if(R){var w=R.frag.start;(k>w||k<this.lastVideoAppendEnd||ae.isBuffered(A,w))&&this.unblockAudio()}this.lastVideoAppendEnd=k}}var O=(h||d).start,P={label:"append-"+u,execute:function(){if(c.executeStart=self.performance.now(),T){var G=n.tracks[u];if(G){var F=G.buffer;if(F){var V=O-F.timestampOffset;Math.abs(V)>=.1&&(n.log("Updating audio SourceBuffer timestampOffset to "+O+" (delta: "+V+") sn: "+g+")"),F.timestampOffset=O)}}}n.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var G=self.performance.now();c.executeEnd=c.end=G,p.first===0&&(p.first=G),y&&y.first===0&&(y.first=G);var F={};n.sourceBuffers.forEach(function(V){var ie=V[0],j=V[1];ie&&(F[ie]=ae.getBuffered(j))}),n.appendErrors[u]=0,u==="audio"||u==="video"?n.appendErrors.audiovideo=0:(n.appendErrors.audio=0,n.appendErrors.video=0),n.hls.trigger(E.BUFFER_APPENDED,{type:u,frag:d,part:h,chunkMeta:v,parent:d.type,timeRanges:F})},onError:function(G){var F,V={type:Y.MEDIA_ERROR,parent:d.type,details:C.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:d,part:h,chunkMeta:v,error:G,err:G,fatal:!1},ie=(F=n.media)==null?void 0:F.error;if(G.code===DOMException.QUOTA_EXCEEDED_ERR)V.details=C.BUFFER_FULL_ERROR;else if(G.code===DOMException.INVALID_STATE_ERR&&n.mediaSourceOpenOrEnded&&!ie)V.errorAction=Dt(!0);else if(G.name===Ti&&n.sourceBufferCount===0)V.errorAction=Dt(!0);else{var j=++n.appendErrors[u];n.warn("Failed "+j+"/"+n.hls.config.appendErrorMaxRetry+' times to append segment in "'+u+'" sourceBuffer ('+(ie||"no media error")+")"),(j>=n.hls.config.appendErrorMaxRetry||ie)&&(V.fatal=!0)}n.hls.trigger(E.ERROR,V)}};this.append(P,u,this.isPending(this.tracks[u]))},i.getFlushOp=function(e,r,n){var o=this;return this.log('queuing "'+e+'" remove '+r+"-"+n),{label:"remove",execute:function(){o.removeExecutor(e,r,n)},onStart:function(){},onComplete:function(){o.hls.trigger(E.BUFFER_FLUSHED,{type:e})},onError:function(u){o.warn("Failed to remove "+r+"-"+n+' from "'+e+'" SourceBuffer',u)}}},i.onBufferFlushing=function(e,r){var n=this,o=r.type,l=r.startOffset,u=r.endOffset;o?this.append(this.getFlushOp(o,l,u),o):this.sourceBuffers.forEach(function(f){var d=f[0];d&&n.append(n.getFlushOp(d,l,u),d)})},i.onFragParsed=function(e,r){var n=this,o=r.frag,l=r.part,u=[],f=l?l.elementaryStreams:o.elementaryStreams;f[fe.AUDIOVIDEO]?u.push("audiovideo"):(f[fe.AUDIO]&&u.push("audio"),f[fe.VIDEO]&&u.push("video"));var d=function(){var v=self.performance.now();o.stats.buffering.end=v,l&&(l.stats.buffering.end=v);var c=l?l.stats:o.stats;n.hls.trigger(E.FRAG_BUFFERED,{frag:o,part:l,stats:c,id:o.type})};u.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+o.type+" level: "+o.level+" sn: "+o.sn),this.blockBuffers(d,u).catch(function(h){n.warn("Fragment buffered callback "+h),n.stepOperationQueue(n.sourceBufferTypes)})},i.onFragChanged=function(e,r){this.trimBuffers()},i.onBufferEos=function(e,r){var n=this,o;this.sourceBuffers.forEach(function(f){var d=f[0];if(d){var h=n.tracks[d];(!r.type||r.type===d)&&(h.ending=!0,h.ended||(h.ended=!0,n.log(d+" buffer reached EOS")))}});var l=((o=this.overrides)==null?void 0:o.endOfStream)!==!1,u=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(f){var d,h=f[0];return h&&!((d=n.tracks[h])!=null&&d.ended)});u&&(l?(this.log("Queueing EOS"),this.blockUntilOpen(function(){n.tracksEnded();var f=n.mediaSource;if(!f||f.readyState!=="open"){f&&n.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+f.readyState);return}n.log("Calling mediaSource.endOfStream()"),f.endOfStream(),n.hls.trigger(E.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(E.BUFFERED_TO_END,void 0)))},i.tracksEnded=function(){var e=this;this.sourceBuffers.forEach(function(r){var n=r[0];if(n!==null){var o=e.tracks[n];o&&(o.ending=!1)}})},i.onLevelUpdated=function(e,r){var n=r.details;n.fragments.length&&(this.details=n,this.updateDuration())},i.updateDuration=function(){var e=this,r=this.getDurationAndRange();r&&this.blockUntilOpen(function(){return e.updateMediaSource(r)})},i.onError=function(e,r){if(r.details===C.BUFFER_APPEND_ERROR&&r.frag){var n,o=(n=r.errorAction)==null?void 0:n.nextAutoLevel;U(o)&&o!==r.frag.level&&this.resetAppendErrors()}},i.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},i.trimBuffers=function(){var e=this.hls,r=this.details,n=this.media;if(!(!n||r===null)&&this.sourceBufferCount){var o=e.config,l=n.currentTime,u=r.levelTargetDuration,f=r.live&&o.liveBackBufferLength!==null?o.liveBackBufferLength:o.backBufferLength;if(U(f)&&f>=0){var d=Math.max(f,u),h=Math.floor(l/u)*u-d;this.flushBackBuffer(l,u,h)}if(U(o.frontBufferFlushThreshold)&&o.frontBufferFlushThreshold>0){var v=Math.max(o.maxBufferLength,o.frontBufferFlushThreshold),c=Math.max(v,u),g=Math.floor(l/u)*u+c;this.flushFrontBuffer(l,u,g)}}},i.flushBackBuffer=function(e,r,n){var o=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=ae.getBuffered(f);if(d.length>0&&n>d.start(0)){var h;o.hls.trigger(E.BACK_BUFFER_REACHED,{bufferEnd:n});var v=o.tracks[u];if((h=o.details)!=null&&h.live)o.hls.trigger(E.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(v!=null&&v.ended){o.log("Cannot flush "+u+" back buffer while SourceBuffer is in ended state");return}o.hls.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:u})}}})},i.flushFrontBuffer=function(e,r,n){var o=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=ae.getBuffered(f),h=d.length;if(h<2)return;var v=d.start(h-1),c=d.end(h-1);if(n>v||e>=v&&e<=c)return;o.hls.trigger(E.BUFFER_FLUSHING,{startOffset:v,endOffset:1/0,type:u})}})},i.getDurationAndRange=function(){var e,r=this.details,n=this.mediaSource;if(!r||!this.media||(n==null?void 0:n.readyState)!=="open")return null;var o=r.edge;if(r.live&&this.hls.config.liveDurationInfinity){var l=r.fragments.length;if(l&&r.live&&n.setLiveSeekableRange){var u=Math.max(0,r.fragmentStart),f=Math.max(u,o);return{duration:1/0,start:u,end:f}}return{duration:1/0}}var d=(e=this.overrides)==null?void 0:e.duration;if(d)return U(d)?{duration:d}:null;var h=this.media.duration,v=U(n.duration)?n.duration:0;return o>v&&o>h||!U(h)?{duration:o}:null},i.updateMediaSource=function(e){var r=e.duration,n=e.start,o=e.end,l=this.mediaSource;!this.media||!l||l.readyState!=="open"||(l.duration!==r&&(U(r)&&this.log("Updating MediaSource duration to "+r.toFixed(3)),l.duration=r),n!==void 0&&o!==void 0&&(this.log("MediaSource duration is set to "+l.duration+". Setting seekable range to "+n+"-"+o+"."),l.setLiveSeekableRange(n,o)))},i.checkPendingTracks=function(){var e=this.bufferCodecEventsTotal,r=this.pendingTrackCount,n=this.tracks;if(this.log("checkPendingTracks (pending: "+r+" codec events expected: "+e+") "+Ae(n)),this.tracksReady){var o,l=(o=this.transferData)==null?void 0:o.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}},i.bufferCreated=function(){var e=this;if(this.sourceBufferCount){var r={};this.sourceBuffers.forEach(function(o){var l=o[0],u=o[1];if(l){var f=e.tracks[l];r[l]={buffer:u,container:f.container,codec:f.codec,supplemental:f.supplemental,levelCodec:f.levelCodec,id:f.id,metadata:f.metadata}}}),this.hls.trigger(E.BUFFER_CREATED,{tracks:r}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(o){var l=o[0];e.executeNext(l)})}else{var n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}},i.createSourceBuffers=function(){var e=this.tracks,r=this.sourceBuffers,n=this.mediaSource;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(var o in e){var l=o,u=e[l];if(this.isPending(u)){var f=this.getTrackCodec(u,l),d=u.container+";codecs="+f;u.codec=f,this.log("creating sourceBuffer("+d+")"+(this.currentOp(l)?" Queued":"")+" "+Ae(u));try{var h=n.addSourceBuffer(d),v=or(l),c=[l,h];r[v]=c,u.buffer=h}catch(m){var g;this.error("error while trying to add sourceBuffer: "+m.message),this.shiftAndExecuteNext(l),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[l],this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:l,mimeType:d,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()},i.getTrackCodec=function(e,r){var n=e.supplemental,o=e.codec;n&&(r==="video"||r==="audiovideo")&&rr(n,"video")&&(o=Aa(o,n));var l=At(o,e.levelCodec);return l?r.slice(0,5)==="audio"?Lt(l,this.appendSource):l:""},i.trackSourceBuffer=function(e,r){var n=this,o=r.buffer;if(o){var l=this.getTrackCodec(r,e);this.tracks[e]={buffer:o,codec:l,container:r.container,levelCodec:r.levelCodec,supplemental:r.supplemental,metadata:r.metadata,id:r.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(u,f){var d=f.removedRanges;d!=null&&d.length&&n.hls.trigger(E.BUFFER_FLUSHED,{type:u})})}},i.onSBUpdateStart=function(e){var r=this.currentOp(e);r&&r.onStart()},i.onSBUpdateEnd=function(e){var r;if(((r=this.mediaSource)==null?void 0:r.readyState)==="closed"){this.resetBuffer(e);return}var n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))},i.onSBUpdateError=function(e,r){var n,o=new Error(e+" SourceBuffer error. MediaSource readyState: "+((n=this.mediaSource)==null?void 0:n.readyState));this.error(""+o,r),this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:o,fatal:!1});var l=this.currentOp(e);l&&l.onError(o)},i.removeExecutor=function(e,r,n){var o=this.media,l=this.mediaSource,u=this.tracks[e],f=u==null?void 0:u.buffer;if(!o||!l||!f){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(e);return}var d=U(o.duration)?o.duration:1/0,h=U(l.duration)?l.duration:1/0,v=Math.max(0,r),c=Math.min(n,d,h);c>v&&(!u.ending||u.ended)?(u.ended=!1,this.log("Removing ["+v+","+c+"] from the "+e+" SourceBuffer"),f.remove(v,c)):this.shiftAndExecuteNext(e)},i.appendExecutor=function(e,r){var n=this.tracks[r],o=n==null?void 0:n.buffer;if(!o)throw new Va("Attempting to append to the "+r+" SourceBuffer, but it does not exist");n.ending=!1,n.ended=!1,o.appendBuffer(e)},i.blockUntilOpen=function(e){var r=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(n){r.warn("SourceBuffer blocked callback "+n),r.stepOperationQueue(r.sourceBufferTypes)});else try{e()}catch(n){this.warn("Callback run without blocking "+this.operationQueue+" "+n)}},i.isUpdating=function(){return this.sourceBuffers.some(function(e){var r=e[0],n=e[1];return r&&n.updating})},i.isQueued=function(){var e=this;return this.sourceBuffers.some(function(r){var n=r[0];return n&&!!e.currentOp(n)})},i.isPending=function(e){return!!e&&!e.buffer},i.blockBuffers=function(e,r){var n=this;if(r===void 0&&(r=this.sourceBufferTypes),!r.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var o=this.operationQueue,l=r.map(function(f){return n.appendBlocker(f)}),u=r.length>1&&!!this.blockedAudioAppend;return u&&this.unblockAudio(),Promise.all(l).then(function(f){o===n.operationQueue&&(e(),n.stepOperationQueue(n.sourceBufferTypes))})},i.stepOperationQueue=function(e){var r=this;e.forEach(function(n){var o,l=(o=r.tracks[n])==null?void 0:o.buffer;!l||l.updating||r.shiftAndExecuteNext(n)})},i.append=function(e,r,n){this.operationQueue&&this.operationQueue.append(e,r,n)},i.appendBlocker=function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)},i.currentOp=function(e){return this.operationQueue?this.operationQueue.current(e):null},i.executeNext=function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)},i.shiftAndExecuteNext=function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)},i.addBufferListener=function(e,r,n){var o=this.tracks[e];if(o){var l=o.buffer;if(l){var u=n.bind(this,e);o.listeners.push({event:r,listener:u}),l.addEventListener(r,u)}}},i.removeBufferListeners=function(e){var r=this.tracks[e];if(r){var n=r.buffer;n&&(r.listeners.forEach(function(o){n.removeEventListener(o.event,o.listener)}),r.listeners.length=0)}},Z(s,[{key:"mediaSourceOpenOrEnded",get:function(){var e,r=(e=this.mediaSource)==null?void 0:e.readyState;return r==="open"||r==="ended"}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(r,n){var o=e.tracks[n];return r[n]={id:o.id,container:o.container,codec:o.codec,levelCodec:o.levelCodec},r},{})}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(r){var n,o,l=r[0];return l&&(!((n=e.tracks[l])!=null&&n.ended)||((o=e.tracks[l])==null?void 0:o.ending))})}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var e,r,n=((e=this.media)==null||(r=e.querySelector)==null?void 0:r.call(e,"source"))||this.media;return n==null?void 0:n.src}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(r,n){return r+(e.isPending(e.tracks[n])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,r){var n=r[0];return e+(n?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){var r=e[0];return r}).filter(function(e){return!!e})}}])}(tt);function Si(a){var s=a.querySelectorAll("source");[].slice.call(s).forEach(function(i){a.removeChild(i)})}function Wa(a,s){var i=self.document.createElement("source");i.type="video/mp4",i.src=s,a.appendChild(i)}function or(a){return a==="audio"?1:0}var Ya=function(){function a(i){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var s=a.prototype;return s.setStreamController=function(t){this.streamController=t},s.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},s.registerListeners=function(){var t=this.hls;t.on(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.MANIFEST_PARSED,this.onManifestParsed,this),t.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(E.BUFFER_CODECS,this.onBufferCodecs,this),t.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)},s.unregisterListener=function(){var t=this.hls;t.off(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.MANIFEST_PARSED,this.onManifestParsed,this),t.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(E.BUFFER_CODECS,this.onBufferCodecs,this),t.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)},s.onFpsDropLevelCapping=function(t,e){var r=this.hls.levels[e.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},s.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},s.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onLevelsUpdated=function(t,e){this.timer&&U(this.autoLevelCapping)&&this.detectPlayerSize()},s.onBufferCodecs=function(t,e){var r=this.hls;r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onMediaDetaching=function(){this.stopCapping(),this.media=null},s.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var t=this.hls.levels;if(t.length){var e=this.hls,r=this.getMaxLevel(t.length-1);r!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to "+r+": "+t[r].height+"p@"+t[r].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=r,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},s.getMaxLevel=function(t){var e=this,r=this.hls.levels;if(!r.length)return-1;var n=r.filter(function(o,l){return e.isLevelAllowed(o)&&l<=t});return this.clientRect=null,a.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,!e.width&&!e.height&&(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e},s.isLevelAllowed=function(t){var e=this.restrictedLevels;return!e.some(function(r){return t.bitrate===r.bitrate&&t.width===r.width&&t.height===r.height})},a.getMaxLevelByMediaSize=function(t,e,r){if(!(t!=null&&t.length))return-1;for(var n=function(h,v){return v?h.width!==v.width||h.height!==v.height:!0},o=t.length-1,l=Math.max(e,r),u=0;u<t.length;u+=1){var f=t[u];if((f.width>=l||f.height>=l)&&n(f,t[u+1])){o=u;break}}return o},Z(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}}])}(),qa=/^(\d+)x(\d+)$/,xi=/(.+?)=(".*?"|.*?)(?:,|$)/g,ge=function(){function a(i,t){typeof i=="string"&&(i=a.parseAttrList(i,t)),ee(this,i)}var s=a.prototype;return s.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},s.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var r=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)r[n]=parseInt(e.slice(n*2,n*2+2),16);return r}return null},s.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},s.decimalFloatingPoint=function(t){return parseFloat(this[t])},s.optionalFloat=function(t,e){var r=this[t];return r?parseFloat(r):e},s.enumeratedString=function(t){return this[t]},s.enumeratedStringList=function(t,e){var r=this[t];return(r?r.split(/[ ,]+/):[]).reduce(function(n,o){return n[o.toLowerCase()]=!0,n},e)},s.bool=function(t){return this[t]==="YES"},s.decimalResolution=function(t){var e=qa.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},a.parseAttrList=function(t,e){var r,n={},o='"';for(xi.lastIndex=0;(r=xi.exec(t))!==null;){var l=r[1].trim(),u=r[2],f=u.indexOf(o)===0&&u.lastIndexOf(o)===u.length-1,d=!1;if(f)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(!(e&&(f||d))){if(!d&&!f)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":te.warn(t+": attribute "+l+" is missing quotes")}}n[l]=u}return n},Z(a,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(t){return t.substring(0,2)==="X-"})}}])}(),ja="com.apple.hls.interstitial";function Xa(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function $a(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}var Li=function(){function a(s,i,t){var e;if(t===void 0&&(t=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(i==null?void 0:i.tagAnchor)||null,this.tagOrder=(e=i==null?void 0:i.tagOrder)!=null?e:t,i){var r=i.attr;for(var n in r)if(Object.prototype.hasOwnProperty.call(s,n)&&s[n]!==r[n]){te.warn('DATERANGE tag attribute: "'+n+'" does not match for tags with ID: "'+s.ID+'"'),this._badValueForSameId=n;break}s=ee(new ge({}),r,s)}if(this.attr=s,i?(this._startDate=i._startDate,this._cue=i._cue,this._endDate=i._endDate,this._dateAtEnd=i._dateAtEnd):this._startDate=new Date(s["START-DATE"]),"END-DATE"in this.attr){var o=(i==null?void 0:i.endDate)||new Date(this.attr["END-DATE"]);U(o.getTime())&&(this._endDate=o)}}return Z(a,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var i=this._cue;return i===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):i}},{key:"startTime",get:function(){var i=this.tagAnchor;return i===null||i.programDateTime===null?(te.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+i),NaN):i.start+(this.startDate.getTime()-i.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var i=this._endDate||this._dateAtEnd;if(i)return i;var t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var i=this.attr.decimalFloatingPoint("DURATION");if(U(i))return i}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===ja}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&U(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),za=10,Qa=function(){function a(i){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=i}var s=a.prototype;return s.reloaded=function(t){if(!t){this.advanced=!0,this.updated=!0;return}var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1},Z(a,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?U(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||za}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;if(t>0){var e=this.driftEnd-this.driftStart;return e*1e3/t}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var t=this.partList;if(t){var e=this.lastPartIndex;if(e!==-1){for(var r=t.length;r--;)if(t[r].index>e)return t[r].index;return e}}return 0}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}])}(),Qe={cbc:0,ctr:1};function ht(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function Ai(a){switch(a){case"AES-128":case"AES-256":return Qe.cbc;case"AES-256-CTR":return Qe.ctr;default:throw new Error("invalid full segment method "+a)}}var Za=function(){function a(i,t,e,r,n){r===void 0&&(r=[1]),n===void 0&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=i,this.uri=t,this.keyFormat=e,this.keyFormatVersions=r,this.iv=n,this.encrypted=i?i!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ht(i)}a.clearKeyUriToKeyIdMap=function(){};var s=a.prototype;return s.isSupported=function(){if(this.method){if(ht(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES"}return!1},s.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if(ht(this.method)&&this.uri&&!this.iv){typeof t!="number"&&(te.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var e=Ja(t),r=new a(this.method,this.uri,"identity",this.keyFormatVersions,e);return r}return this},a}();function Ja(a){for(var s=new Uint8Array(16),i=12;i<16;i++)s[i]=a>>8*(15-i)&255;return s}var Ri=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,bi=/#EXT-X-MEDIA:(.*)/g,es=/^#EXT(?:INF|-X-TARGETDURATION):/m,lr=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ts=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ct=function(){function a(){}return a.findGroup=function(i,t){for(var e=0;e<i.length;e++){var r=i[e];if(r.id===t)return r}},a.resolve=function(i,t){return jt.buildAbsoluteURL(t,i,{alwaysNormalize:!0})},a.isMediaPlaylist=function(i){return es.test(i)},a.parseMasterPlaylist=function(i,t){var e=!1,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:e},n=[];Ri.lastIndex=0;for(var o;(o=Ri.exec(i))!=null;)if(o[1]){var l,u=new ge(o[1],r),f=o[2],d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:a.resolve(f,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Ci(u.CODECS,d);var v=u["SUPPLEMENTAL-CODECS"];v&&(d.supplemental={},Ci(v,d.supplemental)),(l=d.unknownCodecs)!=null&&l.length||n.push(d),r.levels.push(d)}else if(o[3]){var c=o[3],g=o[4];switch(c){case"SESSION-DATA":{var m=new ge(g,r),p=m["DATA-ID"];p&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[p]=m);break}case"SESSION-KEY":{var y=Ii(g,t,r);y.encrypted&&y.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(y)):te.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+g+'"');break}case"DEFINE":break;case"CONTENT-STEERING":{var S=new ge(g,r);r.contentSteering={uri:a.resolve(S["SERVER-URI"],t),pathwayId:S["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Di(g);break}}}var T=n.length>0&&n.length<r.levels.length;return r.levels=T?n:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},a.parseMasterPlaylistMedia=function(i,t,e){var r,n={},o=e.levels,l={AUDIO:o.map(function(x){return{id:x.attrs.AUDIO,audioCodec:x.audioCodec}}),SUBTITLES:o.map(function(x){return{id:x.attrs.SUBTITLES,textCodec:x.textCodec}}),"CLOSED-CAPTIONS":[]},u=0;for(bi.lastIndex=0;(r=bi.exec(i))!==null;){var f=new ge(r[1],e),d=f.TYPE;if(d){var h=l[d],v=n[d]||[];n[d]=v;var c=f.LANGUAGE,g=f["ASSOC-LANGUAGE"],m=f.CHANNELS,p=f.CHARACTERISTICS,y=f["INSTREAM-ID"],S={attrs:f,bitrate:0,id:u++,groupId:f["GROUP-ID"]||"",name:f.NAME||c||"",type:d,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:c,url:f.URI?a.resolve(f.URI,t):""};if(g&&(S.assocLang=g),m&&(S.channels=m),p&&(S.characteristics=p),y&&(S.instreamId=y),h!=null&&h.length){var T=a.findGroup(h,S.groupId)||h[0];ki(S,T,"audioCodec"),ki(S,T,"textCodec")}v.push(S)}}return n},a.parseLevelPlaylist=function(i,t,e,r,n,o){var l,u={url:t},f=new Qa(t),d=f.fragments,h=[],v=null,c=0,g=0,m=0,p=0,y=0,S=null,T=new Zt(r,u),x,A,L,R=-1,D=!1,_=null,b;if(lr.lastIndex=0,f.m3u8=i,f.hasVariableRefs=!1,((l=lr.exec(i))==null?void 0:l[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(x=lr.exec(i))!==null;){D&&(D=!1,T=new Zt(r,u),T.playlistOffset=m,T.start=m,T.sn=c,T.cc=p,y&&(T.bitrate=y),T.level=e,v&&(T.initSegment=v,v.rawProgramDateTime&&(T.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),_&&(T.setByteRange(_),_=null)));var I=x[1];if(I){T.duration=parseFloat(I);var k=(" "+x[2]).slice(1);T.title=k||null,T.tagList.push(k?["INF",I,k]:["INF",I])}else if(x[3]){if(U(T.duration)){T.playlistOffset=m,T.start=m,L&&Oi(T,L,f),T.sn=c,T.level=e,T.cc=p,d.push(T);var w=(" "+x[3]).slice(1);T.relurl=w,ur(T,S,h),S=T,m+=T.duration,c++,g=0,D=!0}}else{if(x=x[0].match(ts),!x){te.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<x.length&&x[A]===void 0;A++);var O=(" "+x[A]).slice(1),P=(" "+x[A+1]).slice(1),N=x[A+2]?(" "+x[A+2]).slice(1):null;switch(O){case"BYTERANGE":S?T.setByteRange(P,S):T.setByteRange(P);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=P,T.tagList.push(["PROGRAM-DATE-TIME",P]),R===-1&&(R=d.length);break;case"PLAYLIST-TYPE":f.type&&Ye(f,O,x),f.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?Ye(f,O,x):d.length>0&&Mi(f,O,x),c=f.startSN=parseInt(P);break;case"SKIP":{f.skippedSegments&&Ye(f,O,x);var G=new ge(P,f),F=G.decimalInteger("SKIPPED-SEGMENTS");if(U(F)){f.skippedSegments+=F;for(var V=F;V--;)d.push(null);c+=F}var ie=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");ie&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(ie.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&Ye(f,O,x),f.targetduration=Math.max(parseInt(P),1);break;case"VERSION":f.version!==null&&Ye(f,O,x),f.version=parseInt(P);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||Ye(f,O,x),f.live=!1;break;case"#":(P||N)&&T.tagList.push(N?[P,N]:[P]);break;case"DISCONTINUITY":p++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([O]);break;case"BITRATE":T.tagList.push([O,P]),y=parseInt(P)*1e3,U(y)?T.bitrate=y:y=0;break;case"DATERANGE":{var j=new ge(P,f),se=new Li(j,f.dateRanges[j.ID],f.dateRangeTagCount);f.dateRangeTagCount++,se.isValid||f.skippedSegments?f.dateRanges[se.id]=se:te.warn('Ignoring invalid DATERANGE tag: "'+P+'"'),T.tagList.push(["EXT-X-DATERANGE",P]);break}case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":f.startCC!==0?Ye(f,O,x):d.length>0&&Mi(f,O,x),f.startCC=p=parseInt(P);break;case"KEY":{var Q=Ii(P,t,f);if(Q.isSupported()){if(Q.method==="NONE"){L=void 0;break}L||(L={}),L[Q.keyFormat]&&(L=ee({},L)),L[Q.keyFormat]=Q}else te.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+P+'"');break}case"START":f.startTimeOffset=Di(P);break;case"MAP":{var ve=new ge(P,f);if(T.duration){var oe=new Zt(r,u);Pi(oe,ve,e,L),v=oe,T.initSegment=v,v.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=v.rawProgramDateTime)}else{var ce=T.byteRangeEndOffset;if(ce){var Ie=T.byteRangeStartOffset;_=ce-Ie+"@"+Ie}else _=null;Pi(T,ve,e,L),v=T,D=!0}v.cc=p;break}case"SERVER-CONTROL":{b&&Ye(f,O,x),b=new ge(P),f.canBlockReload=b.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=b.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&b.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=b.optionalFloat("PART-HOLD-BACK",0),f.holdBack=b.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&Ye(f,O,x);var Te=new ge(P);f.partTarget=Te.decimalFloatingPoint("PART-TARGET");break}case"PART":{var le=f.partList;le||(le=f.partList=[]);var De=g>0?le[le.length-1]:void 0,me=g++,de=new ge(P,f),Re=new aa(de,T,u,me,De);le.push(Re),T.duration+=Re.duration;break}case"PRELOAD-HINT":{var Le=new ge(P,f);f.preloadHint=Le;break}case"RENDITION-REPORT":{var Pe=new ge(P,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(Pe);break}default:te.warn("line parsed but not handled: "+x);break}}}S&&!S.relurl?(d.pop(),m-=S.duration,f.partList&&(f.fragmentHint=S)):f.partList&&(ur(T,S,h),T.cc=p,f.fragmentHint=T,L&&Oi(T,L,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var ue=d.length,Oe=d[0],pe=d[ue-1];if(m+=f.skippedSegments*f.targetduration,m>0&&ue&&pe){f.averagetargetduration=m/ue;var Ce=pe.sn;f.endSN=Ce!=="initSegment"?Ce:0,f.live||(pe.endList=!0),Oe&&f.startCC===void 0&&(f.startCC=Oe.cc),R>0&&(is(d,R),Oe&&h.unshift(Oe))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(m+=f.fragmentHint.duration),f.totalduration=m,h.length&&f.dateRangeTagCount&&Oe&&_i(h,f),f.endCC=p,f},a}();function _i(a,s){for(var i=a.length,t=a[i-1],e=s.live?1/0:s.totalduration,r=Object.keys(s.dateRanges),n=r.length;n--;){var o=s.dateRanges[r[n]],l=o.startDate.getTime();o.tagAnchor=t.ref;for(var u=i;u--;){var f=rs(s,l,a,u,e);if(f!==-1){o.tagAnchor=s.fragments[f].ref;break}}}}function rs(a,s,i,t,e){var r=i[t];if(r){var n=r.programDateTime;if(s>=n||t===0){var o,l=(((o=i[t+1])==null?void 0:o.start)||e)-r.start;if(s<=n+l*1e3){var u=i[t].sn-a.startSN,f=a.fragments;if(f.length>i.length)for(var d=i[t+1]||f[f.length-1],h=d.sn-a.startSN,v=h;v>u;v--){var c=f[v].programDateTime;if(s>=c&&s<c+f[v].duration*1e3)return v}return u}}}return-1}function Ii(a,s,i){var t,e,r=new ge(a,i),n=(t=r.METHOD)!=null?t:"",o=r.URI,l=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,f=(e=r.KEYFORMAT)!=null?e:"identity";o&&r.IV&&!l&&te.error("Invalid IV: "+r.IV);var d=o?ct.resolve(o,s):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Za(n,d,f,h,l)}function Di(a){var s=new ge(a),i=s.decimalFloatingPoint("TIME-OFFSET");return U(i)?i:null}function Ci(a,s){var i=(a||"").split(/[ ,]+/).filter(function(t){return t});["video","audio","text"].forEach(function(t){var e=i.filter(function(r){return ii(r,t)});e.length&&(s[t+"Codec"]=e.map(function(r){return r.split("/")[0]}).join(","),i=i.filter(function(r){return e.indexOf(r)===-1}))}),s.unknownCodecs=i}function ki(a,s,i){var t=s[i];t&&(a[i]=t)}function is(a,s){for(var i=a[s],t=s;t--;){var e=a[t];if(!e)return;e.programDateTime=i.programDateTime-e.duration*1e3,i=e}}function ur(a,s,i){a.rawProgramDateTime?i.push(a):s!=null&&s.programDateTime&&(a.programDateTime=s.endProgramDateTime)}function Pi(a,s,i,t){a.relurl=s.URI,s.BYTERANGE&&a.setByteRange(s.BYTERANGE),a.level=i,a.sn="initSegment",t&&(a.levelkeys=t),a.initSegment=null}function Oi(a,s,i){a.levelkeys=s;var t=i.encryptedFragments;(!t.length||t[t.length-1].levelkeys!==s)&&Object.keys(s).some(function(e){return s[e].isCommonEncryption})&&t.push(a)}function Ye(a,s,i){a.playlistParsingError=new Error("#EXT-X-"+s+" must not appear more than once ("+i[0]+")")}function Mi(a,s,i){a.playlistParsingError=new Error("#EXT-X-"+s+" must appear before the first Media Segment ("+i[0]+")")}function fr(a,s){var i=s.startPTS;if(U(i)){var t=0,e;s.sn>a.sn?(t=i-a.start,e=a):(t=a.start-i,e=s),e.duration!==t&&e.setDuration(t)}else if(s.sn>a.sn){var r=a.cc===s.cc;r&&a.minEndPTS?s.setStart(a.start+(a.minEndPTS-a.start)):s.setStart(a.start+a.duration)}else s.setStart(Math.max(a.start-s.duration,0))}function wi(a,s,i,t,e,r){var n=t-i;n<=0&&(te.warn("Fragment should have a positive duration",s),t=i+s.duration,r=e+s.duration);var o=i,l=t,u=s.startPTS,f=s.endPTS;if(U(u)){var d=Math.abs(u-i);U(s.deltaPTS)?s.deltaPTS=Math.max(d,s.deltaPTS):s.deltaPTS=d,o=Math.max(i,u),i=Math.min(i,u),e=Math.min(e,s.startDTS),l=Math.min(t,f),t=Math.max(t,f),r=Math.max(r,s.endDTS)}var h=i-s.start;s.start!==0&&s.setStart(i),s.setDuration(t-s.start),s.startPTS=i,s.maxStartPTS=o,s.startDTS=e,s.endPTS=t,s.minEndPTS=l,s.endDTS=r;var v=s.sn;if(!a||v<a.startSN||v>a.endSN)return 0;var c,g=v-a.startSN,m=a.fragments;for(m[g]=s,c=g;c>0;c--)fr(m[c],m[c-1]);for(c=g;c<m.length-1;c++)fr(m[c],m[c+1]);return a.fragmentHint&&fr(m[m.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,h}function ns(a,s){if(a!==s){for(var i=null,t=a.fragments,e=t.length-1;e>=0;e--){var r=t[e].initSegment;if(r){i=r;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var n;os(a,s,function(c,g,m,p){if(!s.startCC&&g.cc!==c.cc){for(var y,S,T=c.cc-g.cc,x=m;x<p.length;x++)p[x].cc+=T;s.startCC=(y=(S=Ui(a,s.startSN-1))==null?void 0:S.cc)!=null?y:p[0].cc,s.endCC=p[p.length-1].cc}U(c.startPTS)&&U(c.endPTS)&&(g.setStart(g.startPTS=c.startPTS),g.startDTS=c.startDTS,g.maxStartPTS=c.maxStartPTS,g.endPTS=c.endPTS,g.endDTS=c.endDTS,g.minEndPTS=c.minEndPTS,g.setDuration(c.endPTS-c.startPTS),g.duration&&(n=g),s.PTSKnown=s.alignedSliding=!0),c.hasStreams&&(g.elementaryStreams=c.elementaryStreams),g.loader=c.loader,c.hasStats&&(g.stats=c.stats),c.initSegment&&(g.initSegment=c.initSegment,i=c.initSegment)});var o=s.fragments,l=s.fragmentHint?o.concat(s.fragmentHint):o;if(i&&l.forEach(function(c){var g;c&&(!c.initSegment||c.initSegment.relurl===((g=i)==null?void 0:g.relurl))&&(c.initSegment=i)}),s.skippedSegments)if(s.deltaUpdateFailed=o.some(function(c){return!c}),s.deltaUpdateFailed){te.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=s.skippedSegments;u--;)o.shift();s.startSN=o[0].sn}else{s.endCC=o[o.length-1].cc,s.canSkipDateRanges&&(s.dateRanges=as(a.dateRanges,s));var f=a.fragments.filter(function(c){return c.rawProgramDateTime});if(a.hasProgramDateTime&&!s.hasProgramDateTime)for(var d=1;d<l.length;d++)l[d].programDateTime===null&&ur(l[d],l[d-1],f);_i(f,s)}ss(a.partList,s.partList,function(c,g){g.elementaryStreams=c.elementaryStreams,g.stats=c.stats}),n?wi(s,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):Ni(a,s),o.length&&(s.totalduration=s.edge-o[0].start),s.driftStartTime=a.driftStartTime,s.driftStart=a.driftStart;var h=s.advancedDateTime;if(s.advanced&&h){var v=s.edge;s.driftStart||(s.driftStartTime=h,s.driftStart=v),s.driftEndTime=h,s.driftEnd=v}else s.driftEndTime=a.driftEndTime,s.driftEnd=a.driftEnd,s.advancedDateTime=a.advancedDateTime;s.requestScheduled===-1&&(s.requestScheduled=a.requestScheduled)}}function as(a,s){var i=s.dateRanges,t=s.recentlyRemovedDateranges,e=ee({},a);t&&t.forEach(function(o){delete e[o]});var r=Object.keys(e),n=r.length;return n&&Object.keys(i).forEach(function(o){var l=e[o],u=new Li(i[o].attr,l);u.isValid?(e[o]=u,l||(u.tagOrder+=n)):te.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+Ae(i[o].attr)+'"')}),e}function ss(a,s,i){if(a&&s)for(var t=0,e=0,r=a.length;e<=r;e++){var n=a[e],o=s[e+t];n&&o&&n.index===o.index&&n.fragment.sn===o.fragment.sn?i(n,o):t--}}function os(a,s,i){for(var t=s.skippedSegments,e=Math.max(a.startSN,s.startSN)-s.startSN,r=(a.fragmentHint?1:0)+(t?s.endSN:Math.min(a.endSN,s.endSN))-s.startSN,n=s.startSN-a.startSN,o=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,u=e;u<=r;u++){var f=l[n+u],d=o[u];if(t&&!d&&f&&(d=s.fragments[u]=f),f&&d){if(i(f,d,u,o),f.url&&f.url!==d.url){s.playlistParsingError=Fi("media sequence mismatch "+d.sn+":",a,s,f,d);return}else if(f.cc!==d.cc){s.playlistParsingError=Fi("discontinuity sequence mismatch ("+f.cc+"!="+d.cc+")",a,s,f,d);return}}}}function Fi(a,s,i,t,e){return new Error(a+" "+e.url+`
Playlist starting @`+s.startSN+`
`+s.m3u8+`

Playlist starting @`+i.startSN+`
`+i.m3u8)}function Ni(a,s,i){i===void 0&&(i=!0);var t=s.startSN+s.skippedSegments-a.startSN,e=a.fragments,r=t>=0,n=0;if(r&&t<e.length)n=e[t].start;else if(r&&s.startSN===a.endSN+1)n=a.fragmentEnd;else if(r&&i)n=a.fragmentStart+t*s.levelTargetDuration;else if(!s.skippedSegments&&s.fragmentStart===0)n=a.fragmentStart;else return;ls(s,n)}function ls(a,s){if(s){for(var i=a.fragments,t=a.skippedSegments;t<i.length;t++)i[t].addStart(s);a.fragmentHint&&a.fragmentHint.addStart(s)}}function Bi(a,s){s===void 0&&(s=1/0);var i=1e3*a.targetduration;if(a.updated){var t=a.fragments,e=4;if(t.length&&i*e>s){var r=t[t.length-1].duration*1e3;r<i&&(i=r)}}else i/=2;return Math.round(i)}function Ui(a,s,i){if(!a)return null;var t=a.fragments[s-a.startSN];return t||(t=a.fragmentHint,t&&t.sn===s)?t:s<a.startSN&&i&&i.sn===s?i:null}function Gi(a,s,i){return a?Hi(a.partList,s,i):null}function Hi(a,s,i){if(a)for(var t=a.length;t--;){var e=a[t];if(e.index===i&&e.fragment.sn===s)return e}return null}function Vi(a){a.forEach(function(s,i){var t;(t=s.details)==null||t.fragments.forEach(function(e){e.level=i,e.initSegment&&(e.initSegment.level=i)})})}var us=3e5,fs=function(a){function s(t){var e;return e=a.call(this,"content-steering",t.logger)||this,e.hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=t,e.registerListeners(),e}he(s,a);var i=s.prototype;return i.registerListeners=function(){var e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.ERROR,this.onError,this)},i.unregisterListeners=function(){var e=this.hls;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.ERROR,this.onError,this))},i.pathways=function(){return(this.levels||[]).reduce(function(e,r){return e.indexOf(r.pathwayId)===-1&&e.push(r.pathwayId),e},[])},i.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},i.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},i.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},i.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},i.removeLevel=function(e){var r=this.levels;r&&(this.levels=r.filter(function(n){return n!==e}))},i.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},i.onManifestLoaded=function(e,r){var n=r.contentSteering;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())},i.onManifestParsed=function(e,r){this.audioTracks=r.audioTracks,this.subtitleTracks=r.subtitleTracks},i.onError=function(e,r){var n=r.errorAction;if((n==null?void 0:n.action)===xe.SendAlternateToPenaltyBox&&n.flags===Ne.MoveAllAlternatesMatchingHost){var o=this.levels,l=this._pathwayPriority,u=this.pathwayId;if(r.context){var f=r.context,d=f.groupId,h=f.pathwayId,v=f.type;d&&o?u=this.getPathwayForGroupId(d,v,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!l&&o&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),n.resolved=this.pathwayId!==u),n.resolved||this.warn("Could not resolve "+r.details+' ("'+r.error.message+'") with content-steering for Pathway: '+u+" levels: "+(o&&o.length)+" priorities: "+Ae(l)+" penalized: "+Ae(this.penalizedPathways))}},i.filterParsedLevels=function(e){this.levels=e;var r=this.getLevelsForPathway(this.pathwayId);if(r.length===0){var n=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+n+'"'),r=this.getLevelsForPathway(n),this.pathwayId=n}return r.length!==e.length&&this.log("Found "+r.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),r},i.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(r){return e===r.pathwayId})},i.updatePathwayPriority=function(e){this._pathwayPriority=e;var r,n=this.penalizedPathways,o=performance.now();Object.keys(n).forEach(function(v){o-n[v]>us&&delete n[v]});for(var l=0;l<e.length;l++){var u=e[l];if(!(u in n)){if(u===this.pathwayId)return;var f=this.hls.nextLoadLevel,d=this.hls.levels[f];if(r=this.getLevelsForPathway(u),r.length>0){this.log('Setting Pathway to "'+u+'"'),this.pathwayId=u,Vi(r),this.hls.trigger(E.LEVELS_UPDATED,{levels:r});var h=this.hls.levels[f];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=f);break}}}},i.getPathwayForGroupId=function(e,r,n){for(var o=this.getLevelsForPathway(n).concat(this.levels||[]),l=0;l<o.length;l++)if(r===J.AUDIO_TRACK&&o[l].hasAudioGroup(e)||r===J.SUBTITLE_TRACK&&o[l].hasSubtitleGroup(e))return o[l].pathwayId;return n},i.clonePathways=function(e){var r=this,n=this.levels;if(n){var o={},l={};e.forEach(function(u){var f=u.ID,d=u["BASE-ID"],h=u["URI-REPLACEMENT"];if(!n.some(function(c){return c.pathwayId===f})){var v=r.getLevelsForPathway(d).map(function(c){var g=new ge(c.attrs);g["PATHWAY-ID"]=f;var m=g.AUDIO&&g.AUDIO+"_clone_"+f,p=g.SUBTITLES&&g.SUBTITLES+"_clone_"+f;m&&(o[g.AUDIO]=m,g.AUDIO=m),p&&(l[g.SUBTITLES]=p,g.SUBTITLES=p);var y=Wi(c.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),S=new fi({attrs:g,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:y,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(var T=1;T<c.audioGroups.length;T++)S.addGroupId("audio",c.audioGroups[T]+"_clone_"+f);if(c.subtitleGroups)for(var x=1;x<c.subtitleGroups.length;x++)S.addGroupId("text",c.subtitleGroups[x]+"_clone_"+f);return S});n.push.apply(n,v),Ki(r.audioTracks,o,h,f),Ki(r.subtitleTracks,l,h,f)}})}},i.loadSteeringManifest=function(e){var r=this,n=this.hls.config,o=n.loader;this.loader&&this.loader.destroy(),this.loader=new o(n);var l;try{l=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(l.protocol!=="data:"){var u=(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate)|0;l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+u)}var f={responseType:"json",url:l.href},d=n.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},v={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},c={onSuccess:function(m,p,y,S){r.log('Loaded steering manifest: "'+l+'"');var T=m.data;if((T==null?void 0:T.VERSION)!==1){r.log("Steering VERSION "+T.VERSION+" not supported!");return}r.updated=performance.now(),r.timeToLoad=T.TTL;var x=T["RELOAD-URI"],A=T["PATHWAY-CLONES"],L=T["PATHWAY-PRIORITY"];if(x)try{r.uri=new self.URL(x,l).href}catch{r.enabled=!1,r.log("Failed to parse Steering Manifest RELOAD-URI: "+x);return}r.scheduleRefresh(r.uri||y.url),A&&r.clonePathways(A);var R={steeringManifest:T,url:l.toString()};r.hls.trigger(E.STEERING_MANIFEST_LOADED,R),L&&r.updatePathwayPriority(L)},onError:function(m,p,y,S){if(r.log("Error loading steering manifest: "+m.code+" "+m.text+" ("+p.url+")"),r.stopLoad(),m.code===410){r.enabled=!1,r.log("Steering manifest "+p.url+" no longer available");return}var T=r.timeToLoad*1e3;if(m.code===429){var x=r.loader;if(typeof(x==null?void 0:x.getResponseHeader)=="function"){var A=x.getResponseHeader("Retry-After");A&&(T=parseFloat(A)*1e3)}r.log("Steering manifest "+p.url+" rate limited");return}r.scheduleRefresh(r.uri||p.url,T)},onTimeout:function(m,p,y){r.log("Timeout loading steering manifest ("+p.url+")"),r.scheduleRefresh(r.uri||p.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(f,v,c)},i.scheduleRefresh=function(e,r){var n=this;r===void 0&&(r=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var o,l=(o=n.hls)==null?void 0:o.media;if(l&&!l.ended){n.loadSteeringManifest(e);return}n.scheduleRefresh(e,n.timeToLoad*1e3)},r)},Z(s,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}}])}(tt);function Ki(a,s,i,t){a&&Object.keys(s).forEach(function(e){var r=a.filter(function(n){return n.groupId===e}).map(function(n){var o=ee({},n);return o.details=void 0,o.attrs=new ge(o.attrs),o.url=o.attrs.URI=Wi(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),o.groupId=o.attrs["GROUP-ID"]=s[e],o.attrs["PATHWAY-ID"]=t,o});a.push.apply(a,r)})}function Wi(a,s,i,t){var e=t.HOST,r=t.PARAMS,n=t[i],o;s&&(o=n==null?void 0:n[s],o&&(a=o));var l=new self.URL(a);return e&&!o&&(l.host=e),r&&Object.keys(r).sort().forEach(function(u){u&&l.searchParams.set(u,r[u])}),l.href}var ds=function(){function a(i){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=i,this.registerListeners()}var s=a.prototype;return s.setStreamController=function(t){this.streamController=t},s.registerListeners=function(){this.hls.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)},s.unregisterListeners=function(){this.hls.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)},s.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},s.onMediaAttaching=function(t,e){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},s.onMediaDetaching=function(){this.media=null},s.checkFPS=function(t,e,r){var n=performance.now();if(e){if(this.lastTime){var o=n-this.lastTime,l=r-this.lastDroppedFrames,u=e-this.lastDecodedFrames,f=1e3*l/o,d=this.hls;if(d.trigger(E.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:r}),f>0&&l>d.config.fpsDroppedMonitoringThreshold*u){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(E.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},s.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},a}(),hs=function(){function a(){this.chunks=[],this.dataLength=0}var s=a.prototype;return s.push=function(t){this.chunks.push(t),this.dataLength+=t.length},s.flush=function(){var t=this.chunks,e=this.dataLength,r;if(t.length)t.length===1?r=t[0]:r=cs(t,e);else return new Uint8Array(0);return this.reset(),r},s.reset=function(){this.chunks.length=0,this.dataLength=0},a}();function cs(a,s){for(var i=new Uint8Array(s),t=0,e=0;e<a.length;e++){var r=a[e];i.set(r,t),t+=r.length}return i}function Yi(a,s){return s+10<=a.length&&a[s]===51&&a[s+1]===68&&a[s+2]===73&&a[s+3]<255&&a[s+4]<255&&a[s+6]<128&&a[s+7]<128&&a[s+8]<128&&a[s+9]<128}function dr(a,s){return s+10<=a.length&&a[s]===73&&a[s+1]===68&&a[s+2]===51&&a[s+3]<255&&a[s+4]<255&&a[s+6]<128&&a[s+7]<128&&a[s+8]<128&&a[s+9]<128}function Ct(a,s){var i=0;return i=(a[s]&127)<<21,i|=(a[s+1]&127)<<14,i|=(a[s+2]&127)<<7,i|=a[s+3]&127,i}function kt(a,s){for(var i=s,t=0;dr(a,s);){t+=10;var e=Ct(a,s+6);t+=e,Yi(a,s+10)&&(t+=10),s+=t}if(t>0)return a.subarray(i,i+t)}function vs(a,s,i,t){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=s[i+2],n=r>>2&15;if(n>12){var o=new Error("invalid ADTS sampling index:"+n);a.emit(E.ERROR,E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!0,error:o,reason:o.message});return}var l=(r>>6&3)+1,u=s[i+3]>>6&3|(r&1)<<2,f="mp4a.40."+l,d=e[n],h=n;(l===5||l===29)&&(h-=3);var v=[l<<3|(h&14)>>1,(h&1)<<7|u<<3];return te.log("manifest codec:"+t+", parsed codec:"+f+", channels:"+u+", rate:"+d+" (ADTS object type:"+l+" sampling index:"+n+")"),{config:v,samplerate:d,channelCount:u,codec:f,parsedCodec:f,manifestCodec:t}}function qi(a,s){return a[s]===255&&(a[s+1]&246)===240}function ji(a,s){return a[s+1]&1?7:9}function hr(a,s){return(a[s+3]&3)<<11|a[s+4]<<3|(a[s+5]&224)>>>5}function gs(a,s){return s+5<a.length}function Pt(a,s){return s+1<a.length&&qi(a,s)}function ms(a,s){return gs(a,s)&&qi(a,s)&&hr(a,s)<=a.length-s}function ps(a,s){if(Pt(a,s)){var i=ji(a,s);if(s+i>=a.length)return!1;var t=hr(a,s);if(t<=i)return!1;var e=s+t;return e===a.length||Pt(a,e)}return!1}function Xi(a,s,i,t,e){if(!a.samplerate){var r=vs(s,i,t,e);if(!r)return;ee(a,r)}}function $i(a){return 1024*9e4/a}function Es(a,s){var i=ji(a,s);if(s+i<=a.length){var t=hr(a,s)-i;if(t>0)return{headerLength:i,frameLength:t}}}function zi(a,s,i,t,e){var r=$i(a.samplerate),n=t+e*r,o=Es(s,i),l;if(o){var u=o.frameLength,f=o.headerLength,d=f+u,h=Math.max(0,i+d-s.length);h?(l=new Uint8Array(d-f),l.set(s.subarray(i+f,s.length),0)):l=s.subarray(i+f,i+d);var v={unit:l,pts:n};return h||a.samples.push(v),{sample:v,length:d,missing:h}}var c=s.length-i;l=new Uint8Array(c),l.set(s.subarray(i,s.length),0);var g={unit:l,pts:n};return{sample:g,length:c,missing:-1}}function ys(a,s){return dr(a,s)&&Ct(a,s+6)+10<=a.length-s}function Ts(a){if(!(a.size<2)){var s=Me(a.data,!0),i=new Uint8Array(a.data.subarray(s.length+1));return{key:a.type,info:s,data:i.buffer}}}function Ss(a){if(!(a.size<2)){if(a.type==="TXXX"){var s=1,i=Me(a.data.subarray(s),!0);s+=i.length+1;var t=Me(a.data.subarray(s));return{key:a.type,info:i,data:t}}var e=Me(a.data.subarray(1));return{key:a.type,info:"",data:e}}}function xs(a){if(a.type==="WXXX"){if(a.size<2)return;var s=1,i=Me(a.data.subarray(s),!0);s+=i.length+1;var t=Me(a.data.subarray(s));return{key:a.type,info:i,data:t}}var e=Me(a.data);return{key:a.type,info:"",data:e}}function Ls(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function cr(a,s,i){return s===void 0&&(s=0),i===void 0&&(i=1/0),As(a,s,i,Uint8Array)}function As(a,s,i,t){var e=Rs(a),r=1;"BYTES_PER_ELEMENT"in t&&(r=t.BYTES_PER_ELEMENT);var n=bs(a)?a.byteOffset:0,o=(n+a.byteLength)/r,l=(n+s)/r,u=Math.floor(Math.max(0,Math.min(l,o))),f=Math.floor(Math.min(u+Math.max(i,0),o));return new t(e,u,f-u)}function Rs(a){return a instanceof ArrayBuffer?a:a.buffer}function bs(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function _s(a){var s={key:a.type,description:"",data:"",mimeType:null,pictureType:null},i=3;if(!(a.size<2)){if(a.data[0]!==i){console.log("Ignore frame with unrecognized character encoding");return}var t=a.data.subarray(1).indexOf(0);if(t!==-1){var e=Me(cr(a.data,1,t)),r=a.data[2+t],n=a.data.subarray(3+t).indexOf(0);if(n!==-1){var o=Me(cr(a.data,3+t,n)),l;return e==="-->"?l=Me(cr(a.data,4+t+n)):l=Ls(a.data.subarray(4+t+n)),s.mimeType=e,s.pictureType=r,s.description=o,s.data=l,s}}}}function Is(a){return a.type==="PRIV"?Ts(a):a.type[0]==="W"?xs(a):a.type==="APIC"?_s(a):Ss(a)}function Ds(a){var s=String.fromCharCode(a[0],a[1],a[2],a[3]),i=Ct(a,4),t=10;return{type:s,size:i,data:a.subarray(t,t+i)}}var Ot=10,Cs=10;function Qi(a){for(var s=0,i=[];dr(a,s);){var t=Ct(a,s+6);a[s+5]>>6&1&&(s+=Ot),s+=Ot;for(var e=s+t;s+Cs<e;){var r=Ds(a.subarray(s)),n=Is(r);n&&i.push(n),s+=r.size+Ot}Yi(a,s)&&(s+=Ot)}return i}function Zi(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function ks(a){if(a.data.byteLength===8){var s=new Uint8Array(a.data),i=s[3]&1,t=(s[4]<<23)+(s[5]<<15)+(s[6]<<7)+s[7];return t/=45,i&&(t+=4772185884e-2),Math.round(t)}}function Ji(a){for(var s=Qi(a),i=0;i<s.length;i++){var t=s[i];if(Zi(t))return ks(t)}}var ke=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function Ke(a,s){return a===void 0&&(a=""),s===void 0&&(s=9e4),{type:a,id:-1,pid:-1,inputTimeScale:s,sequenceNumber:-1,samples:[],dropped:0}}var en=function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var s=a.prototype;return s.resetInitSegment=function(t,e,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},s.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},s.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},s.canParse=function(t,e){return!1},s.appendFrame=function(t,e,r){},s.demux=function(t,e){this.cachedData&&(t=Fe(this.cachedData,t),this.cachedData=null);var r=kt(t,0),n=r?r.length:0,o,l=this._audioTrack,u=this._id3Track,f=r?Ji(r):void 0,d=t.length;for((this.basePTS===null||this.frameIndex===0&&U(f))&&(this.basePTS=Ps(f,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ke.audioId3,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(t,n)){var h=this.appendFrame(l,t,n);h?(this.frameIndex++,this.lastPTS=h.sample.pts,n+=h.length,o=n):n=d}else ys(t,n)?(r=kt(t,n),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ke.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,o=n):n++;if(n===d&&o!==d){var v=t.slice(o);this.cachedData?this.cachedData=Fe(this.cachedData,v):this.cachedData=v}}return{audioTrack:l,videoTrack:Ke(),id3Track:u,textTrack:Ke()}},s.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},s.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Ke(),id3Track:this._id3Track,textTrack:Ke()}},s.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},a}(),Ps=function(s,i,t){if(U(s))return s*90;var e=t?t.baseTime*9e4/t.timescale:0;return i*9e4+e},Mt=null,Os=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ms=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ws=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Fs=[0,1,1,4];function tn(a,s,i,t,e){if(!(i+24>s.length)){var r=rn(s,i);if(r&&i+r.frameLength<=s.length){var n=r.samplesPerFrame*9e4/r.sampleRate,o=t+e*n,l={unit:s.subarray(i,i+r.frameLength),pts:o,dts:o};return a.config=[],a.channelCount=r.channelCount,a.samplerate=r.sampleRate,a.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}}function rn(a,s){var i=a[s+1]>>3&3,t=a[s+1]>>1&3,e=a[s+2]>>4&15,r=a[s+2]>>2&3;if(i!==1&&e!==0&&e!==15&&r!==3){var n=a[s+2]>>1&1,o=a[s+3]>>6,l=i===3?3-t:t===3?3:4,u=Os[l*14+e-1]*1e3,f=i===3?0:i===2?1:2,d=Ms[f*3+r],h=o===3?1:2,v=ws[i][t],c=Fs[t],g=v*8*c,m=Math.floor(v*u/d+n)*c;if(Mt===null){var p=navigator.userAgent||"",y=p.match(/Chrome\/(\d+)/i);Mt=y?parseInt(y[1]):0}var S=!!Mt&&Mt<=87;return S&&t===2&&u>=224e3&&o===0&&(a[s+3]=a[s+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function vr(a,s){return a[s]===255&&(a[s+1]&224)===224&&(a[s+1]&6)!==0}function nn(a,s){return s+1<a.length&&vr(a,s)}function Ns(a,s){var i=4;return vr(a,s)&&i<=a.length-s}function an(a,s){if(s+1<a.length&&vr(a,s)){var i=4,t=rn(a,s),e=i;t!=null&&t.frameLength&&(e=t.frameLength);var r=s+e;return r===a.length||nn(a,r)}return!1}var Bs=function(a){function s(t,e){var r;return r=a.call(this)||this,r.observer=void 0,r.config=void 0,r.observer=t,r.config=e,r}he(s,a);var i=s.prototype;return i.resetInitSegment=function(e,r,n,o){a.prototype.resetInitSegment.call(this,e,r,n,o),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:o,inputTimeScale:9e4,dropped:0}},s.probe=function(e,r){if(!e)return!1;var n=kt(e,0),o=(n==null?void 0:n.length)||0;if(an(e,o))return!1;for(var l=e.length;o<l;o++)if(ps(e,o))return r.log("ADTS sync word found !"),!0;return!1},i.canParse=function(e,r){return ms(e,r)},i.appendFrame=function(e,r,n){Xi(e,this.observer,r,n,e.manifestCodec);var o=zi(e,r,n,this.basePTS,this.frameIndex);if(o&&o.missing===0)return o},s}(en),Us=function(s,i){var t=0,e=5;i+=e;for(var r=new Uint32Array(1),n=new Uint32Array(1),o=new Uint8Array(1);e>0;){o[0]=s[i];var l=Math.min(e,8),u=8-l;n[0]=4278190080>>>24+u<<u,r[0]=(o[0]&n[0])>>u,t=t?t<<l|r[0]:r[0],i+=1,e-=l}return t},Gs=function(a){function s(){return a.apply(this,arguments)||this}he(s,a);var i=s.prototype;return i.resetInitSegment=function(e,r,n,o){a.prototype.resetInitSegment.call(this,e,r,n,o),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:o,inputTimeScale:9e4,dropped:0}},s.probe=function(e){if(!e)return!1;var r=kt(e,0),n=(r==null?void 0:r.length)||0;if(r&&e[n]===11&&e[n+1]===119&&Ji(r)!==void 0&&Us(e,n)<=16)return!1;for(var o=e.length;n<o;n++)if(an(e,n))return te.log("MPEG Audio sync word found !"),!0;return!1},i.canParse=function(e,r){return Ns(e,r)},i.appendFrame=function(e,r,n){if(this.basePTS!==null)return tn(e,r,n,this.basePTS,this.frameIndex)},s}(en),Hs=function(){function a(i,t,e){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=i,this.aesIV=t,this.aesMode=e}var s=a.prototype;return s.decrypt=function(t,e){switch(this.aesMode){case Qe.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case Qe.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},a}();function Vs(a){var s=a.byteLength,i=s&&new DataView(a.buffer).getUint8(s-1);return i?a.slice(0,s-i):a}var Ks=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var s=a.prototype;return s.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),n=0;n<4;n++)r[n]=e.getUint32(n*4);return r},s.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,n=r[0],o=r[1],l=r[2],u=r[3],f=this.invSubMix,d=f[0],h=f[1],v=f[2],c=f[3],g=new Uint32Array(256),m=0,p=0,y=0;for(y=0;y<256;y++)y<128?g[y]=y<<1:g[y]=y<<1^283;for(y=0;y<256;y++){var S=p^p<<1^p<<2^p<<3^p<<4;S=S>>>8^S&255^99,t[m]=S,e[S]=m;var T=g[m],x=g[T],A=g[x],L=g[S]*257^S*16843008;n[m]=L<<24|L>>>8,o[m]=L<<16|L>>>16,l[m]=L<<8|L>>>24,u[m]=L,L=A*16843009^x*65537^T*257^m*16843008,d[S]=L<<24|L>>>8,h[S]=L<<16|L>>>16,v[S]=L<<8|L>>>24,c[S]=L,m?(m=T^g[g[g[A^T]]],p^=g[g[p]]):m=p=1}},s.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,n=0;n<e.length&&r;)r=e[n]===this.key[n],n++;if(!r){this.key=e;var o=this.keySize=e.length;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size="+o);var l=this.ksRows=(o+6+1)*4,u,f,d=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),v=this.sBox,c=this.rcon,g=this.invSubMix,m=g[0],p=g[1],y=g[2],S=g[3],T,x;for(u=0;u<l;u++){if(u<o){T=d[u]=e[u];continue}x=T,u%o===0?(x=x<<8|x>>>24,x=v[x>>>24]<<24|v[x>>>16&255]<<16|v[x>>>8&255]<<8|v[x&255],x^=c[u/o|0]<<24):o>6&&u%o===4&&(x=v[x>>>24]<<24|v[x>>>16&255]<<16|v[x>>>8&255]<<8|v[x&255]),d[u]=T=(d[u-o]^x)>>>0}for(f=0;f<l;f++)u=l-f,f&3?x=d[u]:x=d[u-4],f<4||u<=4?h[f]=x:h[f]=m[v[x>>>24]]^p[v[x>>>16&255]]^y[v[x>>>8&255]]^S[v[x&255]],h[f]=h[f]>>>0}},s.networkToHostOrderSwap=function(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24},s.decrypt=function(t,e,r){for(var n=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,f=u[0],d=u[1],h=u[2],v=u[3],c=this.uint8ArrayToUint32Array_(r),g=c[0],m=c[1],p=c[2],y=c[3],S=new Int32Array(t),T=new Int32Array(S.length),x,A,L,R,D,_,b,I,k,w,O,P,N,G,F=this.networkToHostOrderSwap;e<S.length;){for(k=F(S[e]),w=F(S[e+1]),O=F(S[e+2]),P=F(S[e+3]),D=k^o[0],_=P^o[1],b=O^o[2],I=w^o[3],N=4,G=1;G<n;G++)x=f[D>>>24]^d[_>>16&255]^h[b>>8&255]^v[I&255]^o[N],A=f[_>>>24]^d[b>>16&255]^h[I>>8&255]^v[D&255]^o[N+1],L=f[b>>>24]^d[I>>16&255]^h[D>>8&255]^v[_&255]^o[N+2],R=f[I>>>24]^d[D>>16&255]^h[_>>8&255]^v[b&255]^o[N+3],D=x,_=A,b=L,I=R,N=N+4;x=l[D>>>24]<<24^l[_>>16&255]<<16^l[b>>8&255]<<8^l[I&255]^o[N],A=l[_>>>24]<<24^l[b>>16&255]<<16^l[I>>8&255]<<8^l[D&255]^o[N+1],L=l[b>>>24]<<24^l[I>>16&255]<<16^l[D>>8&255]<<8^l[_&255]^o[N+2],R=l[I>>>24]<<24^l[D>>16&255]<<16^l[_>>8&255]<<8^l[b&255]^o[N+3],T[e]=F(x^g),T[e+1]=F(R^m),T[e+2]=F(L^p),T[e+3]=F(A^y),g=k,m=w,p=O,y=P,e=e+4}return T.buffer},a}(),Ws=function(){function a(i,t,e){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=i,this.key=t,this.aesMode=e}var s=a.prototype;return s.expandKey=function(){var t=Ys(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])},a}();function Ys(a){switch(a){case Qe.cbc:return"AES-CBC";case Qe.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+a)}}var qs=16,gr=function(){function a(i,t){var e=t===void 0?{}:t,r=e.removePKCS7Padding,n=r===void 0?!0:r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=i.enableSoftwareAES,this.removePKCS7Padding=n,n)try{var o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var s=a.prototype;return s.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},s.isSync=function(){return this.useSoftware},s.flush=function(){var t=this.currentResult,e=this.remainderData;if(!t||e)return this.reset(),null;var r=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Vs(r):r},s.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},s.decrypt=function(t,e,r,n){var o=this;return this.useSoftware?new Promise(function(l,u){var f=ArrayBuffer.isView(t)?t:new Uint8Array(t);o.softwareDecrypt(f,e,r,n);var d=o.flush();d?l(d.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,r,n)},s.softwareDecrypt=function(t,e,r,n){var o=this.currentIV,l=this.currentResult,u=this.remainderData;if(n!==Qe.cbc||e.byteLength!==16)return te.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(t=Fe(u,t),this.remainderData=null);var f=this.getValidChunk(t);if(!f.length)return null;o&&(r=o);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Ks),d.expandKey(e);var h=l;return this.currentResult=d.decrypt(f.buffer,0,r),this.currentIV=f.slice(-16).buffer,h||null},s.webCryptoDecrypt=function(t,e,r,n){var o=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,r,n));this.key=e,this.fastAesKey=new Ws(this.subtle,e,n)}return this.fastAesKey.expandKey().then(function(l){if(!o.subtle)return Promise.reject(new Error("web crypto not initialized"));o.logOnce("WebCrypto AES decrypt");var u=new Hs(o.subtle,new Uint8Array(r),n);return u.decrypt(t.buffer,l)}).catch(function(l){return te.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),o.onWebCryptoError(t,e,r,n)})},s.onWebCryptoError=function(t,e,r,n){var o=this.enableSoftwareAES;if(o){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,r,n);var l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(o?" and softwareDecrypt":"")+": failed to decrypt data")},s.getValidChunk=function(t){var e=t,r=t.length-t.length%qs;return r!==t.length&&(e=t.slice(0,r),this.remainderData=t.slice(r)),e},s.logOnce=function(t){this.logEnabled&&(te.log("[decrypter]: "+t),this.logEnabled=!1)},a}(),js=/\/emsg[-/]ID3/i,Xs=function(){function a(i,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var s=a.prototype;return s.resetTimeStamp=function(){},s.resetInitSegment=function(t,e,r,n){var o=this.videoTrack=Ke("video",1),l=this.audioTrack=Ke("audio",1),u=this.txtTrack=Ke("text",1);if(this.id3Track=Ke("id3",1),this.timeOffset=0,!!(t!=null&&t.byteLength)){var f=Zr(t);if(f.video){var d=f.video,h=d.id,v=d.timescale,c=d.codec,g=d.supplemental;o.id=h,o.timescale=u.timescale=v,o.codec=c,o.supplemental=g}if(f.audio){var m=f.audio,p=m.id,y=m.timescale,S=m.codec;l.id=p,l.timescale=y,l.codec=S}u.id=Xr.text,o.sampleDuration=0,o.duration=l.duration=n}},s.resetContiguity=function(){this.remainderData=null},a.probe=function(t){return la(t)},s.demux=function(t,e){this.timeOffset=e;var r=t,n=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Fe(this.remainderData,t));var l=pa(r);this.remainderData=l.remainder,n.samples=l.valid||new Uint8Array}else n.samples=r;var u=this.extractID3Track(n,e);return o.samples=Jr(e,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},s.flush=function(){var t=this.timeOffset,e=this.videoTrack,r=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(e,this.timeOffset);return r.samples=Jr(t,e),{videoTrack:e,audioTrack:Ke(),id3Track:n,textTrack:Ke()}},s.extractID3Track=function(t,e){var r=this,n=this.id3Track;if(t.samples.length){var o=K(t.samples,["emsg"]);o&&o.forEach(function(l){var u=ya(l);if(js.test(u.schemeIdUri)){var f=sn(u,e),d=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=u.payload;n.samples.push({data:h,len:h.byteLength,dts:f,pts:f,type:ke.emsg,duration:d})}else if(r.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var v=sn(u,e);n.samples.push({data:u.payload,len:u.payload.byteLength,dts:v,pts:v,type:ke.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n},s.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},s.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},a}();function sn(a,s){return U(a.presentationTime)?a.presentationTime/a.timeScale:s+a.presentationTimeDelta/a.timeScale}var $s=function(){function a(i,t,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new gr(t,{removePKCS7Padding:!1})}var s=a.prototype;return s.decryptBuffer=function(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,Qe.cbc)},s.decryptAacSample=function(t,e,r){var n=this,o=t[e].unit;if(!(o.length<=16)){var l=o.subarray(16,o.length-o.length%16),u=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(u).then(function(f){var d=new Uint8Array(f);o.set(d,16),n.decrypter.isSync()||n.decryptAacSamples(t,e+1,r)})}},s.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length){r();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,r),!this.decrypter.isSync()))return}},s.getAvcEncryptedData=function(t){for(var e=Math.floor((t.length-48)/160)*16+16,r=new Int8Array(e),n=0,o=32;o<t.length-16;o+=160,n+=16)r.set(t.subarray(o,o+16),n);return r},s.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),n=0,o=32;o<t.length-16;o+=160,n+=16)t.set(r.subarray(n,n+16),o);return t},s.decryptAvcSample=function(t,e,r,n,o){var l=this,u=ti(o.data),f=this.getAvcEncryptedData(u);this.decryptBuffer(f.buffer).then(function(d){o.data=l.getAvcDecryptedUnit(u,d),l.decrypter.isSync()||l.decryptAvcSamples(t,e,r+1,n)})},s.decryptAvcSamples=function(t,e,r,n){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length){n();return}for(var o=t[e].units;!(r>=o.length);r++){var l=o[r];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(t,e,r,n,l),!this.decrypter.isSync()))return}}},a}(),zs=function(){function a(){this.VideoSample=null}var s=a.prototype;return s.createVideoSample=function(t,e,r){return{key:t,frame:!1,pts:e,dts:r,units:[],length:0}},s.getLastNalUnit=function(t){var e,r=this.VideoSample,n;if((!r||r.units.length===0)&&(r=t[t.length-1]),(e=r)!=null&&e.units){var o=r.units;n=o[o.length-1]}return n},s.pushAccessUnit=function(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){var r=e.samples,n=r.length;if(n){var o=r[n-1];t.pts=o.pts,t.dts=o.dts}else{e.dropped++;return}}e.samples.push(t)}},s.parseNALu=function(t,e,r){var n=e.byteLength,o=t.naluState||0,l=o,u=[],f=0,d,h,v,c=-1,g=0;for(o===-1&&(c=0,g=this.getNALuType(e,0),o=0,f=1);f<n;){if(d=e[f++],!o){o=d?0:1;continue}if(o===1){o=d?0:2;continue}if(!d)o=3;else if(d===1){if(h=f-o-1,c>=0){var m={data:e.subarray(c,h),type:g};u.push(m)}else{var p=this.getLastNalUnit(t.samples);p&&(l&&f<=4-l&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-l)),h>0&&(p.data=Fe(p.data,e.subarray(0,h)),p.state=0))}f<n?(v=this.getNALuType(e,f),c=f,g=v,o=0):o=-1}else o=0}if(c>=0&&o>=0){var y={data:e.subarray(c,n),type:g,state:o};u.push(y)}if(u.length===0){var S=this.getLastNalUnit(t.samples);S&&(S.data=Fe(S.data,e))}return t.naluState=o,u},a}(),on=function(){function a(i){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=i,this.bytesAvailable=i.byteLength,this.word=0,this.bitsAvailable=0}var s=a.prototype;return s.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,n=new Uint8Array(4),o=Math.min(4,e);if(o===0)throw new Error("no bytes available");n.set(t.subarray(r,r+o)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o},s.skipBits=function(t){var e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},s.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;if(t>32&&te.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?r<<e|this.readBits(e):r},s.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},s.skipUEG=function(){this.skipBits(1+this.skipLZ())},s.skipEG=function(){this.skipBits(1+this.skipLZ())},s.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},s.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},s.readBoolean=function(){return this.readBits(1)===1},s.readUByte=function(){return this.readBits(8)},s.readUShort=function(){return this.readBits(16)},s.readUInt=function(){return this.readBits(32)},a}(),ln=function(a){function s(){return a.apply(this,arguments)||this}he(s,a);var i=s.prototype;return i.parsePES=function(e,r,n,o){var l=this,u=this.parseNALu(e,n.data,o),f=this.VideoSample,d,h=!1;n.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),u.forEach(function(v){var c,g;switch(v.type){case 1:{var m=!1;d=!0;var p=v.data;if(h&&p.length>4){var y=l.readSliceType(p);(y===2||y===4||y===7||y===9)&&(m=!0)}if(m){var S;(S=f)!=null&&S.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,n.pts,n.dts)),f.frame=!0,f.key=m;break}case 5:d=!0,(c=f)!=null&&c.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,n.pts,n.dts)),f.key=!0,f.frame=!0;break;case 6:{d=!0,ei(v.data,1,n.pts,r.samples);break}case 7:{var T,x;d=!0,h=!0;var A=v.data,L=l.readSPS(A);if(!e.sps||e.width!==L.width||e.height!==L.height||((T=e.pixelRatio)==null?void 0:T[0])!==L.pixelRatio[0]||((x=e.pixelRatio)==null?void 0:x[1])!==L.pixelRatio[1]){e.width=L.width,e.height=L.height,e.pixelRatio=L.pixelRatio,e.sps=[A];for(var R=A.subarray(1,4),D="avc1.",_=0;_<3;_++){var b=R[_].toString(16);b.length<2&&(b="0"+b),D+=b}e.codec=D}break}case 8:d=!0,e.pps=[v.data];break;case 9:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,n.pts,n.dts));break;case 12:d=!0;break;default:d=!1;break}if(f&&d){var I=f.units;I.push(v)}}),o&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},i.getNALuType=function(e,r){return e[r]&31},i.readSliceType=function(e){var r=new on(e);return r.readUByte(),r.readUEG(),r.readUEG()},i.skipScalingList=function(e,r){for(var n=8,o=8,l,u=0;u<e;u++)o!==0&&(l=r.readEG(),o=(n+l+256)%256),n=o===0?n:o},i.readSPS=function(e){var r=new on(e),n=0,o=0,l=0,u=0,f,d,h,v=r.readUByte.bind(r),c=r.readBits.bind(r),g=r.readUEG.bind(r),m=r.readBoolean.bind(r),p=r.skipBits.bind(r),y=r.skipEG.bind(r),S=r.skipUEG.bind(r),T=this.skipScalingList.bind(this);v();var x=v();if(c(5),p(3),v(),S(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){var A=g();if(A===3&&p(1),S(),S(),p(1),m())for(d=A!==3?8:12,h=0;h<d;h++)m()&&(h<6?T(16,r):T(64,r))}S();var L=g();if(L===0)g();else if(L===1)for(p(1),y(),y(),f=g(),h=0;h<f;h++)y();S(),p(1);var R=g(),D=g(),_=c(1);_===0&&p(1),p(1),m()&&(n=g(),o=g(),l=g(),u=g());var b=[1,1];if(m()&&m()){var I=v();switch(I){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[v()<<8|v(),v()<<8|v()];break}}}return{width:Math.ceil((R+1)*16-n*2-o*2),height:(2-_)*(D+1)*16-(_?2:4)*(l+u),pixelRatio:b}},s}(zs),ye=188,Qs=function(){function a(i,t,e,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=i,this.config=t,this.typeSupported=e,this.logger=r,this.videoParser=null}a.probe=function(t,e){var r=a.syncOffset(t);return r>0&&e.warn("MPEG2-TS detected but first sync word found @ offset "+r),r!==-1},a.syncOffset=function(t){for(var e=t.length,r=Math.min(ye*5,e-ye)+1,n=0;n<r;){for(var o=!1,l=-1,u=0,f=n;f<e;f+=ye)if(t[f]===71&&(e-f===ye||t[f+ye]===71)){if(u++,l===-1&&(l=f,l!==0&&(r=Math.min(l+ye*99,t.length-ye)+1)),o||(o=mr(t,f)===0),o&&u>1&&(l===0&&u>2||f+ye>r))return l}else{if(u)return-1;break}n++}return-1},a.createTrack=function(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:Xr[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}};var s=a.prototype;return s.resetInitSegment=function(t,e,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=a.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=a.createTrack("audio",n),this._id3Track=a.createTrack("id3"),this._txtTrack=a.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=r},s.resetTimeStamp=function(){},s.resetContiguity=function(){var t=this._audioTrack,e=this._videoTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null},s.demux=function(t,e,r,n){r===void 0&&(r=!1),n===void 0&&(n=!1),r||(this.sampleAes=null);var o,l=this._videoTrack,u=this._audioTrack,f=this._id3Track,d=this._txtTrack,h=l.pid,v=l.pesData,c=u.pid,g=f.pid,m=u.pesData,p=f.pesData,y=null,S=this.pmtParsed,T=this._pmtId,x=t.length;if(this.remainderData&&(t=Fe(this.remainderData,t),x=t.length,this.remainderData=null),x<ye&&!n)return this.remainderData=t,{audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};var A=Math.max(0,a.syncOffset(t));x-=(x-A)%ye,x<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,x,t.buffer.byteLength-x));for(var L=0,R=A;R<x;R+=ye)if(t[R]===71){var D=!!(t[R+1]&64),_=mr(t,R),b=(t[R+3]&48)>>4,I=void 0;if(b>1){if(I=R+5+t[R+4],I===R+ye)continue}else I=R+4;switch(_){case h:if(D){if(v&&(o=it(v,this.logger))){if(this.videoParser===null)switch(l.segmentCodec){case"avc":this.videoParser=new ln;break}this.videoParser!==null&&this.videoParser.parsePES(l,d,o,!1)}v={data:[],size:0}}v&&(v.data.push(t.subarray(I,R+ye)),v.size+=R+ye-I);break;case c:if(D){if(m&&(o=it(m,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,o);break;case"mp3":this.parseMPEGPES(u,o);break}m={data:[],size:0}}m&&(m.data.push(t.subarray(I,R+ye)),m.size+=R+ye-I);break;case g:D&&(p&&(o=it(p,this.logger))&&this.parseID3PES(f,o),p={data:[],size:0}),p&&(p.data.push(t.subarray(I,R+ye)),p.size+=R+ye-I);break;case 0:D&&(I+=t[I]+1),T=this._pmtId=Zs(t,I);break;case T:{D&&(I+=t[I]+1);var k=Js(t,I,this.typeSupported,r,this.observer,this.logger);h=k.videoPid,h>0&&(l.pid=h,l.segmentCodec=k.segmentVideoCodec),c=k.audioPid,c>0&&(u.pid=c,u.segmentCodec=k.segmentAudioCodec),g=k.id3Pid,g>0&&(f.pid=g),y!==null&&!S&&(this.logger.warn("MPEG-TS PMT found at "+R+" after unknown PID '"+y+"'. Backtracking to sync byte @"+A+" to parse all TS packets."),y=null,R=A-188),S=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=_;break}}else L++;L>0&&wt(this.observer,new Error("Found "+L+" TS packet/s that do not start with 0x47"),void 0,this.logger),l.pesData=v,u.pesData=m,f.pesData=p;var w={audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};return n&&this.extractRemainingSamples(w),w},s.flush=function(){var t=this.remainderData;this.remainderData=null;var e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},s.extractRemainingSamples=function(t){var e=t.audioTrack,r=t.videoTrack,n=t.id3Track,o=t.textTrack,l=r.pesData,u=e.pesData,f=n.pesData,d;if(l&&(d=it(l,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new ln;break}this.videoParser!==null&&(this.videoParser.parsePES(r,o,d,!0),r.pesData=null)}else r.pesData=l;if(u&&(d=it(u,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break}e.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=u;f&&(d=it(f,this.logger))?(this.parseID3PES(n,d),n.pesData=null):n.pesData=f},s.demuxSampleAes=function(t,e,r){var n=this.demux(t,r,!0,!this.config.progressive),o=this.sampleAes=new $s(this.observer,this.config,e);return this.decrypt(n,o)},s.decrypt=function(t,e){return new Promise(function(r){var n=t.audioTrack,o=t.videoTrack;n.samples&&n.segmentCodec==="aac"?e.decryptAacSamples(n.samples,0,function(){o.samples?e.decryptAvcSamples(o.samples,0,0,function(){r(t)}):r(t)}):o.samples&&e.decryptAvcSamples(o.samples,0,0,function(){r(t)})})},s.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},s.parseAACPES=function(t,e){var r=0,n=this.aacOverFlow,o=e.data;if(n){this.aacOverFlow=null;var l=n.missing,u=n.sample.unit.byteLength;if(l===-1)o=Fe(n.sample.unit,o);else{var f=u-l;n.sample.unit.set(o.subarray(0,l),f),t.samples.push(n.sample),r=n.missing}}var d,h;for(d=r,h=o.length;d<h-1&&!Pt(o,d);d++);if(d!==r){var v,c=d<h-1;if(c?v="AAC PES did not start with ADTS header,offset:"+d:v="No ADTS header found in AAC PES",wt(this.observer,new Error(v),c,this.logger),!c)return}Xi(t,this.observer,o,d,this.audioCodec);var g;if(e.pts!==void 0)g=e.pts;else if(n){var m=$i(t.samplerate);g=n.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var p=0,y;d<h;)if(y=zi(t,o,d,g,p),d+=y.length,y.missing){this.aacOverFlow=y;break}else for(p++;d<h-1&&!Pt(o,d);d++);},s.parseMPEGPES=function(t,e){var r=e.data,n=r.length,o=0,l=0,u=e.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<n;)if(nn(r,l)){var f=tn(t,r,l,u,o);if(f)l+=f.length,o++;else break}else l++},s.parseAC3PES=function(t,e){},s.parseID3PES=function(t,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var r=ee({},e,{type:this._videoTrack?ke.emsg:ke.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(r)},a}();function mr(a,s){return((a[s+1]&31)<<8)+a[s+2]}function Zs(a,s){return(a[s+10]&31)<<8|a[s+11]}function Js(a,s,i,t,e,r){var n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(a[s+1]&15)<<8|a[s+2],l=s+3+o-4,u=(a[s+10]&15)<<8|a[s+11];for(s+=12+u;s<l;){var f=mr(a,s),d=(a[s+3]&15)<<8|a[s+4];switch(a[s]){case 207:if(!t){pr("ADTS AAC",r);break}case 15:n.audioPid===-1&&(n.audioPid=f);break;case 21:n.id3Pid===-1&&(n.id3Pid=f);break;case 219:if(!t){pr("H.264",r);break}case 27:n.videoPid===-1&&(n.videoPid=f);break;case 3:case 4:!i.mpeg&&!i.mp3?r.log("MPEG audio found, not supported in this browser"):n.audioPid===-1&&(n.audioPid=f,n.segmentAudioCodec="mp3");break;case 193:if(!t){pr("AC-3",r);break}case 129:r.warn("AC-3 in M2TS support not included in build");break;case 6:if(n.audioPid===-1&&d>0)for(var h=s+5,v=d;v>2;){var c=a[h];switch(c){case 106:r.warn("AC-3 in M2TS support not included in build");break}var g=a[h+1]+2;h+=g,v-=g}break;case 194:case 135:return wt(e,new Error("Unsupported EC-3 in M2TS found"),void 0,r),n;case 36:return wt(e,new Error("Unsupported HEVC in M2TS found"),void 0,r),n}s+=d+5}return n}function wt(a,s,i,t){t.warn("parsing error: "+s.message),a.emit(E.ERROR,E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,levelRetry:i,error:s,reason:s.message})}function pr(a,s){s.log(a+" with AES-128-CBC encryption found in unencrypted stream")}function it(a,s){var i=0,t,e,r,n,o,l=a.data;if(!a||a.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Fe(l[0],l[1]),l.splice(1,1);t=l[0];var u=(t[0]<<16)+(t[1]<<8)+t[2];if(u===1){if(e=(t[4]<<8)+t[5],e&&e>a.size-6)return null;var f=t[7];f&192&&(n=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,f&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,n-o>60*9e4&&(s.warn(Math.round((n-o)/9e4)+"s delta between PTS and DTS, align them"),n=o)):o=n),r=t[8];var d=r+9;if(a.size<=d)return null;a.size-=d;for(var h=new Uint8Array(a.size),v=0,c=l.length;v<c;v++){t=l[v];var g=t.byteLength;if(d)if(d>g){d-=g;continue}else t=t.subarray(d),g-=d,d=0;h.set(t,i),i+=g}return e&&(e-=r+3),{data:h,pts:n,dts:o,len:e}}return null}var eo=function(){function a(){}return a.getSilentFrame=function(i,t){switch(i){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},a}(),Ze=Math.pow(2,32)-1,Se=function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var i;for(i in a.types)a.types.hasOwnProperty(i)&&(a.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:t,audio:e};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=n,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,o,u,o,l),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,r))},a.box=function(i){for(var t=8,e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];for(var o=r.length,l=o;o--;)t+=r[o].byteLength;var u=new Uint8Array(t);for(u[0]=t>>24&255,u[1]=t>>16&255,u[2]=t>>8&255,u[3]=t&255,u.set(i,4),o=0,t=8;o<l;o++)u.set(r[o],t),t+=r[o].byteLength;return u},a.hdlr=function(i){return a.box(a.types.hdlr,a.HDLR_TYPES[i])},a.mdat=function(i){return a.box(a.types.mdat,i)},a.mdhd=function(i,t){t*=i;var e=Math.floor(t/(Ze+1)),r=Math.floor(t%(Ze+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,e>>24,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))},a.mdia=function(i){return a.box(a.types.mdia,a.mdhd(i.timescale||0,i.duration||0),a.hdlr(i.type),a.minf(i))},a.mfhd=function(i){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))},a.minf=function(i){return i.type==="audio"?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(i)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(i))},a.moof=function(i,t,e){return a.box(a.types.moof,a.mfhd(i),a.traf(e,t))},a.moov=function(i){for(var t=i.length,e=[];t--;)e[t]=a.trak(i[t]);return a.box.apply(null,[a.types.moov,a.mvhd(i[0].timescale||0,i[0].duration||0)].concat(e).concat(a.mvex(i)))},a.mvex=function(i){for(var t=i.length,e=[];t--;)e[t]=a.trex(i[t]);return a.box.apply(null,[a.types.mvex].concat(e))},a.mvhd=function(i,t){t*=i;var e=Math.floor(t/(Ze+1)),r=Math.floor(t%(Ze+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,e>>24,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,n)},a.sdtp=function(i){var t=i.samples||[],e=new Uint8Array(4+t.length),r,n;for(r=0;r<t.length;r++)n=t[r].flags,e[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return a.box(a.types.sdtp,e)},a.stbl=function(i){return a.box(a.types.stbl,a.stsd(i),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(i){var t=[],e=[],r,n,o;for(r=0;r<i.sps.length;r++)n=i.sps[r],o=n.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(n));for(r=0;r<i.pps.length;r++)n=i.pps[r],o=n.byteLength,e.push(o>>>8&255),e.push(o&255),e=e.concat(Array.prototype.slice.call(n));var l=a.box(a.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|i.sps.length].concat(t).concat([i.pps.length]).concat(e))),u=i.width,f=i.height,d=i.pixelRatio[0],h=i.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))},a.esds=function(i){var t=i.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(t,[6,1,2]))},a.audioStsd=function(i){var t=i.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])},a.mp4a=function(i){return a.box(a.types.mp4a,a.audioStsd(i),a.box(a.types.esds,a.esds(i)))},a.mp3=function(i){return a.box(a.types[".mp3"],a.audioStsd(i))},a.ac3=function(i){return a.box(a.types["ac-3"],a.audioStsd(i),a.box(a.types.dac3,i.config))},a.stsd=function(i){var t=i.segmentCodec;if(i.type==="audio"){if(t==="aac")return a.box(a.types.stsd,a.STSD,a.mp4a(i));if(t==="mp3"&&i.codec==="mp3")return a.box(a.types.stsd,a.STSD,a.mp3(i))}else if(i.pps&&i.sps){if(t==="avc")return a.box(a.types.stsd,a.STSD,a.avc1(i))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+i.type+" segment codec ("+t+"/"+i.codec+")")},a.tkhd=function(i){var t=i.id,e=(i.duration||0)*(i.timescale||0),r=i.width||0,n=i.height||0,o=Math.floor(e/(Ze+1)),l=Math.floor(e%(Ze+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,n>>8&255,n&255,0,0]))},a.traf=function(i,t){var e=a.sdtp(i),r=i.id,n=Math.floor(t/(Ze+1)),o=Math.floor(t%(Ze+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255])),a.trun(i,e.length+16+20+8+16+8+8),e)},a.trak=function(i){return i.duration=i.duration||4294967295,a.box(a.types.trak,a.tkhd(i),a.mdia(i))},a.trex=function(i){var t=i.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(i,t){var e=i.samples||[],r=e.length,n=12+16*r,o=new Uint8Array(n),l,u,f,d,h,v;for(t+=8+n,o.set([i.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),l=0;l<r;l++)u=e[l],f=u.duration,d=u.size,h=u.flags,v=u.cts,o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*l);return a.box(a.types.trun,o)},a.initSegment=function(i){a.types||a.init();var t=a.moov(i),e=Fe(a.FTYP,t);return e},a.hvc1=function(i){return new Uint8Array},a}();Se.types=void 0,Se.HDLR_TYPES=void 0,Se.STTS=void 0,Se.STSC=void 0,Se.STCO=void 0,Se.STSZ=void 0,Se.VMHD=void 0,Se.SMHD=void 0,Se.STSD=void 0,Se.FTYP=void 0,Se.DINF=void 0;var to=9e4;function ro(a,s,i,t){var e=a*s*i;return Math.round(e)}function vt(a,s){return ro(a,1e3,1/to)}var io=10*1e3,no=1024,ao=1152,so=1536,nt=null,Er=null;function un(a,s,i,t){return{duration:s,size:i,cts:t,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}var yr=function(){function a(i,t,e,r){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=i,this.config=t,this.typeSupported=e,this.logger=r,this.ISGenerated=!1,nt===null){var n=navigator.userAgent||"",o=n.match(/Chrome\/(\d+)/i);nt=o?parseInt(o[1]):0}if(Er===null){var l=navigator.userAgent.match(/Safari\/(\d+)/i);Er=l?parseInt(l[1]):0}}var s=a.prototype;return s.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},s.resetTimeStamp=function(t){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},s.resetNextTimestamp=function(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},s.resetInitSegment=function(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},s.getVideoStartPts=function(t){var e=!1,r=t[0].pts,n=t.reduce(function(o,l){var u=l.pts,f=u-o;return f<-4294967296&&(e=!0,u=Be(u,r),f=u-o),f>0?o:u},r);return e&&this.logger.debug("PTS rollover detected"),n},s.remux=function(t,e,r,n,o,l,u,f){var d,h,v,c,g,m,p=o,y=o,S=t.pid>-1,T=e.pid>-1,x=e.samples.length,A=t.samples.length>0,L=u&&x>0||x>1,R=(!S||A)&&(!T||L)||this.ISGenerated||u;if(R){if(this.ISGenerated){var D,_,b,I,k=this.videoTrackConfig;(k&&(e.width!==k.width||e.height!==k.height||((D=e.pixelRatio)==null?void 0:D[0])!==((_=k.pixelRatio)==null?void 0:_[0])||((b=e.pixelRatio)==null?void 0:b[1])!==((I=k.pixelRatio)==null?void 0:I[1]))||!k&&L||this.nextAudioPts===null&&A)&&this.resetInitSegment()}this.ISGenerated||(v=this.generateIS(t,e,o,l));var w=this.isVideoContiguous,O=-1,P;if(L&&(O=oo(e.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,O>0){this.logger.warn("[mp4-remuxer]: Dropped "+O+" out of "+x+" video samples due to a missing keyframe");var N=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(O),e.dropped+=O,y+=(e.samples[0].pts-N)/e.inputTimeScale,P=y}else O===-1&&(this.logger.warn("[mp4-remuxer]: No keyframe found out of "+x+" video samples"),m=!1);if(this.ISGenerated){if(A&&L){var G=this.getVideoStartPts(e.samples),F=Be(t.samples[0].pts,G)-G,V=F/e.inputTimeScale;p+=Math.max(0,V),y+=Math.max(0,-V)}if(A){if(t.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),v=this.generateIS(t,e,o,l)),h=this.remuxAudio(t,p,this.isAudioContiguous,l,T||L||f===q.AUDIO?y:void 0),L){var ie=h?h.endPTS-h.startPTS:0;e.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),v=this.generateIS(t,e,o,l)),d=this.remuxVideo(e,y,w,ie)}}else L&&(d=this.remuxVideo(e,y,w,0));d&&(d.firstKeyFrame=O,d.independent=O!==-1,d.firstKeyFramePTS=P)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(g=fn(r,o,this._initPTS,this._initDTS)),n.samples.length&&(c=dn(n,o,this._initPTS))),{audio:h,video:d,initSegment:v,independent:m,text:c,id3:g}},s.generateIS=function(t,e,r,n){var o=t.samples,l=e.samples,u=this.typeSupported,f={},d=this._initPTS,h=!d||n,v="audio/mp4",c,g,m;if(h&&(c=g=1/0),t.config&&o.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":u.mpeg?(v="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3";break}f.audio={id:"audio",container:v,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):Se.initSegment([t]),metadata:{channelCount:t.channelCount}},h&&(m=t.inputTimeScale,!d||m!==d.timescale?c=g=o[0].pts-Math.round(m*r):h=!1)}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Se.initSegment([e]),metadata:{width:e.width,height:e.height}},h)if(m=e.inputTimeScale,!d||m!==d.timescale){var p=this.getVideoStartPts(l),y=Math.round(m*r);g=Math.min(g,Be(l[0].dts,p)-y),c=Math.min(c,p-y)}else h=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:c,timescale:m},this._initDTS={baseTime:g,timescale:m}):c=m=void 0,{tracks:f,initPTS:c,timescale:m}},s.remuxVideo=function(t,e,r,n){var o=t.inputTimeScale,l=t.samples,u=[],f=l.length,d=this._initPTS,h=this.nextAvcDts,v=8,c=this.videoSampleDuration,g,m,p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,S=!1;if(!r||h===null){var T=e*o,x=l[0].pts-Be(l[0].dts,l[0].pts);nt&&h!==null&&Math.abs(T-x-h)<15e3?r=!0:h=T-x}for(var A=d.baseTime*o/d.timescale,L=0;L<f;L++){var R=l[L];R.pts=Be(R.pts-A,h),R.dts=Be(R.dts-A,h),R.dts<l[L>0?L-1:L].dts&&(S=!0)}S&&l.sort(function(Vt,Kn){var Ll=Vt.dts-Kn.dts,Al=Vt.pts-Kn.pts;return Ll||Al}),g=l[0].dts,m=l[l.length-1].dts;var D=m-g,_=D?Math.round(D/(f-1)):c||t.inputTimeScale/30;if(r){var b=g-h,I=b>_,k=b<-1;if((I||k)&&(I?this.logger.warn((t.segmentCodec||"").toUpperCase()+": "+vt(b)+" ms ("+b+"dts) hole between fragments detected at "+e.toFixed(3)):this.logger.warn((t.segmentCodec||"").toUpperCase()+": "+vt(-b)+" ms ("+b+"dts) overlapping between fragments detected at "+e.toFixed(3)),!k||h>=l[0].pts||nt)){g=h;var w=l[0].pts-b;if(I)l[0].dts=g,l[0].pts=w;else for(var O=!0,P=0;P<l.length&&!(l[P].dts>w&&O);P++){var N=l[P].pts;if(l[P].dts-=b,l[P].pts-=b,P<l.length-1){var G=l[P+1].pts,F=l[P].pts,V=G<=F,ie=G<=N;O=V==ie}}this.logger.log("Video: Initial PTS/DTS adjusted: "+vt(w)+"/"+vt(g)+", delta: "+vt(b)+" ms")}}g=Math.max(0,g);for(var j=0,se=0,Q=g,ve=0;ve<f;ve++){for(var oe=l[ve],ce=oe.units,Ie=ce.length,Te=0,le=0;le<Ie;le++)Te+=ce[le].data.length;se+=Te,j+=Ie,oe.length=Te,oe.dts<Q?(oe.dts=Q,Q+=_/4|0||1):Q=oe.dts,p=Math.min(oe.pts,p),y=Math.max(oe.pts,y)}m=l[f-1].dts;var De=se+4*j+8,me;try{me=new Uint8Array(De)}catch(Vt){this.observer.emit(E.ERROR,E.ERROR,{type:Y.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:Vt,bytes:De,reason:"fail allocating video mdat "+De});return}var de=new DataView(me.buffer);de.setUint32(0,De),me.set(Se.types.mdat,4);for(var Re=!1,Le=Number.POSITIVE_INFINITY,Pe=Number.POSITIVE_INFINITY,ue=Number.NEGATIVE_INFINITY,Oe=Number.NEGATIVE_INFINITY,pe=0;pe<f;pe++){for(var Ce=l[pe],Et=Ce.units,Nn=0,Ir=0,vl=Et.length;Ir<vl;Ir++){var Bn=Et[Ir],gl=Bn.data,Dr=Bn.data.byteLength;de.setUint32(v,Dr),v+=4,me.set(gl,v),v+=Dr,Nn+=4+Dr}var Gt=void 0;if(pe<f-1)c=l[pe+1].dts-Ce.dts,Gt=l[pe+1].pts-Ce.pts;else{var Un=this.config,Ht=pe>0?Ce.dts-l[pe-1].dts:_;if(Gt=pe>0?Ce.pts-l[pe-1].pts:_,Un.stretchShortVideoTrack&&this.nextAudioPts!==null){var ml=Math.floor(Un.maxBufferHole*o),Cr=(n?p+n*o:this.nextAudioPts)-Ce.pts;Cr>ml?(c=Cr-Ht,c<0?c=Ht:Re=!0,this.logger.log("[mp4-remuxer]: It is approximately "+Cr/90+" ms to the next segment; using duration "+c/90+" ms for the last video frame.")):c=Ht}else c=Ht}var pl=Math.round(Ce.pts-Ce.dts);Le=Math.min(Le,c),ue=Math.max(ue,c),Pe=Math.min(Pe,Gt),Oe=Math.max(Oe,Gt),u.push(un(Ce.key,c,Nn,pl))}if(u.length){if(nt){if(nt<70){var Gn=u[0].flags;Gn.dependsOn=2,Gn.isNonSync=0}}else if(Er&&Oe-Pe<ue-Le&&_/ue<.025&&u[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var kr=g,Ue=0,Hn=u.length;Ue<Hn;Ue++){var Vn=kr+u[Ue].duration,El=kr+u[Ue].cts;if(Ue<Hn-1){var yl=Vn+u[Ue+1].cts;u[Ue].duration=yl-El}else u[Ue].duration=Ue?u[Ue-1].duration:_;u[Ue].cts=0,kr=Vn}}}c=Re||!c?_:c,this.nextAvcDts=h=m+c,this.videoSampleDuration=c,this.isVideoContiguous=!0;var Tl=Se.moof(t.sequenceNumber++,g,ee(t,{samples:u})),Sl="video",xl={data1:Tl,data2:me,startPTS:p/o,endPTS:(y+c)/o,startDTS:g/o,endDTS:h/o,type:Sl,hasAudio:!1,hasVideo:!0,nb:u.length,dropped:t.dropped};return t.samples=[],t.dropped=0,xl},s.getSamplesPerFrame=function(t){switch(t.segmentCodec){case"mp3":return ao;case"ac3":return so;default:return no}},s.remuxAudio=function(t,e,r,n,o){var l=t.inputTimeScale,u=t.samplerate?t.samplerate:l,f=l/u,d=this.getSamplesPerFrame(t),h=d*f,v=this._initPTS,c=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],m=o!==void 0,p=t.samples,y=c?0:8,S=this.nextAudioPts||-1,T=e*l,x=v.baseTime*l/v.timescale;if(this.isAudioContiguous=r=r||p.length&&S>0&&(n&&Math.abs(T-S)<9e3||Math.abs(Be(p[0].pts-x,T)-S)<20*h),p.forEach(function(ue){ue.pts=Be(ue.pts-x,T)}),!r||S<0){if(p=p.filter(function(ue){return ue.pts>=0}),!p.length)return;o===0?S=0:n&&!m?S=Math.max(0,T):S=p[0].pts}if(t.segmentCodec==="aac")for(var A=this.config.maxAudioFramesDrift,L=0,R=S;L<p.length;L++){var D=p[L],_=D.pts,b=_-R,I=Math.abs(1e3*b/l);if(b<=-A*h&&m)L===0&&(this.logger.warn("Audio frame @ "+(_/l).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*b/l)+" ms."),this.nextAudioPts=S=R=_);else if(b>=A*h&&I<io&&m){var k=Math.round(b/h);R=_-k*h,R<0&&(k--,R+=h),L===0&&(this.nextAudioPts=S=R),this.logger.warn("[mp4-remuxer]: Injecting "+k+" audio frame @ "+(R/l).toFixed(3)+"s due to "+Math.round(1e3*b/l)+" ms gap.");for(var w=0;w<k;w++){var O=Math.max(R,0),P=eo.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);P||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),P=D.unit.subarray()),p.splice(L,0,{unit:P,pts:O}),R+=h,L++}}D.pts=R,R+=h}for(var N=null,G=null,F,V=0,ie=p.length;ie--;)V+=p[ie].unit.byteLength;for(var j=0,se=p.length;j<se;j++){var Q=p[j],ve=Q.unit,oe=Q.pts;if(G!==null){var ce=g[j-1];ce.duration=Math.round((oe-G)/f)}else if(r&&t.segmentCodec==="aac"&&(oe=S),N=oe,V>0){V+=y;try{F=new Uint8Array(V)}catch(ue){this.observer.emit(E.ERROR,E.ERROR,{type:Y.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:ue,bytes:V,reason:"fail allocating audio mdat "+V});return}if(!c){var Ie=new DataView(F.buffer);Ie.setUint32(0,V),F.set(Se.types.mdat,4)}}else return;F.set(ve,y);var Te=ve.byteLength;y+=Te,g.push(un(!0,d,Te,0)),G=oe}var le=g.length;if(le){var De=g[g.length-1];this.nextAudioPts=S=G+f*De.duration;var me=c?new Uint8Array(0):Se.moof(t.sequenceNumber++,N/f,ee({},t,{samples:g}));t.samples=[];var de=N/l,Re=S/l,Le="audio",Pe={data1:me,data2:F,startPTS:de,endPTS:Re,startDTS:de,endDTS:Re,type:Le,hasAudio:!0,hasVideo:!1,nb:le};return this.isAudioContiguous=!0,Pe}},a}();function Be(a,s){var i;if(s===null)return a;for(s<a?i=-8589934592:i=8589934592;Math.abs(a-s)>4294967296;)a+=i;return a}function oo(a){for(var s=0;s<a.length;s++)if(a[s].key)return s;return-1}function fn(a,s,i,t){var e=a.samples.length;if(e){for(var r=a.inputTimeScale,n=0;n<e;n++){var o=a.samples[n];o.pts=Be(o.pts-i.baseTime*r/i.timescale,s*r)/r,o.dts=Be(o.dts-t.baseTime*r/t.timescale,s*r)/r}var l=a.samples;return a.samples=[],{samples:l}}}function dn(a,s,i){var t=a.samples.length;if(t){for(var e=a.inputTimeScale,r=0;r<t;r++){var n=a.samples[r];n.pts=Be(n.pts-i.baseTime*e/i.timescale,s*e)/e}a.samples.sort(function(l,u){return l.pts-u.pts});var o=a.samples;return a.samples=[],{samples:o}}}var lo=function(){function a(i,t,e,r){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=r}var s=a.prototype;return s.destroy=function(){},s.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},s.resetNextTimestamp=function(){this.lastEndTime=null},s.resetInitSegment=function(t,e,r,n){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(da(t,n)),this.emitInitSegment=!0},s.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Zr(t);n.audio&&(e=hn(n.audio,fe.AUDIO)),n.video&&(r=hn(n.video,fe.VIDEO));var o={};n.audio&&n.video?o.audiovideo={container:"video/mp4",codec:e+","+r,supplemental:n.video.supplemental,initSegment:t,id:"main"}:n.audio?o.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:n.video?o.video={container:"video/mp4",codec:r,supplemental:n.video.supplemental,initSegment:t,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},s.remux=function(t,e,r,n,o,l){var u,f,d=this.initPTS,h=this.lastEndTime,v={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};U(h)||(h=this.lastEndTime=o||0);var c=e.samples;if(!(c!=null&&c.length))return v;var g={initPTS:void 0,timescale:1},m=this.initData;if((u=m)!=null&&u.length||(this.generateInitSegment(c),m=this.initData),!((f=m)!=null&&f.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),v;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var p=va(c,m),y=ca(m,c),S=y===null?o:y;(l||!d)&&(uo(d,S,o,p)||g.timescale!==d.timescale)&&(g.initPTS=S-o,d&&d.timescale===1&&this.logger.warn("Adjusting initPTS @"+o+" from "+d.baseTime/d.timescale+" to "+g.initPTS),this.initPTS=d={baseTime:g.initPTS,timescale:1});var T=t?S-d.baseTime/d.timescale:h,x=T+p;ma(m,c,d.baseTime/d.timescale),p>0?this.lastEndTime=x:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var A=!!m.audio,L=!!m.video,R="";A&&(R+="audio"),L&&(R+="video");var D={data1:c,startPTS:T,startDTS:T,endPTS:x,endDTS:x,type:R,hasAudio:A,hasVideo:L,nb:1,dropped:0};return v.audio=D.type==="audio"?D:void 0,v.video=D.type!=="audio"?D:void 0,v.initSegment=g,v.id3=fn(r,o,d,d),n.samples.length&&(v.text=dn(n,o,d)),v},a}();function uo(a,s,i,t){if(a===null)return!0;var e=Math.max(t,1),r=s-a.baseTime/a.timescale;return Math.abs(r-i)>e}function hn(a,s){var i=a==null?void 0:a.codec;if(i&&i.length>4)return i;if(s===fe.AUDIO){if(i==="ec-3"||i==="ac-3"||i==="alac")return i;if(i==="fLaC"||i==="Opus"){var t=!1;return Lt(i,t)}return te.warn('Unhandled audio codec "'+i+'" in mp4 MAP'),i||"mp4a"}return te.warn('Unhandled video codec "'+i+'" in mp4 MAP'),i||"avc1"}var qe;try{qe=self.performance.now.bind(self.performance)}catch{qe=Date.now}var Tr=[{demux:Xs,remux:lo},{demux:Qs,remux:yr},{demux:Bs,remux:yr},{demux:Gs,remux:yr}],Sr=function(){function a(i,t,e,r,n,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=t,this.config=e,this.id=n,this.logger=o}var s=a.prototype;return s.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},s.push=function(t,e,r,n){var o=this,l=r.transmuxing;l.executeStart=qe();var u=new Uint8Array(t),f=this.currentTransmuxState,d=this.transmuxConfig;n&&(this.currentTransmuxState=n);var h=n||f,v=h.contiguous,c=h.discontinuity,g=h.trackSwitch,m=h.accurateTimeOffset,p=h.timeOffset,y=h.initSegmentChange,S=d.audioCodec,T=d.videoCodec,x=d.defaultInitPts,A=d.duration,L=d.initSegmentData,R=fo(u,e);if(R&&ht(R.method)){var D=this.getDecrypter(),_=Ai(R.method);if(D.isSync()){var b=D.softwareDecrypt(u,R.key.buffer,R.iv.buffer,_),I=r.part>-1;if(I){var k=D.flush();b=k&&k.buffer}if(!b)return l.executeEnd=qe(),xr(r);u=new Uint8Array(b)}else return this.asyncResult=!0,this.decryptionPromise=D.webCryptoDecrypt(u,R.key.buffer,R.iv.buffer,_).then(function(G){var F=o.push(G,null,r);return o.decryptionPromise=null,F}),this.decryptionPromise}var w=this.needsProbing(c,g);if(w){var O=this.configureTransmuxer(u);if(O)return this.logger.warn("[transmuxer] "+O.message),this.observer.emit(E.ERROR,E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),l.executeEnd=qe(),xr(r)}(c||g||y||w)&&this.resetInitSegment(L,S,T,A,e),(c||y||w)&&this.resetInitialTimestamp(x),v||this.resetContiguity();var P=this.transmux(u,R,p,m,r);this.asyncResult=Je(P);var N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,l.executeEnd=qe(),P},s.flush=function(t){var e=this,r=t.transmuxing;r.executeStart=qe();var n=this.decrypter,o=this.currentTransmuxState,l=this.decryptionPromise;if(l)return this.asyncResult=!0,l.then(function(){return e.flush(t)});var u=[],f=o.timeOffset;if(n){var d=n.flush();d&&u.push(this.push(d.buffer,null,t))}var h=this.demuxer,v=this.remuxer;if(!h||!v){r.executeEnd=qe();var c=[xr(t)];return this.asyncResult?Promise.resolve(c):c}var g=h.flush(f);return Je(g)?(this.asyncResult=!0,g.then(function(m){return e.flushRemux(u,m,t),u})):(this.flushRemux(u,g,t),this.asyncResult?Promise.resolve(u):u)},s.flushRemux=function(t,e,r){var n=e.audioTrack,o=e.videoTrack,l=e.id3Track,u=e.textTrack,f=this.currentTransmuxState,d=f.accurateTimeOffset,h=f.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+r.sn+(r.part>-1?" part: "+r.part:"")+" of "+(this.id===q.MAIN?"level":"track")+" "+r.level);var v=this.remuxer.remux(n,o,l,u,h,d,!0,this.id);t.push({remuxResult:v,chunkMeta:r}),r.transmuxing.executeEnd=qe()},s.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;!e||!r||(e.resetTimeStamp(t),r.resetTimeStamp(t))},s.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())},s.resetInitSegment=function(t,e,r,n,o){var l=this.demuxer,u=this.remuxer;!l||!u||(l.resetInitSegment(t,e,r,n),u.resetInitSegment(t,e,r,o))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(t,e,r,n,o){var l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(t,e,r,n,o):l=this.transmuxUnencrypted(t,r,n,o),l},s.transmuxUnencrypted=function(t,e,r,n){var o=this.demuxer.demux(t,e,!1,!this.config.progressive),l=o.audioTrack,u=o.videoTrack,f=o.id3Track,d=o.textTrack,h=this.remuxer.remux(l,u,f,d,e,r,!1,this.id);return{remuxResult:h,chunkMeta:n}},s.transmuxSampleAes=function(t,e,r,n,o){var l=this;return this.demuxer.demuxSampleAes(t,e,r).then(function(u){var f=l.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,r,n,!1,l.id);return{remuxResult:f,chunkMeta:o}})},s.configureTransmuxer=function(t){for(var e=this.config,r=this.observer,n=this.typeSupported,o,l=0,u=Tr.length;l<u;l++){var f;if((f=Tr[l].demux)!=null&&f.probe(t,this.logger)){o=Tr[l];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,v=o.remux,c=o.demux;(!h||!(h instanceof v))&&(this.remuxer=new v(r,e,n,this.logger)),(!d||!(d instanceof c))&&(this.demuxer=new c(r,e,n,this.logger),this.probe=c.probe)},s.needsProbing=function(t,e){return!this.demuxer||!this.remuxer||t||e},s.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new gr(this.config)),t},a}();function fo(a,s){var i=null;return a.byteLength>0&&(s==null?void 0:s.key)!=null&&s.iv!==null&&s.method!=null&&(i=s),i}var xr=function(s){return{remuxResult:{},chunkMeta:s}};function Je(a){return"then"in a&&a.then instanceof Function}var ho=function(s,i,t,e,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=i,this.initSegmentData=t,this.duration=e,this.defaultInitPts=r||null},co=function(s,i,t,e,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=i,this.accurateTimeOffset=t,this.trackSwitch=e,this.timeOffset=r,this.initSegmentChange=n};function vo(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var go=/(\d+)-(\d+)\/(\d+)/,cn=function(){function a(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||yo,this.controller=new self.AbortController,this.stats=new Qt}var s=a.prototype;return s.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},s.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},s.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},s.load=function(t,e,r){var n=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var l=mo(t,this.controller.signal),u=t.responseType==="arraybuffer",f=u?"byteLength":"length",d=e.loadPolicy,h=d.maxTimeToFirstByteMs,v=d.maxLoadTimeMs;this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,l),self.clearTimeout(this.requestTimeout),e.timeout=h&&U(h)?h:v,this.requestTimeout=self.setTimeout(function(){n.callbacks&&(n.abortInternal(),n.callbacks.onTimeout(o,t,n.response))},e.timeout);var c=Je(this.request)?this.request.then(self.fetch):self.fetch(this.request);c.then(function(g){var m;n.response=n.loader=g;var p=Math.max(self.performance.now(),o.loading.start);if(self.clearTimeout(n.requestTimeout),e.timeout=v,n.requestTimeout=self.setTimeout(function(){n.callbacks&&(n.abortInternal(),n.callbacks.onTimeout(o,t,n.response))},v-(p-o.loading.start)),!g.ok){var y=g.status,S=g.statusText;throw new To(S||"fetch, bad network response",y,g)}o.loading.first=p,o.total=Eo(g.headers)||o.total;var T=(m=n.callbacks)==null?void 0:m.onProgress;return T&&U(e.highWaterMark)?n.loadProgressively(g,o,t,e.highWaterMark,T):u?g.arrayBuffer():t.responseType==="json"?g.json():g.text()}).then(function(g){var m,p,y=n.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(n.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first);var S=g[f];S&&(o.loaded=o.total=S);var T={url:y.url,data:g,code:y.status},x=(m=n.callbacks)==null?void 0:m.onProgress;x&&!U(e.highWaterMark)&&x(o,t,g,y),(p=n.callbacks)==null||p.onSuccess(T,o,t,y)}).catch(function(g){var m;if(self.clearTimeout(n.requestTimeout),!o.aborted){var p=g&&g.code||0,y=g?g.message:null;(m=n.callbacks)==null||m.onError({code:p,text:y},t,g?g.details:null,o)}})},s.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},s.getResponseHeader=function(t){return this.response?this.response.headers.get(t):null},s.loadProgressively=function(t,e,r,n,o){n===void 0&&(n=0);var l=new hs,u=t.body.getReader(),f=function(){return u.read().then(function(h){if(h.done)return l.dataLength&&o(e,r,l.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));var v=h.value,c=v.length;return e.loaded+=c,c<n||l.dataLength?(l.push(v),l.dataLength>=n&&o(e,r,l.flush().buffer,t)):o(e,r,v.buffer,t),f()}).catch(function(){return Promise.reject()})};return f()},a}();function mo(a,s){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:s,headers:new self.Headers(ee({},a.headers))};return a.rangeEnd&&i.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),i}function po(a){var s=go.exec(a);if(s)return parseInt(s[2])-parseInt(s[1])+1}function Eo(a){var s=a.get("Content-Range");if(s){var i=po(s);if(U(i))return i}var t=a.get("Content-Length");if(t)return parseInt(t)}function yo(a,s){return new self.Request(a.url,s)}var To=function(a){function s(i,t,e){var r;return r=a.call(this,i)||this,r.code=void 0,r.details=void 0,r.code=t,r.details=e,r}return he(s,a),s}(ft(Error)),So=/^age:\s*[\d.]+\s*$/im,vn=function(){function a(i){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=i&&i.xhrSetup||null,this.stats=new Qt,this.retryDelay=0}var s=a.prototype;return s.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},s.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))},s.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},s.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.loadInternal()},s.loadInternal=function(){var t=this,e=this.config,r=this.context;if(!(!e||!r)){var n=this.loader=new self.XMLHttpRequest,o=this.stats;o.loading.first=0,o.loaded=0,o.aborted=!1;var l=this.xhrSetup;l?Promise.resolve().then(function(){if(!(t.loader!==n||t.stats.aborted))return l(n,r.url)}).catch(function(u){if(!(t.loader!==n||t.stats.aborted))return n.open("GET",r.url,!0),l(n,r.url)}).then(function(){t.loader!==n||t.stats.aborted||t.openAndSendXhr(n,r,e)}).catch(function(u){var f;(f=t.callbacks)==null||f.onError({code:n.status,text:u.message},r,n,o)}):this.openAndSendXhr(n,r,e)}},s.openAndSendXhr=function(t,e,r){t.readyState||t.open("GET",e.url,!0);var n=e.headers,o=r.loadPolicy,l=o.maxTimeToFirstByteMs,u=o.maxLoadTimeMs;if(n)for(var f in n)t.setRequestHeader(f,n[f]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),r.timeout=l&&U(l)?l:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),t.send()},s.readystatechange=function(){var t=this.context,e=this.loader,r=this.stats;if(!(!t||!e)){var n=e.readyState,o=this.config;if(!r.aborted&&n>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var l=e.status,u=e.responseType==="text"?e.responseText:null;if(l>=200&&l<300){var f=u??e.response;if(f!=null){var d,h;r.loading.end=Math.max(self.performance.now(),r.loading.first);var v=e.responseType==="arraybuffer"?f.byteLength:f.length;r.loaded=r.total=v,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);var c=(d=this.callbacks)==null?void 0:d.onProgress;c&&c(r,t,f,e);var g={url:e.responseURL,data:f,code:l};(h=this.callbacks)==null||h.onSuccess(g,r,t,e);return}}var m=o.loadPolicy.errorRetry,p=r.retry,y={url:t.url,data:void 0,code:l};if(It(m,p,!1,y))this.retry(m);else{var S;te.error(l+" while loading "+t.url),(S=this.callbacks)==null||S.onError({code:l,text:e.statusText},t,e,r)}}}},s.loadtimeout=function(){if(this.config){var t=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(It(t,e,!0))this.retry(t);else{var r;te.warn("timeout while loading "+((r=this.context)==null?void 0:r.url));var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}},s.retry=function(t){var e=this.context,r=this.stats;this.retryDelay=sr(t,r.retry),r.retry++,te.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(e==null?void 0:e.url)+", retrying "+r.retry+"/"+t.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},s.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},s.getCacheAge=function(){var t=null;if(this.loader&&So.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},s.getResponseHeader=function(t){return this.loader&&new RegExp("^"+t+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null},a}(),gn={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},xo=be(be({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:vn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ma,bufferController:Ka,capLevelController:Ya,errorController:Ha,fpsController:ds,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!1,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!1,certLoadPolicy:{default:gn},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:gn},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Lo()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:fs,interstitialsController:void 0});function Lo(){return{cueHandler:na,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Ao(a,s,i){if((s.liveSyncDurationCount||s.liveMaxLatencyDurationCount)&&(s.liveSyncDuration||s.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(s.liveMaxLatencyDurationCount!==void 0&&(s.liveSyncDurationCount===void 0||s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var t=Lr(a),e=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(n){var o=(n==="level"?"playlist":n)+"LoadPolicy",l=s[o]===void 0,u=[];r.forEach(function(f){var d=n+"Loading"+f,h=s[d];if(h!==void 0&&l){u.push(d);var v=t[o].default;switch(s[o]={default:v},f){case"TimeOut":v.maxLoadTimeMs=h,v.maxTimeToFirstByteMs=h;break;case"MaxRetry":v.errorRetry.maxNumRetry=h,v.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":v.errorRetry.retryDelayMs=h,v.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=h,v.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&i.warn('hls.js config: "'+u.join('", "')+'" setting(s) are deprecated, use "'+o+'": '+Ae(s[o]))}),be(be({},t),s)}function Lr(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(Lr):Object.keys(a).reduce(function(s,i){return s[i]=Lr(a[i]),s},{}):a}function Ro(a,s){var i=a.loader;if(i!==cn&&i!==vn)s.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var t=vo();t&&(a.loader=cn,a.progressive=!0,a.enableSoftwareAES=!0,s.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var _e={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},bo=function(){function a(i){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=i,this._registerListeners()}var s=a.prototype;return s._registerListeners=function(){var t=this.hls;t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.BUFFER_APPENDED,this.onBufferAppended,this),t.on(E.FRAG_BUFFERED,this.onFragBuffered,this),t.on(E.FRAG_LOADED,this.onFragLoaded,this)},s._unregisterListeners=function(){var t=this.hls;t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.BUFFER_APPENDED,this.onBufferAppended,this),t.off(E.FRAG_BUFFERED,this.onFragBuffered,this),t.off(E.FRAG_LOADED,this.onFragLoaded,this)},s.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},s.getAppendedFrag=function(t,e){var r=this.activePartLists[e];if(r)for(var n=r.length;n--;){var o=r[n];if(!o)break;var l=o.end;if(o.start<=t&&l!==null&&t<=l)return o}return this.getBufferedFrag(t,e)},s.getBufferedFrag=function(t,e){return this.getFragAtPos(t,e,!0)},s.getFragAtPos=function(t,e,r){for(var n=this.fragments,o=Object.keys(n),l=o.length;l--;){var u=n[o[l]];if((u==null?void 0:u.body.type)===e&&(!r||u.buffered)){var f=u.body;if(f.start<=t&&t<=f.end)return f}}return null},s.detectEvictedFragments=function(t,e,r,n,o){var l=this;this.timeRanges&&(this.timeRanges[t]=e);var u=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(f){var d=l.fragments[f];if(d&&!(u>=d.body.sn)){if(!d.buffered&&(!d.loaded||o)){d.body.type===r&&l.removeFragment(d.body);return}var h=d.range[t];if(h){if(h.time.length===0){l.removeFragment(d.body);return}h.time.some(function(v){var c=!l.isTimeBuffered(v.startPTS,v.endPTS,e);return c&&l.removeFragment(d.body),c})}}})},s.detectPartialFragments=function(t){var e=this,r=this.timeRanges;if(!(!r||t.frag.sn==="initSegment")){var n=t.frag,o=at(n),l=this.fragments[o];if(!(!l||l.buffered&&n.gap)){var u=!n.relurl;if(Object.keys(r).forEach(function(d){var h=n.elementaryStreams[d];if(h){var v=r[d],c=u||h.partial===!0;l.range[d]=e.getBufferedTimes(n,t.part,c,v)}}),l.loaded=null,Object.keys(l.range).length){l.buffered=!0;var f=l.body.endList=n.endList||l.body.endList;f&&(this.endListFragments[l.body.type]=l),Ft(l)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(l.body)}}},s.removeParts=function(t,e){var r=this.activePartLists[e];r&&(this.activePartLists[e]=mn(r,function(n){return n.fragment.sn>=t}))},s.fragBuffered=function(t,e){var r=at(t),n=this.fragments[r];!n&&e&&(n=this.fragments[r]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)},s.getBufferedTimes=function(t,e,r,n){for(var o={time:[],partial:r},l=t.start,u=t.end,f=t.minEndPTS||u,d=t.maxStartPTS||l,h=0;h<n.length;h++){var v=n.start(h)-this.bufferPadding,c=n.end(h)+this.bufferPadding;if(d>=v&&f<=c){o.time.push({startPTS:Math.max(l,n.start(h)),endPTS:Math.min(u,n.end(h))});break}else if(l<c&&u>v){var g=Math.max(l,n.start(h)),m=Math.min(u,n.end(h));m>g&&(o.partial=!0,o.time.push({startPTS:g,endPTS:m}))}else if(u<=v)break}return o},s.getPartialFragment=function(t){var e=null,r,n,o,l=0,u=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(d){var h=f[d];h&&Ft(h)&&(n=h.body.start-u,o=h.body.end+u,t>=n&&t<=o&&(r=Math.min(t-n,o-t),l<=r&&(e=h.body,l=r)))}),e},s.isEndListAppended=function(t){var e=this.endListFragments[t];return e!==void 0&&(e.buffered||Ft(e))},s.getState=function(t){var e=at(t),r=this.fragments[e];return r?r.buffered?Ft(r)?_e.PARTIAL:_e.OK:_e.APPENDING:_e.NOT_LOADED},s.isTimeBuffered=function(t,e,r){for(var n,o,l=0;l<r.length;l++){if(n=r.start(l)-this.bufferPadding,o=r.end(l)+this.bufferPadding,t>=n&&e<=o)return!0;if(e<=n)return!1}return!1},s.onManifestLoading=function(){this.removeAllFragments()},s.onFragLoaded=function(t,e){if(!(e.frag.sn==="initSegment"||e.frag.bitrateTest)){var r=e.frag,n=e.part?null:e,o=at(r);this.fragments[o]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}},s.onBufferAppended=function(t,e){var r=e.frag,n=e.part,o=e.timeRanges,l=e.type;if(r.sn!=="initSegment"){var u=r.type;if(n){var f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(n)}this.timeRanges=o;var d=o[l];this.detectEvictedFragments(l,d,u,n)}},s.onFragBuffered=function(t,e){this.detectPartialFragments(e)},s.hasFragment=function(t){var e=at(t);return!!this.fragments[e]},s.hasFragments=function(t){var e=this.fragments,r=Object.keys(e);if(!t)return r.length>0;for(var n=r.length;n--;){var o=e[r[n]];if((o==null?void 0:o.body.type)===t)return!0}return!1},s.hasParts=function(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)},s.removeFragmentsInRange=function(t,e,r,n,o){var l=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach(function(u){var f=l.fragments[u];if(f){var d=f.body;d.type!==r||n&&!d.gap||d.start<e&&d.end>t&&(f.buffered||o)&&l.removeFragment(d)}})},s.removeFragment=function(t){var e=at(t);t.clearElementaryStreamInfo();var r=this.activePartLists[t.type];if(r){var n=t.sn;this.activePartLists[t.type]=mn(r,function(o){return o.fragment.sn!==n})}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]},s.removeAllFragments=function(){var t,e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var r=(t=this.hls)==null||(e=t.latestLevelDetails)==null?void 0:e.partList;r&&r.forEach(function(n){return n.clearElementaryStreamInfo()})},a}();function Ft(a){var s,i,t;return a.buffered&&(a.body.gap||((s=a.range.video)==null?void 0:s.partial)||((i=a.range.audio)==null?void 0:i.partial)||((t=a.range.audiovideo)==null?void 0:t.partial))}function at(a){return a.type+"_"+a.level+"_"+a.sn}function mn(a,s){return a.filter(function(i){var t=s(i);return t||i.clearElementaryStreamInfo(),t})}var pn=Math.pow(2,17),_o=function(){function a(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var s=a.prototype;return s.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},s.abort=function(){this.loader&&this.loader.abort()},s.load=function(t,e){var r=this,n=t.url;if(!n)return Promise.reject(new je({type:Y.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();var o=this.config,l=o.fLoader,u=o.loader;return new Promise(function(f,d){if(r.loader&&r.loader.destroy(),t.gap)if(t.tagList.some(function(p){return p[0]==="GAP"})){d(yn(t));return}else t.gap=!1;var h=r.loader=l?new l(o):new u(o),v=En(t);t.loader=h;var c=pi(o.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:pn};t.stats=h.stats;var m={onSuccess:function(y,S,T,x){r.resetLoader(t,h);var A=y.data;T.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),f({frag:t,part:null,payload:A,networkDetails:x})},onError:function(y,S,T,x){r.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:be({url:n,data:void 0},y),error:new Error("HTTP Error "+y.code+" "+y.text),networkDetails:T,stats:x}))},onAbort:function(y,S,T){r.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:T,stats:y}))},onTimeout:function(y,S,T){r.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:T,stats:y}))}};e&&(m.onProgress=function(p,y,S,T){return e({frag:t,part:null,payload:S,networkDetails:T})}),h.load(v,g,m)})},s.loadPart=function(t,e,r){var n=this;this.abort();var o=this.config,l=o.fLoader,u=o.loader;return new Promise(function(f,d){if(n.loader&&n.loader.destroy(),t.gap||e.gap){d(yn(t,e));return}var h=n.loader=l?new l(o):new u(o),v=En(t,e);t.loader=h;var c=pi(o.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:pn};e.stats=h.stats,h.load(v,g,{onSuccess:function(p,y,S,T){n.resetLoader(t,h),n.updateStatsFromPart(t,e);var x={frag:t,part:e,payload:p.data,networkDetails:T};r(x),f(x)},onError:function(p,y,S,T){n.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:be({url:v.url,data:void 0},p),error:new Error("HTTP Error "+p.code+" "+p.text),networkDetails:S,stats:T}))},onAbort:function(p,y,S){t.stats.aborted=e.stats.aborted,n.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:S,stats:p}))},onTimeout:function(p,y,S){n.resetLoader(t,h),d(new je({type:Y.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:S,stats:p}))}})})},s.updateStatsFromPart=function(t,e){var r=t.stats,n=e.stats,o=n.total;if(r.loaded+=n.loaded,o){var l=Math.round(t.duration/e.duration),u=Math.min(Math.round(r.loaded/o),l),f=l-u,d=f*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);var h=r.loading,v=n.loading;h.start?h.first+=v.first-v.start:(h.start=v.start,h.first=v.first),h.end=v.end},s.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},a}();function En(a,s){s===void 0&&(s=null);var i=s||a,t={frag:a,part:s,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},e=i.byteRangeStartOffset,r=i.byteRangeEndOffset;if(U(e)&&U(r)){var n,o=e,l=r;if(a.sn==="initSegment"&&Io((n=a.decryptdata)==null?void 0:n.method)){var u=r-e;u%16&&(l=r+(16-u%16)),e!==0&&(t.resetIV=!0,o=e-16)}t.rangeStart=o,t.rangeEnd=l}return t}function yn(a,s){var i=new Error("GAP "+(a.gap?"tag":"attribute")+" found"),t={type:Y.MEDIA_ERROR,details:C.FRAG_GAP,fatal:!1,frag:a,error:i,networkDetails:null};return s&&(t.part=s),(s||a).stats.aborted=!0,new je(t)}function Io(a){return a==="AES-128"||a==="AES-256"}var je=function(a){function s(i){var t;return t=a.call(this,i.error.message)||this,t.data=void 0,t.data=i,t}return he(s,a),s}(ft(Error)),Tn=function(a){function s(t,e){var r;return r=a.call(this,t,e)||this,r._boundTick=void 0,r._tickTimer=null,r._tickInterval=null,r._tickCallCount=0,r._boundTick=r.tick.bind(r),r}he(s,a);var i=s.prototype;return i.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.onHandlerDestroyed=function(){},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},i.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},i.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},i.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},i.doTick=function(){},s}(tt),Sn=function(s,i,t,e,r,n){e===void 0&&(e=0),r===void 0&&(r=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Nt(),this.buffering={audio:Nt(),video:Nt(),audiovideo:Nt()},this.level=s,this.sn=i,this.id=t,this.size=e,this.part=r,this.partial=n};function Nt(){return{start:0,executeStart:0,executeEnd:0,end:0}}function gt(a,s){for(var i=0,t=a.length;i<t;i++){var e;if(((e=a[i])==null?void 0:e.cc)===s)return a[i]}return null}function Do(a,s){return!!(a&&s.startCC<a.endCC&&s.endCC>a.startCC)}function xn(a,s){if(a){var i=a.start+s;a.start=a.startPTS=i,a.endPTS=i+a.duration}}function Ln(a,s){for(var i=s.fragments,t=0,e=i.length;t<e;t++)xn(i[t],a);s.fragmentHint&&xn(s.fragmentHint,a),s.alignedSliding=!0}function Co(a,s){a&&(ko(s,a),!s.alignedSliding&&a&&Po(s,a),!s.alignedSliding&&a&&!s.skippedSegments&&Ni(a,s,!1))}function ko(a,s){if(Do(s,a)){var i=Math.min(s.endCC,a.endCC),t=gt(s.fragments,i),e=gt(a.fragments,i);if(!(!t||!e)){te.log("Aligning playlist at start of dicontinuity sequence "+i);var r=t.start-e.start;Ln(r,a)}}}function Po(a,s){if(!(!a.hasProgramDateTime||!s.hasProgramDateTime)){var i=a.fragments,t=s.fragments;if(!(!i.length||!t.length)){var e,r,n=Math.min(s.endCC,a.endCC);s.startCC<n&&a.startCC<n&&(e=gt(t,n),r=gt(i,n)),(!e||!r)&&(e=t[Math.floor(t.length/2)],r=gt(i,e.cc)||i[Math.floor(i.length/2)]);var o=e.programDateTime,l=r.programDateTime;if(!(!o||!l)){var u=(l-o)/1e3-(r.start-e.start);Ln(u,a)}}}}var Oo={toString:function(s){for(var i="",t=s.length,e=0;e<t;e++)i+="["+s.start(e).toFixed(3)+"-"+s.end(e).toFixed(3)+"]";return i}},M={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_LEVEL:"WAITING_LEVEL"},Mo=function(a){function s(t,e,r,n,o){var l;return l=a.call(this,n,t.logger)||this,l.hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=M.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,f=u.config,d=u.fragCurrent,h=u.media,v=u.mediaBuffer,c=u.state,g=h?h.currentTime:0,m=ae.bufferInfo(v||h,g,f.maxBufferHole);if(l.log("media seeking to "+(U(g)?g.toFixed(3):g)+", state: "+c),l.state===M.ENDED)l.resetLoadingState();else if(d){var p=f.maxFragLookUpTolerance,y=d.start-p,S=d.start+d.duration+p;if(!m.len||S<m.start||y>m.end){var T=g>S;(g<y||T)&&(T&&d.loader&&(l.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(h){l.fragmentTracker.removeFragmentsInRange(g,1/0,l.playlistType,!0);var x=l.lastCurrentTime;if(g>x&&(l.lastCurrentTime=g),!l.loadingParts){var A=Math.max(m.end,g),L=l.shouldLoadParts(l.getLevelDetails(),A);L&&(l.log("LL-Part loading ON after seeking to "+g.toFixed(2)+" with buffer @"+A.toFixed(2)),l.loadingParts=L)}}!l.hls.hasEnoughToStart&&!m.len&&(l.log("setting startPosition to "+g+" because of seek before start"),l.nextLoadPosition=l.startPosition=g),l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=o,l.hls=t,l.fragmentLoader=new _o(t.config),l.keyLoader=r,l.fragmentTracker=e,l.config=t.config,l.decrypter=new gr(t.config),l}he(s,a);var i=s.prototype;return i.registerListeners=function(){var e=this.hls;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.ERROR,this.onError,this)},i.unregisterListeners=function(){var e=this.hls;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.ERROR,this.onError,this)},i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(e){},i.stopLoad=function(){if(this.state!==M.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=M.STOPPED}},i.pauseBuffering=function(){this.buffering=!1},i.resumeBuffering=function(){this.buffering=!0},i._streamEnded=function(e,r){if(r.live||!this.media)return!1;var n=e.end||0,o=this.config.timelineOffset||0;if(n<=o)return!1;var l=e.nextStart,u=l&&l>o&&l<r.edge;if(u||this.media.currentTime<e.start)return!1;var f=r.partList;if(f!=null&&f.length){var d=f[f.length-1],h=ae.isBuffered(this.media,d.start+d.duration/2);return h}var v=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(v)},i.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}},i.onMediaAttached=function(e,r){var n=this.media=this.mediaBuffer=r.media;n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),n.addEventListener("seeking",this.onMediaSeeking),n.addEventListener("ended",this.onMediaEnded);var o=this.config;this.levels&&o.autoStartLoad&&this.state===M.STOPPED&&this.startLoad(o.startPosition)},i.onMediaDetaching=function(e,r){var n=!!r.transferMedia,o=this.media;if(o!==null){if(o.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),o.removeEventListener("seeking",this.onMediaSeeking),o.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},i.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},i.onError=function(e,r){},i.onManifestLoaded=function(e,r){this.startTimeOffset=r.startTimeOffset},i.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),a.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},i.onHandlerDestroyed=function(){this.state=M.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},i.loadFragment=function(e,r,n){this.startFragRequested=!0,this._loadFragForPlayback(e,r,n)},i._loadFragForPlayback=function(e,r,n){var o=this,l=function(f){var d=f.frag;if(o.fragContextChanged(d)){o.warn(d.type+" sn: "+d.sn+(f.part?" part: "+f.part.index:"")+" of "+o.fragInfo(d,!1,f.part)+") was dropped during download."),o.fragmentTracker.removeFragment(d);return}d.stats.chunkCount++,o._handleFragmentLoadProgress(f)};this._doFragLoad(e,r,n,l).then(function(u){if(u){var f=o.state,d=u.frag;if(o.fragContextChanged(d)){(f===M.FRAG_LOADING||!o.fragCurrent&&f===M.PARSING)&&(o.fragmentTracker.removeFragment(d),o.state=M.IDLE);return}"payload"in u&&(o.log("Loaded "+d.type+" sn: "+d.sn+" of "+o.playlistLabel()+" "+d.level),o.hls.trigger(E.FRAG_LOADED,u)),o._handleFragmentLoadComplete(u)}}).catch(function(u){o.state===M.STOPPED||o.state===M.ERROR||(o.warn("Frag error: "+((u==null?void 0:u.message)||u)),o.resetFragmentLoading(e))})},i.clearTrackerIfNeeded=function(e){var r,n=this.fragmentTracker,o=n.getState(e);if(o===_e.APPENDING){var l=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(e.duration,u?u.len:this.config.maxBufferLength),d=this.backtrackFragment,h=d?e.sn-d.sn:0;(h===1||this.reduceMaxBufferLength(f,e.duration))&&n.removeFragment(e)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===_e.PARTIAL&&n.removeFragment(e))},i.checkLiveUpdate=function(e){if(e.updated&&!e.live){var r=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},i.waitForLive=function(e){var r=e.details;return(r==null?void 0:r.live)&&r.type!=="EVENT"&&(this.levelLastLoaded!==e||r.expired)},i.flushMainBuffer=function(e,r,n){if(n===void 0&&(n=null),!!(e-r)){var o={startOffset:e,endOffset:r,type:n};this.hls.trigger(E.BUFFER_FLUSHING,o)}},i._loadInitSegment=function(e,r){var n=this;this._doFragLoad(e,r).then(function(o){var l=o==null?void 0:o.frag;if(!l||n.fragContextChanged(l)||!n.levels)throw new Error("init load aborted");return o}).then(function(o){var l=n.hls,u=o.frag,f=o.payload,d=u.decryptdata;if(f&&f.byteLength>0&&d!=null&&d.key&&d.iv&&ht(d.method)){var h=self.performance.now();return n.decrypter.decrypt(new Uint8Array(f),d.key.buffer,d.iv.buffer,Ai(d.method)).catch(function(v){throw l.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:v,reason:v.message,frag:u}),v}).then(function(v){var c=self.performance.now();return l.trigger(E.FRAG_DECRYPTED,{frag:u,payload:v,stats:{tstart:h,tdecrypt:c}}),o.payload=v,n.completeInitSegmentLoad(o)})}return n.completeInitSegmentLoad(o)}).catch(function(o){n.state===M.STOPPED||n.state===M.ERROR||(n.warn(o),n.resetFragmentLoading(e))})},i.completeInitSegmentLoad=function(e){var r=this.levels;if(!r)throw new Error("init load aborted, missing levels");var n=e.frag.stats;this.state!==M.STOPPED&&(this.state=M.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()},i.fragContextChanged=function(e){var r=this.fragCurrent;return!e||!r||e.sn!==r.sn||e.level!==r.level},i.fragBufferedComplete=function(e,r){var n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(r?" part: "+r.index:"")+" of "+this.fragInfo(e,!1,r)+" > buffer:"+(n?Oo.toString(ae.getBuffered(n)):"(detached)")+")"),we(e)){var o;if(e.type!==q.SUBTITLE){var l=e.elementaryStreams;if(!Object.keys(l).some(function(f){return!!l[f]})){this.state=M.IDLE;return}}var u=(o=this.levels)==null?void 0:o[e.level];u!=null&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=M.IDLE},i._handleFragmentLoadComplete=function(e){var r=this.transmuxer;if(r){var n=e.frag,o=e.part,l=e.partsLoaded,u=!l||l.length===0||l.some(function(d){return!d}),f=new Sn(n.level,n.sn,n.stats.chunkCount+1,0,o?o.index:-1,!u);r.flush(f)}},i._handleFragmentLoadProgress=function(e){},i._doFragLoad=function(e,r,n,o){var l,u=this;n===void 0&&(n=null),this.fragCurrent=e;var f=r==null?void 0:r.details;if(!this.levels||!f)throw new Error("frag load aborted, missing level"+(f?"":" detail")+"s");var d=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log("Loading key for "+e.sn+" of ["+f.startSN+"-"+f.endSN+"], "+this.playlistLabel()+" "+e.level),this.state=M.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(function(T){if(!u.fragContextChanged(T.frag))return u.hls.trigger(E.KEY_LOADED,T),u.state===M.KEY_LOADING&&(u.state=M.IDLE),T}),this.hls.trigger(E.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&f.encryptedFragments.length&&this.keyLoader.loadClear(e,f.encryptedFragments);var h=this.fragPrevious;if(we(e)&&(!h||e.sn!==h.sn)){var v=this.shouldLoadParts(r.details,e.end);v!==this.loadingParts&&(this.log("LL-Part loading "+(v?"ON":"OFF")+" loading sn "+(h==null?void 0:h.sn)+"->"+e.sn),this.loadingParts=v)}if(n=Math.max(e.start,n||0),this.loadingParts&&we(e)){var c=f.partList;if(c&&o){n>e.end&&f.fragmentHint&&(e=f.fragmentHint);var g=this.getNextPart(c,e,n);if(g>-1){var m=c[g];e=this.fragCurrent=m.fragment,this.log("Loading "+e.type+" sn: "+e.sn+" part: "+m.index+" ("+g+"/"+(c.length-1)+") of "+this.fragInfo(e,!1,m)+") cc: "+e.cc+" ["+f.startSN+"-"+f.endSN+"], target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=M.FRAG_LOADING;var p;return d?p=d.then(function(T){return!T||u.fragContextChanged(T.frag)?null:u.doFragPartsLoad(e,m,r,o)}).catch(function(T){return u.handleFragLoadError(T)}):p=this.doFragPartsLoad(e,m,r,o).catch(function(T){return u.handleFragLoadError(T)}),this.hls.trigger(E.FRAG_LOADING,{frag:e,part:m,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(c,n))return Promise.resolve(null)}}if(we(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+n.toFixed(2)),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading "+e.type+" sn: "+e.sn+" of "+this.fragInfo(e,!1)+") cc: "+e.cc+" "+(f?"["+f.startSN+"-"+f.endSN+"]":"")+", target: "+parseFloat(n.toFixed(3))),U(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=M.FRAG_LOADING;var y=this.config.progressive,S;return y&&d?S=d.then(function(T){return!T||u.fragContextChanged(T==null?void 0:T.frag)?null:u.fragmentLoader.load(e,o)}).catch(function(T){return u.handleFragLoadError(T)}):S=Promise.all([this.fragmentLoader.load(e,y?o:void 0),d]).then(function(T){var x=T[0];return!y&&x&&o&&o(x),x}).catch(function(T){return u.handleFragLoadError(T)}),this.hls.trigger(E.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):S},i.doFragPartsLoad=function(e,r,n,o){var l=this;return new Promise(function(u,f){var d,h=[],v=(d=n.details)==null?void 0:d.partList,c=function(m){l.fragmentLoader.loadPart(e,m,o).then(function(p){h[m.index]=p;var y=p.part;l.hls.trigger(E.FRAG_LOADED,p);var S=Gi(n.details,e.sn,m.index+1)||Hi(v,e.sn,m.index+1);if(S)c(S);else return u({frag:e,part:y,partsLoaded:h})}).catch(f)};c(r)})},i.handleFragLoadError=function(e){if("data"in e){var r=e.data;e.data&&r.details===C.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(E.ERROR,r)}else this.hls.trigger(E.ERROR,{type:Y.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},i._handleTransmuxerFlush=function(e){var r=this.getCurrentContext(e);if(!r||this.state!==M.PARSING){!this.fragCurrent&&this.state!==M.STOPPED&&this.state!==M.ERROR&&(this.state=M.IDLE);return}var n=r.frag,o=r.part,l=r.level,u=self.performance.now();n.stats.parsing.end=u,o&&(o.stats.parsing.end=u);var f=this.getLevelDetails(),d=f&&n.sn>f.endSN,h=d||this.shouldLoadParts(f,n.end);h!==this.loadingParts&&(this.log("LL-Part loading "+(h?"ON":"OFF")+" after parsing segment ending @"+n.end.toFixed(2)),this.loadingParts=h),this.updateLevelTiming(n,o,l,e.partial)},i.shouldLoadParts=function(e,r){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var n,o=e.partList[0],l=o.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(r>=l){var u,f=this.hls.hasEnoughToStart?((u=this.media)==null?void 0:u.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(f>o.start-o.fragment.duration)return!0}}}return!1},i.getCurrentContext=function(e){var r=this.levels,n=this.fragCurrent,o=e.level,l=e.sn,u=e.part;if(!(r!=null&&r[o]))return this.warn("Levels object was unset while buffering fragment "+l+" of "+this.playlistLabel()+" "+o+". The current chunk will not be buffered."),null;var f=r[o],d=f.details,h=u>-1?Gi(d,l,u):null,v=h?h.fragment:Ui(d,l,n);return v?(n&&n!==v&&(v.stats=n.stats),{frag:v,part:h,level:f}):null},i.bufferFragmentData=function(e,r,n,o,l){var u;if(!(!e||this.state!==M.PARSING)){var f=e.data1,d=e.data2,h=f;if(f&&d&&(h=Fe(f,d)),!!((u=h)!=null&&u.length)){var v={type:e.type,frag:r,part:n,chunkMeta:o,parent:r.type,data:h};if(this.hls.trigger(E.BUFFER_APPENDING,v),e.dropped&&e.independent&&!n){if(l)return;this.flushBufferGap(r)}}}},i.flushBufferGap=function(e){var r=this.media;if(r){if(!ae.isBuffered(r,r.currentTime)){this.flushMainBuffer(0,e.start);return}var n=r.currentTime,o=ae.bufferInfo(r,n,0),l=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),f=Math.max(Math.min(e.start-u,o.end-u),n+u);e.start-f>u&&this.flushMainBuffer(f,e.start)}},i.getFwdBufferInfo=function(e,r){var n,o=this.getLoadPosition();if(!U(o))return null;var l=this.lastCurrentTime>o,u=l||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,o,r,u)},i.getFwdBufferInfoAtPos=function(e,r,n,o){var l=ae.bufferInfo(e,r,o);if(l.len===0&&l.nextStart!==void 0){var u=this.fragmentTracker.getBufferedFrag(r,n);if(u&&(l.nextStart<=u.end||u.gap)){var f=Math.max(Math.min(l.nextStart,u.end)-r,o);return ae.bufferInfo(e,r,f)}}return l},i.getMaxBufferLength=function(e){var r=this.config,n;return e?n=Math.max(8*r.maxBufferSize/e,r.maxBufferLength):n=r.maxBufferLength,Math.min(n,r.maxMaxBufferLength)},i.reduceMaxBufferLength=function(e,r){var n=this.config,o=Math.max(Math.min(e-r,n.maxBufferLength),r),l=Math.max(e-r*3,n.maxMaxBufferLength/2,o);return l>=o?(n.maxMaxBufferLength=l,this.warn("Reduce max buffer length to "+l+"s"),!0):!1},i.getAppendedFrag=function(e,r){var n;r===void 0&&(r=q.MAIN);var o=(n=this.fragmentTracker)==null?void 0:n.getAppendedFrag(e,r);return o&&"fragment"in o?o.fragment:o},i.getNextFragment=function(e,r){var n=r.fragments,o=n.length;if(!o)return null;var l=this.config,u=n[0].start,f=l.lowLatencyMode&&!!r.partList,d=null;if(r.live){var h=l.initialLiveManifestSize;if(o<h)return this.warn("Not enough fragments to start playback (have: "+o+", need: "+h+")"),null;if(!r.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var v;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(r,n);var c=this.hls.startPosition,g=this.hls.liveSyncPosition,m=d?(c!==-1&&c>=u?c:g)||d.start:e;this.log("Setting startPosition to "+m+" to match start frag at live edge. mainStart: "+c+" liveSyncPosition: "+g+" frag.start: "+((v=d)==null?void 0:v.start)),this.startPosition=this.nextLoadPosition=m}}else e<=u&&(d=n[0]);if(!d){var p=this.loadingParts?r.partEnd:r.fragmentEnd;d=this.getFragmentAtPosition(e,p,r)}var y=this.filterReplacedPrimary(d,r);if(!y&&d){var S=d.sn-r.startSN;y=this.filterReplacedPrimary(n[S+1]||null,r)}return this.mapToInitFragWhenRequired(y)},i.isLoopLoading=function(e,r){var n=this.fragmentTracker.getState(e);return(n===_e.OK||n===_e.PARTIAL&&!!e.gap)&&this.nextLoadPosition>r},i.getNextFragmentLoopLoading=function(e,r,n,o,l){var u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,r),u&&!u.gap&&n.nextStart)){var f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,o,0);if(f!==null&&n.len+f.len>=l){var d=u.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+o+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,u},i.filterReplacedPrimary=function(e,r){return e&&(An(this.hls.config),e)},i.mapToInitFragWhenRequired=function(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e},i.getNextPart=function(e,r,n){for(var o=-1,l=!1,u=!0,f=0,d=e.length;f<d;f++){var h=e[f];if(u=u&&!h.independent,o>-1&&n<h.start)break;var v=h.loaded;v?o=-1:(l||h.independent||u)&&h.fragment===r&&(o=f),l=v}return o},i.loadedEndOfParts=function(e,r){var n=e[e.length-1];return n&&r>n.start&&n.loaded},i.getInitialLiveFragment=function(e,r){var n=this.fragPrevious,o=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),o=Fa(r,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!o){var l=n.sn+1;if(l>=e.startSN&&l<=e.endSN){var u=r[l-e.startSN];n.cc===u.cc&&(o=u,this.log("Live playlist, switching playlist, load frag with next SN: "+o.sn))}o||(o=Ua(r,n.cc),o&&this.log("Live playlist, switching playlist, load frag with same CC: "+o.sn))}}else{var f=this.hls.liveSyncPosition;f!==null&&(o=this.getFragmentAtPosition(f,this.bitrateTest?e.fragmentEnd:e.edge,e))}return o},i.getFragmentAtPosition=function(e,r,n){var o=this.config,l=this.fragPrevious,u=n.fragments,f=n.endSN,d=n.fragmentHint,h=o.maxFragLookUpTolerance,v=n.partList,c=!!(this.loadingParts&&v!=null&&v.length&&d);c&&d&&!this.bitrateTest&&v[v.length-1].fragment.sn===d.sn&&(u=u.concat(d),f=d.sn);var g;if(e<r){var m,p=e<this.lastCurrentTime,y=p||e>r-h||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:h;g=ar(l,u,e,y)}else g=u[u.length-1];if(g){var S=g.sn-n.startSN,T=this.fragmentTracker.getState(g);if((T===_e.OK||T===_e.PARTIAL&&g.gap)&&(l=g),l&&g.sn===l.sn&&(!c||v[0].fragment.sn>g.sn||!n.live&&!c)){var x=l&&g.level===l.level;if(x){var A=u[S+1];g.sn<f&&this.fragmentTracker.getState(A)!==_e.OK?g=A:g=null}}}return g},i.alignPlaylists=function(e,r,n){var o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=e.fragmentStart,u=!r,f=e.alignedSliding&&U(l);if(u||!f&&!l){Co(n,e);var d=e.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+e.startSN+" fragments: "+o),d}return l},i.waitForCdnTuneIn=function(e){var r=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*r)},i.setStartPosition=function(e,r){var n=this.startPosition;n<r&&(n=-1);var o=this.timelineOffset;if(n===-1){var l=this.startTimeOffset!==null,u=l?this.startTimeOffset:e.startTimeOffset;u!==null&&U(u)?(n=r+u,u<0&&(n+=e.edge),n=Math.min(Math.max(r,n),r+e.totalduration),this.log("Setting startPosition to "+n+" for start time offset "+u+" found in "+(l?"multivariant":"media")+" playlist"),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||r,this.log("Setting startPosition to -1 to start at live edge "+n),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+o}this.nextLoadPosition=n+o},i.getLoadPosition=function(){var e,r=this.media,n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&r?n=r.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n},i.handleFragLoadAborted=function(e,r){this.transmuxer&&e.type===this.playlistType&&we(e)&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(r?" part "+r.index:"")+" of "+this.playlistLabel()+" "+e.level+" was aborted"),this.resetFragmentLoading(e))},i.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==M.FRAG_LOADING_WAITING_RETRY)&&(this.state=M.IDLE)},i.onFragmentOrKeyLoadError=function(e,r){if(r.chunkMeta&&!r.frag){var n=this.getCurrentContext(r.chunkMeta);n&&(r.frag=n.frag)}var o=r.frag;if(!(!o||o.type!==e||!this.levels)){if(this.fragContextChanged(o)){var l;this.warn("Frag load error must match current frag to retry "+o.url+" > "+((l=this.fragCurrent)==null?void 0:l.url));return}var u=r.details===C.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(o,!0);var f=r.errorAction,d=f||{},h=d.action,v=d.flags,c=d.retryCount,g=c===void 0?0:c,m=d.retryConfig,p=!!f&&!!m,y=p&&h===xe.RetryRequest,S=p&&!f.resolved&&v===Ne.MoveAllAlternatesMatchingHost;if(!y&&S&&we(o)&&!o.endList)this.resetFragmentErrors(e),this.treatAsGap(o),f.resolved=!0;else if((y||S)&&g<m.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var T=sr(m,g);this.warn("Fragment "+o.sn+" of "+e+" "+o.level+" errored with "+r.details+", retrying loading "+(g+1)+"/"+m.maxNumRetry+" in "+T+"ms"),f.resolved=!0,this.retryDate=self.performance.now()+T,this.state=M.FRAG_LOADING_WAITING_RETRY}else if(m&&f)if(this.resetFragmentErrors(e),g<m.maxNumRetry)!u&&h!==xe.RemoveAlternatePermanently&&(f.resolved=!0);else{this.warn(r.details+" reached or exceeded max retry ("+g+")");return}else h===xe.SendAlternateToPenaltyBox?this.state=M.WAITING_LEVEL:this.state=M.ERROR;this.tickImmediate()}},i.reduceLengthAndFlushBuffer=function(e){if(this.state===M.PARSING||this.state===M.PARSED){var r=e.frag,n=e.parent,o=this.getFwdBufferInfo(this.mediaBuffer,n),l=o&&o.len>.5;l&&this.reduceMaxBufferLength(o.len,(r==null?void 0:r.duration)||10);var u=!l;return u&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+n+" buffer"),r&&(this.fragmentTracker.removeFragment(r),this.nextLoadPosition=r.start),this.resetLoadingState(),u}return!1},i.resetFragmentErrors=function(e){e===q.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==M.STOPPED&&(this.state=M.IDLE)},i.afterBufferFlushed=function(e,r,n){if(e){var o=ae.getBuffered(e);this.fragmentTracker.detectEvictedFragments(r,o,n),this.state===M.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==M.STOPPED&&(this.state=M.IDLE)},i.resetStartWhenNotLoaded=function(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var r=e?e.details:null;r!=null&&r.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(r,r.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},i.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},i.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},i.updateLevelTiming=function(e,r,n,o){var l=this,u=n.details;if(!u){this.warn("level.details undefined");return}var f=Object.keys(e.elementaryStreams).reduce(function(v,c){var g=e.elementaryStreams[c];if(g){var m=g.endPTS-g.startPTS;if(m<=0)return l.warn("Could not parse fragment "+e.sn+" "+c+" duration reliably ("+m+")"),v||!1;var p=o?0:wi(u,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return l.hls.trigger(E.LEVEL_PTS_UPDATED,{details:u,level:n,drift:p,type:c,frag:e,start:g.startPTS,end:g.endPTS}),!0}return v},!1);if(!f){var d;if(n.fragmentError===0&&this.treatAsGap(e,n),((d=this.transmuxer)==null?void 0:d.error)===null){var h=new Error("Found no media in fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(h.message),this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:"Found no media in msn "+e.sn+" of "+this.playlistLabel()+' "'+n.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=M.PARSED,this.log("Parsed "+e.type+" sn: "+e.sn+(r?" part: "+r.index:"")+" of "+this.fragInfo(e,!1,r)+")"),this.hls.trigger(E.FRAG_PARSED,{frag:e,part:r})},i.playlistLabel=function(){return this.playlistType===q.MAIN?"level":"track"},i.fragInfo=function(e,r,n){var o,l;return r===void 0&&(r=!0),this.playlistLabel()+" "+e.level+" ("+(n?"part":"frag")+":["+((o=r&&!n?e.startPTS:(n||e).start)!=null?o:NaN).toFixed(3)+"-"+((l=r&&!n?e.endPTS:(n||e).end)!=null?l:NaN).toFixed(3)+"]"+(n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):"")},i.treatAsGap=function(e,r){r&&r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)},i.resetTransmuxer=function(){var e;(e=this.transmuxer)==null||e.reset()},i.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},Z(s,[{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,r=this.startPosition;return r===-1&&e?e:r}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var e=this.config.timelineOffset;if(e){var r;return((r=this.getLevelDetails())==null?void 0:r.appliedTimelineOffset)||e}return 0}},{key:"primaryPrefetch",get:function(){return An(this.hls.config),!1}},{key:"state",get:function(){return this._state},set:function(e){var r=this._state;r!==e&&(this._state=e,this.log(r+"->"+e))}}])}(Tn);function An(a){return!1}function mt(a,s,i){st(a,s,i),a.addEventListener(s,i)}function st(a,s,i){a.removeEventListener(s,i)}var Bt=2,wo=.1,Fo=.05,No=100,Bo=function(a){function s(t,e){var r;return r=a.call(this,"gap-controller",t.logger)||this,r.hls=null,r.fragmentTracker=null,r.media=null,r.mediaSource=void 0,r.nudgeRetry=0,r.stallReported=!1,r.stalled=null,r.moved=!1,r.seeking=!1,r.buffered={},r.lastCurrentTime=0,r.ended=0,r.waiting=0,r.onMediaPlaying=function(){r.ended=0,r.waiting=0},r.onMediaWaiting=function(){var n;(n=r.media)!=null&&n.seeking||(r.waiting=self.performance.now(),r.tick())},r.onMediaEnded=function(){if(r.hls){var n;r.ended=((n=r.media)==null?void 0:n.currentTime)||1,r.hls.trigger(E.MEDIA_ENDED,{stalled:!1})}},r.hls=t,r.fragmentTracker=e,r.registerListeners(),r}he(s,a);var i=s.prototype;return i.registerListeners=function(){var e=this.hls;e&&(e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.BUFFER_APPENDED,this.onBufferAppended,this))},i.unregisterListeners=function(){var e=this.hls;e&&(e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.BUFFER_APPENDED,this.onBufferAppended,this))},i.destroy=function(){a.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},i.onMediaAttached=function(e,r){this.setInterval(No),this.mediaSource=r.mediaSource;var n=this.media=r.media;mt(n,"playing",this.onMediaPlaying),mt(n,"waiting",this.onMediaWaiting),mt(n,"ended",this.onMediaEnded)},i.onMediaDetaching=function(e,r){this.clearInterval();var n=this.media;n&&(st(n,"playing",this.onMediaPlaying),st(n,"waiting",this.onMediaWaiting),st(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},i.onBufferAppended=function(e,r){this.buffered=r.timeRanges},i.tick=function(){var e;if(!(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)){var r=this.media.currentTime;this.poll(r,this.lastCurrentTime),this.lastCurrentTime=r}},i.poll=function(e,r){var n,o,l=(n=this.hls)==null?void 0:n.config;if(l){var u=this.media,f=this.stalled;if(u){var d=u.seeking,h=this.seeking&&!d,v=!this.seeking&&d,c=u.paused&&!d||u.ended||u.playbackRate===0;if(this.seeking=d,e!==r){r&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!c&&e>r&&this.nudgeOnVideoHole(e,r)),this.waiting===0&&this.stallResolved(e);return}if(v||h){h&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(E.MEDIA_ENDED,{stalled:!1}));return}if(!ae.getBuffered(u).length){this.nudgeRetry=0;return}var g=ae.bufferInfo(u,e,0),m=g.nextStart||0,p=this.fragmentTracker;if(d&&p&&this.hls){var y=Rn(this.hls.inFlightFragments,e),S=g.len>Bt,T=!m||y||m-e>Bt&&!p.getPartialFragment(e);if(S||T)return;this.moved=!1}var x=(o=this.hls)==null?void 0:o.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){var A=g.len>0;if(!A&&!m)return;var L=Math.max(m,g.start||0)-e,R=!!(x!=null&&x.live),D=R?x.targetduration*2:Bt,_=p.getPartialFragment(e);if(L>0&&(L<=D||_)){u.paused||this._trySkipBufferHole(_);return}}var b=l.detectStallWithCurrentTimeMs,I=self.performance.now(),k=this.waiting;if(f===null){k>0&&I-k<b?this.stalled=k:this.stalled=I;return}var w=I-f;if(!d&&(w>=b||k)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(x!=null&&x.live)&&Math.abs(e-((x==null?void 0:x.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(E.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}var P=ae.bufferInfo(u,e,l.maxBufferHole);this._tryFixBufferStall(P,w)}}},i.stallResolved=function(e){var r=this.stalled;if(r&&this.hls&&(this.stalled=null,this.stallReported)){var n=self.performance.now()-r;this.log("playback not stuck anymore @"+e+", after "+Math.round(n)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(E.STALL_RESOLVED,{})}},i.nudgeOnVideoHole=function(e,r){var n,o=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&o&&o.length>1&&e>o.end(0)){var l=ae.bufferedInfo(ae.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&r>=l.start){var u=ae.timeRangesToArray(o),f=ae.bufferedInfo(u,r,0).bufferedIndex;if(f>-1&&f<u.length-1){var d=ae.bufferedInfo(u,e,0).bufferedIndex,h=u[f].end,v=u[f+1].start;if((d===-1||d>f)&&v-h<1&&e-h<2){var c=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+e+" hole: "+h+" -> "+v+" buffered index: "+d);this.warn(c.message),this.media.currentTime+=1e-6;var g=this.fragmentTracker.getPartialFragment(e)||void 0,m=ae.bufferInfo(this.media,e,0);this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:c,reason:c.message,frag:g,buffer:m.len,bufferInfo:m})}}}}},i._tryFixBufferStall=function(e,r){var n,o,l=this.fragmentTracker,u=this.media,f=(n=this.hls)==null?void 0:n.config;if(!(!u||!l||!f)){var d=u.currentTime,h=(o=this.hls)==null?void 0:o.latestLevelDetails,v=l.getPartialFragment(d);if(v||h!=null&&h.live&&d<h.fragmentStart){var c=this._trySkipBufferHole(v);if(c||!this.media)return}var g=e.buffered;(g&&g.length>1&&e.len>f.maxBufferHole||e.nextStart&&e.nextStart-d<f.maxBufferHole)&&(r>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}},i._reportStall=function(e){var r=this.hls,n=this.media,o=this.stallReported,l=this.stalled;if(!o&&l!==null&&n&&r){this.stallReported=!0;var u=new Error("Playback stalling at @"+n.currentTime+" due to low buffer ("+Ae(e)+")");this.warn(u.message),r.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:l}})}},i._trySkipBufferHole=function(e){var r,n=this.fragmentTracker,o=this.media,l=(r=this.hls)==null?void 0:r.config;if(!o||!n||!l)return 0;var u=o.currentTime,f=ae.bufferInfo(o,u,0),d=u<f.start?f.start:f.nextStart;if(d&&this.hls){var h=f.len<=l.maxBufferHole,v=f.len>0&&f.len<1&&o.readyState<3,c=d-u;if(c>0&&(h||v)){if(c>l.maxBufferHole){var g=!1;if(u===0){var m=n.getAppendedFrag(0,q.MAIN);m&&d<m.end&&(g=!0)}if(!g){var p=e||n.getAppendedFrag(u,q.MAIN);if(p){var y;if(!((y=this.hls.loadLevelObj)!=null&&y.details))return 0;var S=Rn(this.hls.inFlightFragments,d);if(S)return 0;for(var T=!1,x=p.end;x<d;){var A=n.getPartialFragment(x);if(A)x+=A.duration;else{T=!0;break}}if(T)return 0}}}var L=Math.max(d+Fo,u+wo);if(this.warn("skipping hole, adjusting currentTime from "+u+" to "+L),this.moved=!0,o.currentTime=L,!(e!=null&&e.gap)){var R=new Error("fragment loaded with buffer holes, seeking from "+u+" to "+L);this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:R,reason:R.message,frag:e||void 0,buffer:f.len,bufferInfo:f})}return L}}return 0},i._tryNudgeBuffer=function(e){var r=this.hls,n=this.media,o=this.nudgeRetry,l=r==null?void 0:r.config;if(!n||!l)return 0;var u=n.currentTime;if(this.nudgeRetry++,o<l.nudgeMaxRetry){var f=u+(o+1)*l.nudgeOffset,d=new Error("Nudging 'currentTime' from "+u+" to "+f);this.warn(d.message),n.currentTime=f,r.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{var h=new Error("Playhead still not moving while enough data buffered @"+u+" after "+l.nudgeMaxRetry+" nudges");this.error(h.message),r.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:e.len,bufferInfo:e})}},Z(s,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(Tn);function Rn(a,s){var i=bn(a.main);if(i&&i.start<=s)return i;var t=bn(a.audio);return t&&t.start<=s?t:null}function bn(a){if(!a)return null;switch(a.state){case M.IDLE:case M.STOPPED:case M.ENDED:case M.ERROR:return null}return a.frag}function Uo(a,s){var i;try{i=new Event("addtrack")}catch{i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=a,s.dispatchEvent(i)}function Go(a,s){var i=a.mode;if(i==="disabled"&&(a.mode="hidden"),a.cues)for(var t=a.cues.length;t--;)s&&a.cues[t].removeEventListener("enter",s),a.removeCue(a.cues[t]);i==="disabled"&&(a.mode=i)}function Ho(a,s,i,t){var e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var r=Ko(a.cues,s,i),n=0;n<r.length;n++)(!t||t(r[n]))&&a.removeCue(r[n]);e==="disabled"&&(a.mode=e)}function Vo(a,s){if(s<=a[0].startTime)return 0;var i=a.length-1;if(s>a[i].endTime)return-1;for(var t=0,e=i,r;t<=e;)if(r=Math.floor((e+t)/2),s<a[r].startTime)e=r-1;else if(s>a[r].startTime&&t<i)t=r+1;else return r;return a[t].startTime-s<s-a[e].startTime?t:e}function Ko(a,s,i){var t=[],e=Vo(a,s);if(e>-1)for(var r=e,n=a.length;r<n;r++){var o=a[r];if(o.startTime>=s&&o.endTime<=i)t.push(o);else if(o.startTime>i)return t}return t}var Wo=.25;function Ar(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function _n(a,s,i,t,e){var r=new a(s,i,"");try{r.value=t,e&&(r.type=e)}catch{r=new a(s,i,Ae(e?be({type:e},t):t))}return r}var Ut=function(){var a=Ar();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Yo(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var qo=function(){function a(i){var t=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=function(){t.hls&&t.hls.trigger(E.EVENT_CUE_ENTER,{})},this.hls=i,this._registerListeners()}var s=a.prototype;return s.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},s._registerListeners=function(){var t=this.hls;t.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(E.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},s._unregisterListeners=function(){var t=this.hls;t.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(E.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},s.onMediaAttaching=function(t,e){var r;this.media=e.media,((r=e.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)},s.onMediaAttached=function(){var t=this.hls.latestLevelDetails;t&&this.updateDateRangeCues(t)},s.onMediaDetaching=function(t,e){this.media=null;var r=!!e.transferMedia;r||(this.id3Track&&(this.removeCues&&Go(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},s.onManifestLoading=function(){this.dateRangeCuesAppended={}},s.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},s.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if(r.kind==="metadata"&&r.label==="id3")return Uo(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},s.onFragParsingMetadata=function(t,e){if(this.media){var r=this.hls.config,n=r.enableEmsgMetadataCues,o=r.enableID3MetadataCues;if(!(!n&&!o)){var l=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var u=Ar();if(u)for(var f=0;f<l.length;f++){var d=l[f].type;if(!(d===ke.emsg&&!n||!o)){var h=Qi(l[f].data);if(h){var v=l[f].pts,c=v+l[f].duration;c>Ut&&(c=Ut);var g=c-v;g<=0&&(c=v+Wo);for(var m=0;m<h.length;m++){var p=h[m];if(!Zi(p)){this.updateId3CueEnds(v,d);var y=_n(u,v,c,p,d);y&&this.id3Track.addCue(y)}}}}}}}},s.updateId3CueEnds=function(t,e){var r,n=(r=this.id3Track)==null?void 0:r.cues;if(n)for(var o=n.length;o--;){var l=n[o];l.type===e&&l.startTime<t&&l.endTime===Ut&&(l.endTime=t)}},s.onBufferFlushing=function(t,e){var r=e.startOffset,n=e.endOffset,o=e.type,l=this.id3Track,u=this.hls;if(u){var f=u.config,d=f.enableEmsgMetadataCues,h=f.enableID3MetadataCues;if(l&&(d||h)){var v;o==="audio"?v=function(g){return g.type===ke.audioId3&&h}:o==="video"?v=function(g){return g.type===ke.emsg&&d}:v=function(g){return g.type===ke.audioId3&&h||g.type===ke.emsg&&d},Ho(l,r,n,v)}}},s.onLevelUpdated=function(t,e){var r=e.details;this.updateDateRangeCues(r,!0)},s.onLevelPtsUpdated=function(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)},s.updateDateRangeCues=function(t,e){var r=this;if(!(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var n=this.id3Track,o=t.dateRanges,l=Object.keys(o),u=this.dateRangeCuesAppended;if(n&&e){var f;if((f=n.cues)!=null&&f.length)for(var d=Object.keys(u).filter(function(y){return!l.includes(y)}),h=function(){var S=d[v],T=u[S].cues;delete u[S],Object.keys(T).forEach(function(x){try{var A=T[x];A.removeEventListener("enter",r.onEventCueEnter),n.removeCue(A)}catch{}})},v=d.length;v--;)h();else u=this.dateRangeCuesAppended={}}var c=t.fragments[t.fragments.length-1];if(!(l.length===0||!U(c==null?void 0:c.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=Ar(),m=function(){var S=l[p],T=o[S],x=T.startTime,A=u[S],L=(A==null?void 0:A.cues)||{},R=(A==null?void 0:A.durationKnown)||!1,D=Ut,_=T.duration,b=T.endDate;if(b&&_!==null)D=x+_,R=!0;else if(T.endOnNext&&!R){var I=l.reduce(function(V,ie){if(ie!==T.id){var j=o[ie];if(j.class===T.class&&j.startDate>T.startDate&&(!V||T.startDate<V.startDate))return j}return V},null);I&&(D=I.startTime,R=!0)}for(var k=Object.keys(T.attr),w=0;w<k.length;w++){var O=k[w];if(Xa(O)){var P=L[O];if(P)R&&!A.durationKnown?P.endTime=D:Math.abs(P.startTime-x)>.01&&(P.startTime=x,P.endTime=D);else if(g){var N=T.attr[O];$a(O)&&(N=Yo(N));var G={key:O,data:N},F=_n(g,x,D,G,ke.dateRange);F&&(F.id=S,r.id3Track.addCue(F),L[O]=F)}}}u[S]={cues:L,dateRange:T,durationKnown:R}},p=0;p<l.length;p++)m()}}},a}(),jo=function(){function a(i){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=t.media,r=t.levelDetails;if(!(!e||!r)){t.currentTime=e.currentTime;var n=t.computeLatency();if(n!==null){t._latency=n;var o=t.config,l=o.lowLatencyMode,u=o.maxLiveSyncPlaybackRate;if(!(!l||u===1||!r.live)){var f=t.targetLatency;if(f!==null){var d=n-f,h=Math.min(t.maxLatency,f+r.targetduration),v=d<h;if(v&&d>.05&&t.forwardBufferLength>1){var c=Math.min(2,Math.max(1,u)),g=Math.round(2/(1+Math.exp(-.75*d-t.edgeStalled))*20)/20,m=Math.min(c,Math.max(1,g));t.changeMediaPlaybackRate(e,m)}else e.playbackRate!==1&&e.playbackRate!==0&&t.changeMediaPlaybackRate(e,1)}}}}},this.hls=i,this.config=i.config,this.registerListeners()}var s=a.prototype;return s.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},s.registerListeners=function(){var t=this.hls;t&&(t.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(E.ERROR,this.onError,this))},s.unregisterListeners=function(){var t=this.hls;t&&(t.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(E.ERROR,this.onError,this))},s.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},s.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},s.onManifestLoading=function(){this._latency=null,this.stallCount=0},s.onLevelUpdated=function(t,e){var r=e.details;r.advanced&&this.onTimeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},s.onError=function(t,e){var r;e.details===C.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},s.changeMediaPlaybackRate=function(t,e){var r,n;t.playbackRate!==e&&((r=this.hls)==null||r.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((n=this.targetLatency)==null?void 0:n.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+t.playbackRate+" to "+e),t.playbackRate=e)},s.estimateLiveEdge=function(){var t=this.levelDetails;return t===null?null:t.edge+t.age},s.computeLatency=function(){var t=this.estimateLiveEdge();return t===null?null:t-this.currentTime},Z(a,[{key:"levelDetails",get:function(){var t;return((t=this.hls)==null?void 0:t.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config;if(t.liveMaxLatencyDuration!==void 0)return t.liveMaxLatencyDuration;var e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(t===null||this.hls===null)return null;var e=t.holdBack,r=t.partHoldBack,n=t.targetduration,o=this.config,l=o.liveSyncDuration,u=o.liveSyncDurationCount,f=o.lowLatencyMode,d=this.hls.userConfig,h=f&&r||e;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=l!==void 0?l:u*n);var v=n;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,v)},set:function(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency;if(t===null||e===null)return null;var r=this.levelDetails;if(r===null)return null;var n=r.edge,o=t-e-this.edgeStalled,l=n-r.totalduration,u=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(l,o),u)}},{key:"drift",get:function(){var t=this.levelDetails;return t===null?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(t===null)return 0;var e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return(r?t.buffered.end(r-1):e.edge)-this.currentTime}}])}(),Xo=function(a){function s(t,e){var r;return r=a.call(this,e,t.logger)||this,r.hls=void 0,r.canLoad=!1,r.timer=-1,r.hls=t,r}he(s,a);var i=s.prototype;return i.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},i.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},i.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},i.stopLoad=function(){this.canLoad=!1,this.clearTimer()},i.switchParams=function(e,r,n){var o=r==null?void 0:r.renditionReports;if(o){for(var l=-1,u=0;u<o.length;u++){var f=o[u],d=void 0;try{d=new self.URL(f.URI,r.url).href}catch(p){this.warn("Could not construct new URL for Rendition Report: "+p),d=f.URI||""}if(d===e){l=u;break}else d===e.substring(0,d.length)&&(l=u)}if(l!==-1){var h=o[l],v=parseInt(h["LAST-MSN"])||(r==null?void 0:r.lastPartSn),c=parseInt(h["LAST-PART"])||(r==null?void 0:r.lastPartIndex);if(this.hls.config.lowLatencyMode){var g=Math.min(r.age-r.partTarget,r.targetduration);c>=0&&g>r.partTarget&&(c+=1)}var m=n&&li(n);return new ui(v,c>=0?c:void 0,m)}}},i.loadPlaylist=function(e){this.clearTimer()},i.loadingPlaylist=function(e,r){this.clearTimer()},i.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},i.getUrlWithDirectives=function(e,r){if(r)try{return r.addDirectives(e)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}return e},i.playlistLoaded=function(e,r,n){var o=r.details,l=r.stats,u=self.performance.now(),f=l.loading.first?Math.max(0,u-l.loading.first):0;o.advancedDateTime=Date.now()-f;var d=this.hls.config.timelineOffset;if(d!==o.appliedTimelineOffset){var h=Math.max(d||0,0);o.appliedTimelineOffset=h,o.fragments.forEach(function(V){V.start=V.playlistOffset+h})}if(o.live||n!=null&&n.live){var v="levelInfo"in r?r.levelInfo:r.track;if(o.reloaded(n),n&&o.fragments.length>0){ns(n,o);var c=o.playlistParsingError;if(c){this.warn(c);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var m,p=r.networkDetails;g.trigger(E.ERROR,{type:Y.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:o.url,error:c,reason:c.message,level:r.level||void 0,parent:(m=o.fragments[0])==null?void 0:m.type,networkDetails:p,stats:l});return}o.playlistParsingError=null}}o.requestScheduled===-1&&(o.requestScheduled=l.loading.start);var y=this.hls.mainForwardBufferInfo,S=y?y.end-y.len:0,T=(o.edge-S)*1e3,x=Bi(o,T);if(o.requestScheduled+x<u?o.requestScheduled=u:o.requestScheduled+=x,this.log("live playlist "+e+" "+(o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:o.updated?"UPDATED":"MISSED")),!this.canLoad||!o.live)return;var A,L=void 0,R=void 0;if(o.canBlockReload&&o.endSN&&o.advanced){var D=this.hls.config.lowLatencyMode,_=o.lastPartSn,b=o.endSN,I=o.lastPartIndex,k=I!==-1,w=_===b;k?w?(L=b+1,R=D?0:I):(L=_,R=D?I+1:o.maxPartIndex):L=b+1;var O=o.age,P=O+o.ageHeader,N=Math.min(P-o.partTarget,o.targetduration*1.5);if(N>0){if(P>o.targetduration*3)this.log("Playlist last advanced "+O.toFixed(2)+"s ago. Omitting segment and part directives."),L=void 0,R=void 0;else if(n!=null&&n.tuneInGoal&&P-o.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+N+" with playlist age: "+o.age),N=0;else{var G=Math.floor(N/o.targetduration);if(L+=G,R!==void 0){var F=Math.round(N%o.targetduration/o.partTarget);R+=F}this.log("CDN Tune-in age: "+o.ageHeader+"s last advanced "+O.toFixed(2)+"s goal: "+N+" skip sn "+G+" to part "+R)}o.tuneInGoal=N}if(A=this.getDeliveryDirectives(o,r.deliveryDirectives,L,R),D||!w){o.requestScheduled=u,this.loadingPlaylist(v,A);return}}else(o.canBlockReload||o.canSkipUntil)&&(A=this.getDeliveryDirectives(o,r.deliveryDirectives,L,R));A&&L!==void 0&&o.canBlockReload&&(o.requestScheduled=l.loading.first+Math.max(x-f*2,x/2)),this.scheduleLoading(v,A,o)}else this.clearTimer()},i.scheduleLoading=function(e,r,n){var o=this,l=n||e.details;if(!l){this.loadingPlaylist(e,r);return}var u=self.performance.now(),f=l.requestScheduled;if(u>=f){this.loadingPlaylist(e,r);return}var d=f-u;this.log("reload live playlist "+(e.name||e.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return o.loadingPlaylist(e,r)},d)},i.getDeliveryDirectives=function(e,r,n,o){var l=li(e);return r!=null&&r.skip&&e.deltaUpdateFailed&&(n=r.msn,o=r.part,l=bt.No),new ui(n,o,l)},i.checkRetry=function(e){var r=this,n=e.details,o=_t(e),l=e.errorAction,u=l||{},f=u.action,d=u.retryCount,h=d===void 0?0:d,v=u.retryConfig,c=!!l&&!!v&&(f===xe.RetryRequest||!l.resolved&&f===xe.SendAlternateToPenaltyBox);if(c){var g;if(h>=v.maxNumRetry)return!1;if(o&&(g=e.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+v.maxNumRetry+' after "'+n+'" without delivery-directives'),this.loadPlaylist();else{var m=sr(v,h);this.clearTimer(),this.timer=self.setTimeout(function(){return r.loadPlaylist()},m),this.warn("Retrying playlist loading "+(h+1)+"/"+v.maxNumRetry+' after "'+n+'" in '+m+"ms")}e.levelRetry=!0,l.resolved=!0}return c},s}(tt),$o=function(a){function s(t,e){var r;return r=a.call(this,t,"level-controller")||this,r._levels=[],r._firstLevel=-1,r._maxAutoLevel=-1,r._startLevel=void 0,r.currentLevel=null,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.steering=void 0,r.onParsedComplete=void 0,r.steering=e,r._registerListeners(),r}he(s,a);var i=s.prototype;return i._registerListeners=function(){var e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.ERROR,this.onError,this)},i._unregisterListeners=function(){var e=this.hls;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),a.prototype.destroy.call(this)},i.stopLoad=function(){var e=this._levels;e.forEach(function(r){r.loadError=0,r.fragmentError=0}),a.prototype.stopLoad.call(this)},i.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},i.onManifestLoading=function(e,r){this.resetLevels()},i.onManifestLoaded=function(e,r){var n=this,o=this.hls.config.preferManagedMediaSource,l=[],u={},f={},d=!1,h=!1,v=!1;r.levels.forEach(function(c){var g,m=c.attrs,p=c.audioCodec,y=c.videoCodec;p&&(c.audioCodec=p=Lt(p,o)||void 0),((g=y)==null?void 0:g.indexOf("avc1"))===0&&(y=c.videoCodec=Ra(y));var S=c.width,T=c.height,x=c.unknownCodecs,A=x?x.length:0;if(x)for(var L=A;L--;){var R=x[L];n.isAudioSupported(R)?(c.audioCodec=p=p?p+","+R:R,A--,rt.audio[p.substring(0,4)]=2):n.isVideoSupported(R)&&(c.videoCodec=y=y?y+","+R:R,A--,rt.video[y.substring(0,4)]=2)}if(d||(d=!!(S&&T)),h||(h=!!y),v||(v=!!p),A||p&&!n.isAudioSupported(p)||y&&!n.isVideoSupported(y)){n.log('Some or all CODECS not supported "'+m.CODECS+'"');return}var D=m.CODECS,_=m["FRAME-RATE"],b=m["HDCP-LEVEL"],I=m["PATHWAY-ID"],k=m.RESOLUTION,w=m["VIDEO-RANGE"],O=(I||".")+"-",P=""+O+c.bitrate+"-"+k+"-"+_+"-"+D+"-"+w+"-"+b;if(u[P])if(u[P].uri!==c.url&&!c.attrs["PATHWAY-ID"]){var G=f[P]+=1;c.attrs["PATHWAY-ID"]=new Array(G+1).join(".");var F=n.createLevel(c);u[P]=F,l.push(F)}else u[P].addGroupId("audio",m.AUDIO),u[P].addGroupId("text",m.SUBTITLES);else{var N=n.createLevel(c);u[P]=N,f[P]=1,l.push(N)}}),this.filterAndSortMediaOptions(l,r,d,h,v)},i.createLevel=function(e){var r=new fi(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){var o=new Error('SUPPLEMENTAL-CODECS not supported "'+n.videoCodec+'"');this.log(o.message),r.supportedResult=Wr.getUnsupportedResult(o,[])}return r},i.isAudioSupported=function(e){return rr(e,"audio",this.hls.config.preferManagedMediaSource)},i.isVideoSupported=function(e){return rr(e,"video",this.hls.config.preferManagedMediaSource)},i.filterAndSortMediaOptions=function(e,r,n,o,l){var u=this,f=[],d=[],h=e;if((n||o)&&l&&(h=h.filter(function(D){var _=D.videoCodec,b=D.videoRange,I=D.width,k=D.height;return(!!_||!!(I&&k))&&Ia(b)})),h.length===0){Promise.resolve().then(function(){if(u.hls){var D="no level with compatible codecs found in manifest",_=D;r.levels.length&&(_="one or more CODECS in variant not supported: "+Ae(r.levels.map(function(I){return I.attrs.CODECS}).filter(function(I,k,w){return w.indexOf(I)===k})),u.warn(_),D+=" ("+_+")");var b=new Error(D);u.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:b,reason:_})}});return}r.audioTracks&&(f=r.audioTracks.filter(function(D){return!D.audioCodec||u.isAudioSupported(D.audioCodec)}),In(f)),r.subtitles&&(d=r.subtitles,In(d));var v=h.slice(0);h.sort(function(D,_){if(D.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(D.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&D.height!==_.height)return D.height-_.height;if(D.frameRate!==_.frameRate)return D.frameRate-_.frameRate;if(D.videoRange!==_.videoRange)return Rt.indexOf(D.videoRange)-Rt.indexOf(_.videoRange);if(D.videoCodec!==_.videoCodec){var b=ai(D.videoCodec),I=ai(_.videoCodec);if(b!==I)return I-b}if(D.uri===_.uri&&D.codecSet!==_.codecSet){var k=xt(D.codecSet),w=xt(_.codecSet);if(k!==w)return w-k}return D.averageBitrate!==_.averageBitrate?D.averageBitrate-_.averageBitrate:0});var c=v[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==v.length)){for(var g=0;g<v.length;g++)if(v[g].pathwayId===h[0].pathwayId){c=v[g];break}}this._levels=h;for(var m=0;m<h.length;m++)if(h[m]===c){var p;this._firstLevel=m;var y=c.bitrate,S=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+y),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){var T=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);T>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}var x=l&&!o,A=this.hls.config,L=!!(A.audioStreamController&&A.audioTrackController),R={levels:h,audioTracks:f,subtitleTracks:d,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:l,video:o,altAudio:L&&!x&&f.some(function(D){return!!D.url})};this.hls.trigger(E.MANIFEST_PARSED,R)},i.onError=function(e,r){r.fatal||!r.context||r.context.type===J.LEVEL&&r.context.level===this.level&&this.checkRetry(r)},i.onFragBuffered=function(e,r){var n=r.frag;if(n!==void 0&&n.type===q.MAIN){var o=n.elementaryStreams;if(!Object.keys(o).some(function(u){return!!o[u]}))return;var l=this._levels[n.level];l!=null&&l.loadError&&(this.log("Resetting level error count of "+l.loadError+" on frag buffered"),l.loadError=0)}},i.onLevelLoaded=function(e,r){var n,o=r.level,l=r.details,u=r.levelInfo;if(!u){var f;this.warn("Invalid level index "+o),(f=r.deliveryDirectives)!=null&&f.skip&&(l.deltaUpdateFailed=!0);return}if(u===this.currentLevel||r.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===r.details&&d.advanced&&(d=void 0),this.playlistLoaded(o,r,d)}else(n=r.deliveryDirectives)!=null&&n.skip&&(l.deltaUpdateFailed=!0)},i.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)},i.loadingPlaylist=function(e,r){a.prototype.loadingPlaylist.call(this,e,r);var n=this.getUrlWithDirectives(e.uri,r),o=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],u=e.details,f=u==null?void 0:u.age;this.log("Loading level index "+o+((r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:"")+(l?" Pathway "+l:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+n),this.hls.trigger(E.LEVEL_LOADING,{url:n,level:o,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:r||null})},i.removeLevel=function(e){var r=this,n;if(this._levels.length!==1){var o=this._levels.filter(function(u,f){return f!==e?!0:(r.steering&&r.steering.removeLevel(u),u===r.currentLevel&&(r.currentLevel=null,r.currentLevelIndex=-1,u.details&&u.details.fragments.forEach(function(d){return d.level=-1})),!1)});Vi(o),this._levels=o,this.currentLevelIndex>-1&&(n=this.currentLevel)!=null&&n.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var l=o.length-1;this._firstLevel=Math.min(this._firstLevel,l),this._startLevel&&(this._startLevel=Math.min(this._startLevel,l)),this.hls.trigger(E.LEVELS_UPDATED,{levels:o})}},i.onLevelsUpdated=function(e,r){var n=r.levels;this._levels=n},i.checkMaxAutoUpdated=function(){var e=this.hls,r=e.autoLevelCapping,n=e.maxAutoLevel,o=e.maxHdcpLevel;this._maxAutoLevel!==n&&(this._maxAutoLevel=n,this.hls.trigger(E.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:r,levels:this.levels,maxAutoLevel:n,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:o}))},Z(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var r=this._levels;if(r.length!==0){if(e<0||e>=r.length){var n=new Error("invalid level idx"),o=e<0;if(this.hls.trigger(E.ERROR,{type:Y.OTHER_ERROR,details:C.LEVEL_SWITCH_ERROR,level:e,fatal:o,error:n,reason:n.message}),o)return;e=Math.min(e,r.length-1)}var l=this.currentLevelIndex,u=this.currentLevel,f=u?u.attrs["PATHWAY-ID"]:void 0,d=r[e],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=d,!(l===e&&u&&f===h)){this.log("Switching to level "+e+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+l+(f?" with Pathway "+f:""));var v={level:e,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(E.LEVEL_SWITCHING,v);var c=d.details;if(!c||c.live){var g=this.switchParams(d.uri,u==null?void 0:u.details,c);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var r=this.steering.pathways(),n=e.filter(function(o){return r.indexOf(o)!==-1});if(e.length<1){this.warn("pathwayPriority "+e+" should contain at least one pathway from list: "+r);return}this.steering.pathwayPriority=n}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}])}(Xo);function In(a){var s={};a.forEach(function(i){var t=i.groupId||"";i.id=s[t]=s[t]||0,s[t]++})}var Rr=[];typeof $<"u"&&$&&zo();function zo(){self.addEventListener("message",function(a){var s=a.data,i=s.instanceNo;if(i!==void 0){var t=Rr[i];if(s.cmd==="reset"&&(delete Rr[s.resetNo],t&&t.destroy(),s.cmd="init"),s.cmd==="init"){var e=JSON.parse(s.config),r=new Yt;r.on(E.FRAG_DECRYPTED,ot),r.on(E.ERROR,ot);var n=Vr(e.debug,s.id);Qo(n,i),Rr[i]=new Sr(r,s.typeSupported,e,"",s.id,n),ot("init",null,i);return}if(t)switch(s.cmd){case"configure":{t.configure(s.config);break}case"demux":{var o=t.push(s.data,s.decryptdata,s.chunkMeta,s.state);Je(o)?o.then(function(f){br(self,f,i)}).catch(function(f){ot(E.ERROR,{instanceNo:i,type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker push error"},i)}):br(self,o,i);break}case"flush":{var l=s.chunkMeta,u=t.flush(l);Je(u)?u.then(function(f){Cn(self,f,l,i)}).catch(function(f){ot(E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker flush error"},i)}):Cn(self,u,l,i);break}}}})}function br(a,s,i){if(Zo(s.remuxResult))return!1;var t=[],e=s.remuxResult,r=e.audio,n=e.video;return r&&Dn(t,r),n&&Dn(t,n),a.postMessage({event:"transmuxComplete",data:s,instanceNo:i},t),!0}function Dn(a,s){s.data1&&a.push(s.data1.buffer),s.data2&&a.push(s.data2.buffer)}function Cn(a,s,i,t){var e=s.reduce(function(r,n){return br(a,n,t)||r},!1);e||a.postMessage({event:"transmuxComplete",data:s[0],instanceNo:t}),a.postMessage({event:"flush",data:i,instanceNo:t})}function ot(a,s,i){self.postMessage({event:a,data:s,instanceNo:i})}function Qo(a,s){var i=function(r){var n=function(l){ot("workerLog",{logType:r,message:l},s)};a[r]=n};for(var t in a)i(t)}function Zo(a){return!a.audio&&!a.video&&!a.text&&!a.id3&&!a.initSegment}var pt="1.6.2",lt={};function Jo(){return typeof re=="function"}function el(){var a=lt[pt];if(a)return a.clientCount++,a;var s=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+re.toString()+")(true);"],{type:"text/javascript"}),i=self.URL.createObjectURL(s),t=new self.Worker(i),e={worker:t,objectURL:i,clientCount:1};return lt[pt]=e,e}function tl(a){var s=lt[a];if(s)return s.clientCount++,s;var i=new self.URL(a,self.location.href).href,t=new self.Worker(i),e={worker:t,scriptURL:i,clientCount:1};return lt[a]=e,e}function rl(a){var s=lt[a||pt];if(s){var i=s.clientCount--;if(i===1){var t=s.worker,e=s.objectURL;delete lt[a||pt],e&&self.URL.revokeObjectURL(e),t.terminate()}}}var kn=0,il=function(){function a(i,t,e,r){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=kn++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(v){var c=v.data,g=n.hls;if(!(!g||!(c!=null&&c.event)||c.instanceNo!==n.instanceNo))switch(c.event){case"init":{var m,p=(m=n.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{n.handleTransmuxComplete(c.data);break}case"flush":{n.onFlush(c.data);break}case"workerLog":{g.logger[c.data.logType]&&g.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=n.frag,c.data.part=n.part,c.data.id=n.id,g.trigger(c.event,c.data);break}}},this.onWorkerError=function(v){if(n.hls){var c=new Error(v.message+"  ("+v.filename+":"+v.lineno+")");n.hls.config.enableWorker=!1,n.hls.logger.warn('Error in "'+n.id+'" Web Worker, fallback to inline'),n.hls.trigger(E.ERROR,{type:Y.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})}};var o=i.config;this.hls=i,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=e,this.onFlush=r;var l=function(c,g){g=g||{},g.frag=n.frag||void 0,c===E.ERROR&&(g=g,g.parent=n.id,g.part=n.part,n.error=g.error),n.hls.trigger(c,g)};this.observer=new Yt,this.observer.on(E.FRAG_DECRYPTED,l),this.observer.on(E.ERROR,l);var u=si(o.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var f=this.hls.logger,d=o.workerPath||Jo();if(d){try{o.workerPath?(f.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=tl(o.workerPath)):(f.log('injecting Web Worker for "'+t+'"'),this.workerContext=el());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Ae(o)})}catch(v){f.warn('Error setting up "'+t+'" Web Worker, fallback to inline',v),this.terminateWorker(),this.error=null,this.transmuxer=new Sr(this.observer,u,o,"",t,i.logger)}return}}this.transmuxer=new Sr(this.observer,u,o,"",t,i.logger)}var s=a.prototype;return s.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var t=this.instanceNo;this.instanceNo=kn++;var e=this.hls.config,r=si(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:r,id:this.id,config:Ae(e)})}},s.terminateWorker=function(){if(this.workerContext){var t=this.workerContext.worker;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),rl(this.hls.config.workerPath)}},s.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},s.push=function(t,e,r,n,o,l,u,f,d,h){var v,c,g=this;d.transmuxing.start=self.performance.now();var m=this.instanceNo,p=this.transmuxer,y=l?l.start:o.start,S=o.decryptdata,T=this.frag,x=!(T&&o.cc===T.cc),A=!(T&&d.level===T.level),L=T?d.sn-T.sn:-1,R=this.part?d.part-this.part.index:-1,D=L===0&&d.id>1&&d.id===(T==null?void 0:T.stats.chunkCount),_=!A&&(L===1||L===0&&(R===1||D&&R<=0)),b=self.performance.now();(A||L||o.stats.parsing.start===0)&&(o.stats.parsing.start=b),l&&(R||!_)&&(l.stats.parsing.start=b);var I=!(T&&((v=o.initSegment)==null?void 0:v.url)===((c=T.initSegment)==null?void 0:c.url)),k=new co(x,_,f,A,y,I);if(!_||x||I){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+o.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===q.MAIN?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+x+`
        trackSwitch: `+A+`
        contiguous: `+_+`
        accurateTimeOffset: `+f+`
        timeOffset: `+y+`
        initSegmentChange: `+I);var w=new ho(r,n,e,u,h);this.configureTransmuxer(w)}if(this.frag=o,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:t,decryptdata:S,chunkMeta:d,state:k},t instanceof ArrayBuffer?[t]:[]);else if(p){var O=p.push(t,S,d,k);Je(O)?O.then(function(P){g.handleTransmuxComplete(P)}).catch(function(P){g.transmuxerError(P,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}},s.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var r=this.instanceNo,n=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:r,cmd:"flush",chunkMeta:t});else if(n){var o=n.flush(t);Je(o)?o.then(function(l){e.handleFlushResult(l,t)}).catch(function(l){e.transmuxerError(l,t,"transmuxer-interface flush error")}):this.handleFlushResult(o,t)}},s.transmuxerError=function(t,e,r){this.hls&&(this.error=t,this.hls.trigger(E.ERROR,{type:Y.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:r}))},s.handleFlushResult=function(t,e){var r=this;t.forEach(function(n){r.handleTransmuxComplete(n)}),this.onFlush(e)},s.configureTransmuxer=function(t){var e=this.instanceNo,r=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):r&&r.configure(t)},s.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},a}();function Pn(){return self.SourceBuffer||self.WebKitSourceBuffer}function On(){var a=ze();if(!a)return!1;var s=Pn();return!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function"}function nl(){if(!On())return!1;var a=ze();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(s){return a.isTypeSupported(dt(s,"video"))})||["mp4a.40.2","fLaC"].some(function(s){return a.isTypeSupported(dt(s,"audio"))}))}function al(){var a,s=Pn();return typeof(s==null||(a=s.prototype)==null?void 0:a.changeType)=="function"}var sl=100,ol=function(a){function s(t,e,r){var n;return n=a.call(this,t,e,r,"stream-controller",q.MAIN)||this,n.audioCodecSwap=!1,n.level=-1,n._forceStartLoad=!1,n._hasEnoughToStart=!1,n.altAudio=0,n.audioOnly=!1,n.fragPlaying=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n.onMediaPlaying=function(){n.tick()},n.onMediaSeeked=function(){var o=n.media,l=o?o.currentTime:null;if(!(l===null||!U(l))&&(n.log("Media seeked to "+l.toFixed(3)),!!n.getBufferedFrag(l))){var u=n.getFwdBufferInfoAtPos(o,l,q.MAIN,0);if(u===null||u.len===0){n.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")");return}n.tick()}},n.registerListeners(),n}he(s,a);var i=s.prototype;return i.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)},i.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var e=this.hls;e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this)},i.startLoad=function(e,r){if(this.levels){var n=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(sl),this.level=-1,!this.startFragRequested){var l=o.startLevel;l===-1&&(o.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=o.firstAutoLevel),o.nextLoadLevel=l,this.level=o.loadLevel,this._hasEnoughToStart=!!r}n>0&&e===-1&&!r&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),e=n),this.state=M.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=r?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=M.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case M.WAITING_LEVEL:{var e=this.levels,r=this.level,n=e==null?void 0:e[r],o=n==null?void 0:n.details;if(o&&(!o.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(o))break;this.state=M.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=M.IDLE;break}break}case M.FRAG_LOADING_WAITING_RETRY:{var l,u=self.performance.now(),f=this.retryDate;if(!f||u>=f||(l=this.media)!=null&&l.seeking){var d=this.levels,h=this.level,v=d==null?void 0:d[h];this.resetStartWhenNotLoaded(v||null),this.state=M.IDLE}}break}this.state===M.IDLE&&this.doTickIdle(),this.onTickEnd()},i.onTickEnd=function(){var e;a.prototype.onTickEnd.call(this),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},i.doTickIdle=function(){var e=this.hls,r=this.levelLastLoaded,n=this.levels,o=this.media;if(!(r===null||!o&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var l=this.buffering?e.nextLoadLevel:e.loadLevel;if(n!=null&&n[l]){var u=n[l],f=this.getMainFwdBufferInfo();if(f!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(f,d)){var h={};this.altAudio===2&&(h.type="video"),this.hls.trigger(E.BUFFER_EOS,h),this.state=M.ENDED;return}if(this.buffering){e.loadLevel!==l&&e.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=e.nextLoadLevel=l;var v=u.details;if(!v||this.state===M.WAITING_LEVEL||this.waitForLive(u)){this.level=l,this.state=M.WAITING_LEVEL,this.startFragRequested=!1;return}var c=f.len,g=this.getMaxBufferLength(u.maxBitrate);if(!(c>=g)){this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);var m=this.backtrackFragment?this.backtrackFragment.start:f.end,p=this.getNextFragment(m,v);if(this.couldBacktrack&&!this.fragPrevious&&p&&we(p)&&this.fragmentTracker.getState(p)!==_e.OK){var y,S=((y=this.backtrackFragment)!=null?y:p).sn,T=S-v.startSN,x=v.fragments[T-1];x&&p.cc===x.cc&&(p=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,m)){var A=p.gap;if(!A){var L=this.audioOnly&&!this.altAudio?fe.AUDIO:fe.VIDEO,R=(L===fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,L,q.MAIN)}p=this.getNextFragmentLoopLoading(p,v,f,q.MAIN,g)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,u,m))}}}}}},i.loadFragment=function(e,r,n){var o=this.fragmentTracker.getState(e);o===_e.NOT_LOADED||o===_e.PARTIAL?we(e)?this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,r)):a.prototype.loadFragment.call(this,e,r,n):this._loadInitSegment(e,r):this.clearTrackerIfNeeded(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,q.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var e=this.levels,r=this.media;if(r!=null&&r.readyState){var n,o=this.getAppendedFrag(r.currentTime);o&&o.start>1&&this.flushMainBuffer(0,o.start-1);var l=this.getLevelDetails();if(l!=null&&l.live){var u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!r.paused&&e){var f=this.hls.nextLoadLevel,d=e[f],h=this.fragLastKbps;h&&this.fragCurrent?n=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:n=0}else n=0;var v=this.getBufferedFrag(r.currentTime+n);if(v){var c=this.followingBufferedFrag(v);if(c){this.abortCurrentFrag();var g=c.maxStartPTS?c.maxStartPTS:c.start,m=c.duration,p=Math.max(v.end,g+Math.min(Math.max(m-this.config.maxFragLookUpTolerance,m*(this.couldBacktrack?.5:.125)),m*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(p,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case M.KEY_LOADING:case M.FRAG_LOADING:case M.FRAG_LOADING_WAITING_RETRY:case M.PARSING:case M.PARSED:this.state=M.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(e,r){a.prototype.flushMainBuffer.call(this,e,r,this.altAudio===2?"video":null)},i.onMediaAttached=function(e,r){a.prototype.onMediaAttached.call(this,e,r);var n=r.media;mt(n,"playing",this.onMediaPlaying),mt(n,"seeked",this.onMediaSeeked)},i.onMediaDetaching=function(e,r){var n=this.media;n&&(st(n,"playing",this.onMediaPlaying),st(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,a.prototype.onMediaDetaching.call(this,e,r);var o=!!r.transferMedia;o||(this._hasEnoughToStart=!1)},i.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},i.onManifestParsed=function(e,r){var n=!1,o=!1;r.levels.forEach(function(l){var u=l.audioCodec;u&&(n=n||u.indexOf("mp4a.40.2")!==-1,o=o||u.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&o&&!al(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},i.onLevelLoading=function(e,r){var n=this.levels;if(!(!n||this.state!==M.IDLE)){var o=r.levelInfo;(!o.details||o.details.live&&(this.levelLastLoaded!==o||o.details.expired)||this.waitForCdnTuneIn(o.details))&&(this.state=M.WAITING_LEVEL)}},i.onLevelLoaded=function(e,r){var n,o=this.levels,l=this.startFragRequested,u=r.level,f=r.details,d=f.totalduration;if(!o){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+", cc ["+f.startCC+", "+f.endCC+"] duration:"+d);var h=r.levelInfo,v=this.fragCurrent;v&&(this.state===M.FRAG_LOADING||this.state===M.FRAG_LOADING_WAITING_RETRY)&&v.level!==r.level&&v.loader&&this.abortCurrentFrag();var c=0;if(f.live||(n=h.details)!=null&&n.live){var g;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;c=this.alignPlaylists(f,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=f,this.levelLastLoaded=h,l||this.setStartPosition(f,c),this.hls.trigger(E.LEVEL_UPDATED,{details:f,level:u}),this.state===M.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=M.IDLE}l&&f.live&&this.synchronizeToLiveEdge(f),this.tick()},i.synchronizeToLiveEdge=function(e){var r=this.config,n=this.media;if(n){var o=this.hls.liveSyncPosition,l=this.getLoadPosition(),u=e.fragmentStart,f=e.edge,d=l>=u-r.maxFragLookUpTolerance&&l<=f;if(o!==null&&n.duration>o&&(l<o||!d)){var h=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*e.targetduration;(!d&&n.readyState<4||l<f-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=o),n.readyState&&(this.warn("Playback: "+l.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+o.toFixed(3)),n.currentTime=o))}}},i._handleFragmentLoadProgress=function(e){var r,n=e.frag,o=e.part,l=e.payload,u=this.levels;if(!u){this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered");return}var f=u[n.level];if(!f){this.warn("Level "+n.level+" not found on progress");return}var d=f.details;if(!d){this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset"),this.fragmentTracker.removeFragment(n);return}var h=f.videoCodec,v=d.PTSKnown||!d.live,c=(r=n.initSegment)==null?void 0:r.data,g=this._getAudioCodec(f),m=this.transmuxer=this.transmuxer||new il(this.hls,q.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=o?o.index:-1,y=p!==-1,S=new Sn(n.level,n.sn,n.stats.chunkCount,l.byteLength,p,y),T=this.initPTS[n.cc];m.push(l,c,g,h,n,o,d.totalduration,v,S,T)},i.onAudioTrackSwitching=function(e,r){var n=this,o=this.hls,l=this.altAudio===2,u=ci(r.url,o);if(u)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f&&(this.log("Switching to main audio track, cancel main fragment load"),f.abortRequests(),this.fragmentTracker.removeFragment(f)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(l){this.fragmentTracker.removeAllFragments(),o.once(E.BUFFER_FLUSHED,function(){var d;(d=n.hls)==null||d.trigger(E.AUDIO_TRACK_SWITCHED,r)}),o.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}o.trigger(E.AUDIO_TRACK_SWITCHED,r)}},i.onAudioTrackSwitched=function(e,r){var n=ci(r.url,this.hls);if(n){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=n?2:0,this.tick()},i.onBufferCreated=function(e,r){var n=r.tracks,o,l,u=!1;for(var f in n){var d=n[f];if(d.id==="main"){if(l=f,o=d,f==="video"){var h=n[f];h&&(this.videoBuffer=h.buffer)}}else u=!0}u&&o?(this.log("Alternate track found, use "+l+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(e,r){var n=r.frag,o=r.part,l=n.type===q.MAIN;if(l){if(this.fragContextChanged(n)){this.warn("Fragment "+n.sn+(o?" p: "+o.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),this.state===M.PARSED&&(this.state=M.IDLE);return}var u=o?o.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),we(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,o)}var f=this.media;f&&(!this._hasEnoughToStart&&ae.getBuffered(f).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())},i.onError=function(e,r){var n;if(r.fatal){this.state=M.ERROR;return}switch(r.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(q.MAIN,r);break;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!r.levelRetry&&this.state===M.WAITING_LEVEL&&((n=r.context)==null?void 0:n.type)===J.LEVEL&&(this.state=M.IDLE);break;case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:if(r.parent!=="main")return;this.resetLoadingState();break;case C.BUFFER_FULL_ERROR:if(r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(r);break}},i.onFragLoadEmergencyAborted=function(){this.state=M.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},i.onBufferFlushed=function(e,r){var n=r.type;if(n!==fe.AUDIO||!this.altAudio){var o=(n===fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;o&&(this.afterBufferFlushed(o,n,q.MAIN),this.tick())}},i.onLevelsUpdated=function(e,r){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=r.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var e=this.media;if(e){var r=e.currentTime,n=this.startPosition;if(n>=0&&r<n){if(e.seeking){this.log("could not seek to "+n+", already seeking at "+r);return}var o=this.timelineOffset;o&&n&&(n+=o);var l=this.getLevelDetails(),u=ae.getBuffered(e),f=u.length?u.start(0):0,d=f-n,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);d>0&&(d<h||this.loadingParts&&d<2*((l==null?void 0:l.partTarget)||0))&&(this.log("adjusting start position by "+d+" to match buffer start"),n+=d,this.startPosition=n),r<n&&(this.log("seek to target start position "+n+" from current time "+r+" buffer start "+f),e.currentTime=n)}}},i._getAudioCodec=function(e){var r=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),r},i._loadBitrateTestFrag=function(e,r){var n=this;e.bitrateTest=!0,this._doFragLoad(e,r).then(function(o){var l=n.hls,u=o==null?void 0:o.frag;if(!(!u||n.fragContextChanged(u))){r.fragmentError=0,n.state=M.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var f=u.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),l.trigger(E.FRAG_LOADED,o),u.bitrateTest=!1}})},i._handleTransmuxComplete=function(e){var r,n=this.playlistType,o=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,v=f.level,c=l.video,g=l.text,m=l.id3,p=l.initSegment,y=v.details,S=this.altAudio?void 0:l.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=M.PARSING,p){if(p!=null&&p.tracks){var T=d.initSegment||d;this._bufferInitSegment(v,p.tracks,T,u),o.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:n,tracks:p.tracks})}var x=p.initPTS,A=p.timescale;U(x)&&(this.initPTS[d.cc]={baseTime:x,timescale:A},o.trigger(E.INIT_PTS_FOUND,{frag:d,id:n,initPTS:x,timescale:A}))}if(c&&y){S&&c.type==="audiovideo"&&this.logMuxedErr(d);var L=y.fragments[d.sn-1-y.startSN],R=d.sn===y.startSN,D=!L||d.cc>L.cc;if(l.independent!==!1){var _=c.startPTS,b=c.endPTS,I=c.startDTS,k=c.endDTS;if(h)h.elementaryStreams[c.type]={startPTS:_,endPTS:b,startDTS:I,endDTS:k};else if(c.firstKeyFrame&&c.independent&&u.id===1&&!D&&(this.couldBacktrack=!0),c.dropped&&c.independent){var w=this.getMainFwdBufferInfo(),O=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,P=c.firstKeyFramePTS?c.firstKeyFramePTS:_;if(!R&&O<P-this.config.maxBufferHole&&!D){this.backtrack(d);return}else D&&(d.gap=!0);d.setElementaryStreamInfo(c.type,d.start,b,d.start,k,!0)}else R&&_-(y.appliedTimelineOffset||0)>Bt&&(d.gap=!0);d.setElementaryStreamInfo(c.type,_,b,I,k),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(c,d,h,u,R||D)}else if(R||D)d.gap=!0;else{this.backtrack(d);return}}if(S){var N=S.startPTS,G=S.endPTS,F=S.startDTS,V=S.endDTS;h&&(h.elementaryStreams[fe.AUDIO]={startPTS:N,endPTS:G,startDTS:F,endDTS:V}),d.setElementaryStreamInfo(fe.AUDIO,N,G,F,V),this.bufferFragmentData(S,d,h,u)}if(y&&m!=null&&(r=m.samples)!=null&&r.length){var ie={id:n,frag:d,details:y,samples:m.samples};o.trigger(E.FRAG_PARSING_METADATA,ie)}if(y&&g){var j={id:n,frag:d,details:y,samples:g.samples};o.trigger(E.FRAG_PARSING_USERDATA,j)}},i.logMuxedErr=function(e){this.warn((we(e)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+e.url)},i._bufferInitSegment=function(e,r,n,o){var l=this;if(this.state===M.PARSING){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&(delete r.audio,r.audiovideo&&this.logMuxedErr(n));var u=r.audio,f=r.video,d=r.audiovideo;if(u){var h=At(u.codec,e.audioCodec);h==="mp4a"&&(h="mp4a.40.5");var v=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");var c=u.metadata;c&&"channelCount"in c&&(c.channelCount||1)!==1&&v.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log("Android: force audio codec to "+h)),e.audioCodec&&e.audioCodec!==h&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+h+'"'),u.levelCodec=h,u.id=q.MAIN,this.log("Init audio buffer, container:"+u.container+", codecs[selected/level/parsed]=["+(h||"")+"/"+(e.audioCodec||"")+"/"+u.codec+"]"),delete r.audiovideo}if(f){f.levelCodec=e.videoCodec,f.id=q.MAIN;var g=f.codec;if((g==null?void 0:g.length)===4)switch(g){case"hvc1":case"hev1":f.codec="hvc1.1.6.L120.90";break;case"av01":f.codec="av01.0.04M.08";break;case"avc1":f.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+g+"]"+(f.codec!==g?" parsed-corrected="+f.codec:"")+(f.supplemental?" supplemental="+f.supplemental:"")),delete r.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+e.codecs+"/"+d.codec+"]"),delete r.video,delete r.audio);var m=Object.keys(r);if(m.length){if(this.hls.trigger(E.BUFFER_CODECS,r),!this.hls)return;m.forEach(function(p){var y=r[p],S=y.initSegment;S!=null&&S.byteLength&&l.hls.trigger(E.BUFFER_APPENDING,{type:p,data:S,frag:n,part:null,chunkMeta:o,parent:n.type})})}this.tickImmediate()}},i.getMainFwdBufferInfo=function(){var e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,q.MAIN)},i.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=M.IDLE},i.checkFragmentChanged=function(){var e=this.media,r=null;if(e&&e.readyState>1&&e.seeking===!1){var n=e.currentTime;if(ae.isBuffered(e,n)?r=this.getAppendedFrag(n):ae.isBuffered(e,n+.1)&&(r=this.getAppendedFrag(n+.1)),r){this.backtrackFragment=null;var o=this.fragPlaying,l=r.level;(!o||r.sn!==o.sn||o.level!==l)&&(this.fragPlaying=r,this.hls.trigger(E.FRAG_CHANGED,{frag:r}),(!o||o.level!==l)&&this.hls.trigger(E.LEVEL_SWITCHED,{level:l}))}}},Z(s,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var e=this.levels,r=this.level,n=e==null?void 0:e[r];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e;if(this.fragPlaying)return this.fragPlaying;var r=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return U(r)?this.getAppendedFrag(r):null}},{key:"currentProgramDateTime",get:function(){var e,r=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(U(r)){var n=this.getLevelDetails(),o=this.currentFrag||(n?ar(null,n.fragments,r):null);if(o){var l=o.programDateTime;if(l!==null){var u=l+(r-o.start)*1e3;return new Date(u)}}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(Mo),ll=function(){function a(i){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=i}var s=a.prototype;return s.abort=function(t){for(var e in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[e].loader;if(r){var n;if(t&&t!==((n=r.context)==null?void 0:n.frag.type))return;r.abort()}}},s.detach=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},s.destroy=function(){this.detach();for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},s.createKeyLoadError=function(t,e,r,n,o){return e===void 0&&(e=C.KEY_LOAD_ERROR),new je({type:Y.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:o,error:r,networkDetails:n})},s.loadClear=function(t,e){var r=this;if(this.emeController&&this.config.emeEnabled)for(var n=t.sn,o=t.cc,l=function(){var d=e[u];if(o<=d.cc&&(n==="initSegment"||d.sn==="initSegment"||n<d.sn))return r.emeController.selectKeySystemFormat(d).then(function(h){d.setKeyFormat(h)}),1},u=0;u<e.length&&!l();u++);},s.load=function(t){var e=this;return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(function(r){return e.loadInternal(t,r)}):this.loadInternal(t)},s.loadInternal=function(t,e){var r,n;e&&t.setKeyFormat(e);var o=t.decryptdata;if(!o){var l=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,l))}var u=o.uri;if(!u)return Promise.reject(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+u+'"')));var f=this.keyUriToKeyInfo[u];if((r=f)!=null&&r.decryptdata.key)return o.key=f.decryptdata.key,Promise.resolve({frag:t,keyInfo:f});if((n=f)!=null&&n.keyLoadPromise){var d;switch((d=f.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return f.keyLoadPromise.then(function(h){return o.key=h.keyInfo.decryptdata.key,{frag:t,keyInfo:f}})}}switch(f=this.keyUriToKeyInfo[u]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(f,t):this.loadKeyEME(f,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,t);default:return Promise.reject(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+o.method+'"')))}},s.loadKeyEME=function(t,e){var r={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(r);if(n)return(t.keyLoadPromise=n.then(function(o){return t.mediaKeySessionContext=o,r})).catch(function(o){throw t.keyLoadPromise=null,o})}return Promise.resolve(r)},s.loadKeyHTTP=function(t,e){var r=this,n=this.config,o=n.loader,l=new o(n);return e.keyLoader=t.loader=l,t.keyLoadPromise=new Promise(function(u,f){var d={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},h=n.keyLoadPolicy.default,v={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(m,p,y,S){var T=y.frag,x=y.keyInfo,A=y.url;if(!T.decryptdata||x!==r.keyUriToKeyInfo[A])return f(r.createKeyLoadError(T,C.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));x.decryptdata.key=T.decryptdata.key=new Uint8Array(m.data),T.keyLoader=null,x.loader=null,u({frag:T,keyInfo:x})},onError:function(m,p,y,S){r.resetLoader(p),f(r.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error("HTTP Error "+m.code+" loading key "+m.text),y,be({url:d.url,data:void 0},m)))},onTimeout:function(m,p,y){r.resetLoader(p),f(r.createKeyLoadError(e,C.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:function(m,p,y){r.resetLoader(p),f(r.createKeyLoadError(e,C.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};l.load(d,v,c)})},s.resetLoader=function(t){var e=t.frag,r=t.keyInfo,n=t.url,o=r.loader;e.keyLoader===o&&(e.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],o&&o.destroy()},a}();function Mn(a){var s=a.type;switch(s){case J.AUDIO_TRACK:return q.AUDIO;case J.SUBTITLE_TRACK:return q.SUBTITLE;default:return q.MAIN}}function _r(a,s){var i=a.url;return(i===void 0||i.indexOf("data:")===0)&&(i=s.url),i}var ul=function(){function a(i){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=i,this.registerListeners()}var s=a.prototype;return s.startLoad=function(t){},s.stopLoad=function(){this.destroyInternalLoaders()},s.registerListeners=function(){var t=this.hls;t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.LEVEL_LOADING,this.onLevelLoading,this),t.on(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this)},s.unregisterListeners=function(){var t=this.hls;t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.LEVEL_LOADING,this.onLevelLoading,this),t.off(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this)},s.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,n=e.loader,o=r||n,l=new o(e);return this.loaders[t.type]=l,l},s.getInternalLoader=function(t){return this.loaders[t.type]},s.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},s.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},s.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},s.onManifestLoading=function(t,e){var r=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:J.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})},s.onLevelLoading=function(t,e){var r=e.id,n=e.level,o=e.pathwayId,l=e.url,u=e.deliveryDirectives,f=e.levelInfo;this.load({id:r,level:n,pathwayId:o,responseType:"text",type:J.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:f})},s.onAudioTrackLoading=function(t,e){var r=e.id,n=e.groupId,o=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:r,groupId:n,level:null,responseType:"text",type:J.AUDIO_TRACK,url:o,deliveryDirectives:l,levelOrTrack:u})},s.onSubtitleTrackLoading=function(t,e){var r=e.id,n=e.groupId,o=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:r,groupId:n,level:null,responseType:"text",type:J.SUBTITLE_TRACK,url:o,deliveryDirectives:l,levelOrTrack:u})},s.onLevelsUpdated=function(t,e){var r=this.loaders[J.LEVEL];if(r){var n=r.context;n&&!e.levels.some(function(o){return o===n.levelOrTrack})&&(r.abort(),delete this.loaders[J.LEVEL])}},s.load=function(t){var e,r=this,n=this.hls.config,o=this.getInternalLoader(t);if(o){var l=this.hls.logger,u=o.context;if(u&&u.levelOrTrack===t.levelOrTrack&&(u.url===t.url||u.deliveryDirectives&&!t.deliveryDirectives)){u.url===t.url?l.log("[playlist-loader]: ignore "+t.url+" ongoing request"):l.log("[playlist-loader]: ignore "+t.url+" in favor of "+u.url);return}l.log("[playlist-loader]: aborting previous loader for type: "+t.type),o.abort()}var f;if(t.type===J.MANIFEST?f=n.manifestLoadPolicy.default:f=ee({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(t),U((e=t.deliveryDirectives)==null?void 0:e.part)){var d;if(t.type===J.LEVEL&&t.level!==null?d=this.hls.levels[t.level].details:t.type===J.AUDIO_TRACK&&t.id!==null?d=this.hls.audioTracks[t.id].details:t.type===J.SUBTITLE_TRACK&&t.id!==null&&(d=this.hls.subtitleTracks[t.id].details),d){var h=d.partTarget,v=d.targetduration;if(h&&v){var c=Math.max(h*3,v*.8)*1e3;f=ee({},f,{maxTimeToFirstByteMs:Math.min(c,f.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,f.maxTimeToFirstByteMs)})}}}var g=f.errorRetry||f.timeoutRetry||{},m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},p={onSuccess:function(S,T,x,A){var L=r.getInternalLoader(x);r.resetInternalLoader(x.type);var R=S.data;if(R.indexOf("#EXTM3U")!==0){r.handleManifestParsingError(S,x,new Error("no EXTM3U delimiter"),A||null,T);return}T.parsing.start=performance.now(),ct.isMediaPlaylist(R)||x.type!==J.MANIFEST?r.handleTrackOrLevelPlaylist(S,T,x,A||null,L):r.handleMasterPlaylist(S,T,x,A)},onError:function(S,T,x,A){r.handleNetworkError(T,x,!1,S,A)},onTimeout:function(S,T,x){r.handleNetworkError(T,x,!0,void 0,S)}};o.load(t,m,p)},s.checkAutostartLoad=function(){if(this.hls){var t=this.hls,e=t.config,r=e.autoStartLoad,n=e.startPosition,o=t.forceStartLoad;(r||o)&&(this.hls.logger.log((r?"auto":"force")+" startLoad with configured startPosition "+n),this.hls.startLoad(n))}},s.handleMasterPlaylist=function(t,e,r,n){var o=this.hls,l=t.data,u=_r(t,r),f=ct.parseMasterPlaylist(l,u);if(f.playlistParsingError){this.handleManifestParsingError(t,r,f.playlistParsingError,n,e);return}var d=f.contentSteering,h=f.levels,v=f.sessionData,c=f.sessionKeys,g=f.startTimeOffset,m=f.variableList;this.variableList=m;var p=ct.parseMasterPlaylistMedia(l,u,f),y=p.AUDIO,S=y===void 0?[]:y,T=p.SUBTITLES,x=p["CLOSED-CAPTIONS"];if(S.length){var A=S.some(function(L){return!L.url});!A&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ge({}),bitrate:0,url:""}))}o.trigger(E.MANIFEST_LOADED,{levels:h,audioTracks:S,subtitles:T,captions:x,contentSteering:d,url:u,stats:e,networkDetails:n,sessionData:v,sessionKeys:c,startTimeOffset:g,variableList:m})},s.handleTrackOrLevelPlaylist=function(t,e,r,n,o){var l=this.hls,u=r.id,f=r.level,d=r.type,h=_r(t,r),v=U(f)?f:U(u)?u:0,c=Mn(r),g=ct.parseLevelPlaylist(t.data,h,v,c,0,this.variableList);if(d===J.MANIFEST){var m={attrs:new ge({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=e.loading.start+Bi(g,0),l.trigger(E.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:e,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),r.levelDetails=g,this.handlePlaylistLoaded(g,t,e,r,n,o)},s.handleManifestParsingError=function(t,e,r,n,o){this.hls.trigger(E.ERROR,{type:Y.NETWORK_ERROR,details:C.MANIFEST_PARSING_ERROR,fatal:e.type===J.MANIFEST,url:t.url,err:r,error:r,reason:r.message,response:t,context:e,networkDetails:n,stats:o})},s.handleNetworkError=function(t,e,r,n,o){r===void 0&&(r=!1);var l="A network "+(r?"timeout":"error"+(n?" (status "+n.code+")":""))+" occurred while loading "+t.type;t.type===J.LEVEL?l+=": "+t.level+" id: "+t.id:(t.type===J.AUDIO_TRACK||t.type===J.SUBTITLE_TRACK)&&(l+=" id: "+t.id+' group-id: "'+t.groupId+'"');var u=new Error(l);this.hls.logger.warn("[playlist-loader]: "+l);var f=C.UNKNOWN,d=!1,h=this.getInternalLoader(t);switch(t.type){case J.MANIFEST:f=r?C.MANIFEST_LOAD_TIMEOUT:C.MANIFEST_LOAD_ERROR,d=!0;break;case J.LEVEL:f=r?C.LEVEL_LOAD_TIMEOUT:C.LEVEL_LOAD_ERROR,d=!1;break;case J.AUDIO_TRACK:f=r?C.AUDIO_TRACK_LOAD_TIMEOUT:C.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case J.SUBTITLE_TRACK:f=r?C.SUBTITLE_TRACK_LOAD_TIMEOUT:C.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(t.type);var v={type:Y.NETWORK_ERROR,details:f,fatal:d,url:t.url,loader:h,context:t,error:u,networkDetails:e,stats:o};if(n){var c=(e==null?void 0:e.url)||t.url;v.response=be({url:c,data:void 0},n)}this.hls.trigger(E.ERROR,v)},s.handlePlaylistLoaded=function(t,e,r,n,o,l){var u=this.hls,f=n.type,d=n.level,h=n.id,v=n.groupId,c=n.deliveryDirectives,g=_r(e,n),m=Mn(n),p=typeof n.level=="number"&&m===q.MAIN?d:void 0;if(!t.fragments.length){var y=t.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(E.ERROR,{type:Y.NETWORK_ERROR,details:C.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:e,context:n,level:p,parent:m,networkDetails:o,stats:r});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));var S=t.playlistParsingError;if(S){if(this.hls.logger.warn(S),!u.config.ignorePlaylistParsingErrors){u.trigger(E.ERROR,{type:Y.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:S,reason:S.message,response:e,context:n,level:p,parent:m,networkDetails:o,stats:r});return}t.playlistParsingError=null}switch(t.live&&l&&(l.getCacheAge&&(t.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),f){case J.MANIFEST:case J.LEVEL:u.trigger(E.LEVEL_LOADED,{details:t,levelInfo:n.levelOrTrack||u.levels[0],level:p||0,id:h||0,stats:r,networkDetails:o,deliveryDirectives:c,withoutMultiVariant:f===J.MANIFEST});break;case J.AUDIO_TRACK:u.trigger(E.AUDIO_TRACK_LOADED,{details:t,track:n.levelOrTrack,id:h||0,groupId:v||"",stats:r,networkDetails:o,deliveryDirectives:c});break;case J.SUBTITLE_TRACK:u.trigger(E.SUBTITLE_TRACK_LOADED,{details:t,track:n.levelOrTrack,id:h||0,groupId:v||"",stats:r,networkDetails:o,deliveryDirectives:c});break}},a}(),fl={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function dl(a,s){return{supported:!1,configurations:s,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:a}}var wn={};function hl(a,s,i){var t=a.videoCodec,e=a.audioCodec;if(!t&&!e||!i)return Promise.resolve(fl);var r=[];if(t){var n={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},o=a.videoRange;o!=="SDR"&&(n.transferFunction=o.toLowerCase());var l=t.split(","),u=navigator.userAgent;if(l.some(function(f){return tr(f)})&&ri())return Promise.resolve(dl(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: ("+u+")"),r));r.push.apply(r,l.map(function(f){return{type:"media-source",video:be(be({},n),{},{contentType:dt(ba(f),"video")})}}))}return e&&a.audioGroups&&a.audioGroups.forEach(function(f){var d;f&&((d=s.groups[f])==null||d.tracks.forEach(function(h){if(h.groupId===f){var v=h.channels||"",c=parseFloat(v);U(c)&&c>2&&r.push.apply(r,e.split(",").map(function(g){return{type:"media-source",audio:{contentType:dt(g,"audio"),channels:""+c}}}))}}))}),Promise.all(r.map(function(f){var d=cl(f);return wn[d]||(wn[d]=i.decodingInfo(f))})).then(function(f){return{supported:!f.some(function(d){return!d.supported}),configurations:r,decodingInfoResults:f}}).catch(function(f){return{supported:!1,configurations:r,decodingInfoResults:[],error:f}})}function cl(a){var s=a.audio,i=a.video,t=i||s;if(t){var e=oi(t.contentType);if(i)return"r"+i.height+"x"+i.width+"f"+Math.ceil(i.framerate)+(i.transferFunction||"sd")+"_"+e+"_"+Math.ceil(i.bitrate/1e5);if(s)return"c"+s.channels+(s.spatialRendering?"s":"n")+"_"+e}return""}var Fn=function(){function a(i){i===void 0&&(i={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Yt,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var t=this.logger=Vr(i.debug||!1,"Hls instance",i.assetPlayerId),e=this.config=Ao(a.DefaultConfig,i,t);this.userConfig=i,e.progressive&&Ro(e,t);var r=e.abrController,n=e.bufferController,o=e.capLevelController,l=e.errorController,u=e.fpsController,f=new l(this),d=this.abrController=new r(this),h=new bo(this),v=e.interstitialsController,c=v?this.interstitialsController=new v(this,a):null,g=this.bufferController=new n(this,h),m=this.capLevelController=new o(this),p=new u(this),y=new ul(this),S=e.contentSteeringController,T=S?new S(this):null,x=this.levelController=new $o(this,T),A=new qo(this),L=new ll(this.config),R=this.streamController=new ol(this,h,L),D=this.gapController=new Bo(this,h);m.setStreamController(R),p.setStreamController(R);var _=[y,x,R];c&&_.splice(1,0,c),T&&_.splice(1,0,T),this.networkControllers=_;var b=[d,g,D,m,p,A,h];this.audioTrackController=this.createController(e.audioTrackController,_);var I=e.audioStreamController;I&&_.push(this.audioStreamController=new I(this,h,L)),this.subtitleTrackController=this.createController(e.subtitleTrackController,_);var k=e.subtitleStreamController;k&&_.push(this.subtititleStreamController=new k(this,h,L)),this.createController(e.timelineController,b),L.emeController=this.emeController=this.createController(e.emeController,b),this.cmcdController=this.createController(e.cmcdController,b),this.latencyController=this.createController(jo,b),this.coreComponents=b,_.push(f);var w=f.onErrorOut;typeof w=="function"&&this.on(E.ERROR,w,f),this.on(E.MANIFEST_LOADED,y.onManifestLoaded,y)}a.isMSESupported=function(){return On()},a.isSupported=function(){return nl()},a.getMediaSource=function(){return ze()};var s=a.prototype;return s.createController=function(t,e){if(t){var r=new t(this);return e&&e.push(r),r}return null},s.on=function(t,e,r){r===void 0&&(r=this),this._emitter.on(t,e,r)},s.once=function(t,e,r){r===void 0&&(r=this),this._emitter.once(t,e,r)},s.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},s.off=function(t,e,r,n){r===void 0&&(r=this),this._emitter.off(t,e,r,n)},s.listeners=function(t){return this._emitter.listeners(t)},s.emit=function(t,e,r){return this._emitter.emit(t,e,r)},s.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(n){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;var r=t===E.ERROR;this.trigger(E.ERROR,{type:Y.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:r,event:t,error:n}),this.triggeringException=!1}}return!1},s.listenerCount=function(t){return this._emitter.listenerCount(t)},s.destroy=function(){this.logger.log("destroy"),this.trigger(E.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null},s.attachMedia=function(t){if(!t||"media"in t&&!t.media){var e=new Error("attachMedia failed: invalid argument ("+t+")");this.trigger(E.ERROR,{type:Y.OTHER_ERROR,details:C.ATTACH_MEDIA_ERROR,fatal:!0,error:e});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var r="media"in t,n=r?t.media:t,o=r?t:{media:n};this._media=n,this.trigger(E.MEDIA_ATTACHING,o)},s.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(E.MEDIA_DETACHING,{}),this._media=null},s.transferMedia=function(){this._media=null;var t=this.bufferController.transferMedia();return this.trigger(E.MEDIA_DETACHING,{transferMedia:t}),t},s.loadSource=function(t){this.stopLoad();var e=this.media,r=this._url,n=this._url=jt.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+n),e&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(E.MANIFEST_LOADING,{url:t})},s.startLoad=function(t,e){t===void 0&&(t=-1),this.logger.log("startLoad("+(t+(e?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(t,e),!(!this.started||!this.networkControllers));r++);},s.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);},s.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(t){t.resumeBuffering&&t.resumeBuffering()}))},s.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(t){t.pauseBuffering&&t.pauseBuffering()}))},s.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){this.logger.log("recoverMediaError");var t=this._media,e=t==null?void 0:t.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))},s.removeLevel=function(t){this.levelController.removeLevel(t)},s.setAudioOption=function(t){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(t))||null},s.setSubtitleOption=function(t){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(t))||null},s.getMediaDecodingInfo=function(t,e){e===void 0&&(e=this.allAudioTracks);var r=hi(e);return hl(t,r,navigator.mediaCapabilities)},Z(a,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var t,e=(t={},t[q.MAIN]=this.streamController.inFlightFrag,t);return this.audioStreamController&&(e[q.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[q.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}},{key:"sessionId",get:function(){var t=this._sessionId;return t||(t=this._sessionId=Xn()),t}},{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){this.logger.log("set currentLevel:"+t),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){this.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){this.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){this.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){var t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t},set:function(t){this.logger.log("set startLevel:"+t),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(this.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN},set:function(t){this.abrController.resetEstimator(t)}},{key:"abrEwmaDefaultEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(t){_a(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,n=0;n<r;n++)if(t[n].maxBitrate>=e)return n;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping,r=this.maxHdcpLevel,n;if(e===-1&&t!=null&&t.length?n=t.length-1:n=e,r)for(var o=n;o--;){var l=t[o].attrs["HDCP-LEVEL"];if(l&&l<=r)return o}return n}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(t){this.abrController.nextAutoLevel=t}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var t=this.audioTrackController;return t?t.allAudioTracks:[]}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"allSubtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:!1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(t){this.latencyController.targetLatency=t}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(t){this.levelController.pathwayPriority=t}},{key:"bufferedToEnd",get:function(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}}],[{key:"version",get:function(){return pt}},{key:"Events",get:function(){return E}},{key:"MetadataSchema",get:function(){return ke}},{key:"ErrorTypes",get:function(){return Y}},{key:"ErrorDetails",get:function(){return C}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:xo},set:function(t){a.defaultConfig=t}}])}();return Fn.defaultConfig=void 0,Fn})})(!1)}(Or)),Or.exports}var Yl=Wl();const Xe=Rl(Yl);var qn={};qn.getBrowserVersion=function(){var B=navigator.userAgent;if(B.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(B.indexOf("Firefox")>-1){var X=B.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Firefox "+X}else if(B.indexOf("Edge")>-1){var re=B.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Edge "+re}else{if(B.indexOf("rv:11")>-1)return"IE 11";if(B.indexOf("Opera")>-1||B.indexOf("OPR")>-1){if(B.indexOf("Opera")>-1){var $=B.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+$}if(B.indexOf("OPR")>-1){var z=B.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+z}}else if(B.indexOf("Chrome")>-1){var W=B.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Chrome "+W}else if(B.indexOf("Safari")>-1){var Z=B.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Safari "+Z}else if(B.indexOf("MSIE")>-1||B.indexOf("Trident")>-1){if(B.indexOf("MSIE")>-1){var Ge=B.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+Ge}if(B.indexOf("Trident")>-1){var ee=B.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0],ne=parseInt(ee)+4;return"IE "+ne}}else return"Unknown"}};var ql=function(B){Nl(re,B);var X=Hl(re);function re($){var z;return wl(this,re),z=X.call(this,$),z.browser=qn.getBrowserVersion(),z.hls=null,z.hlsOpts={},z.player.handleSource=!1,z}return Fl(re,[{key:"_adaptHlsJsConfig",value:function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=this.playerConfig;return!(z!=null&&z.startPosition)&&typeof W.startTime=="number"&&(z.startPosition=W.startTime),z}},{key:"afterCreate",value:function(){var z=this,W=this.config.hlsOpts;this.hlsOpts=this._adaptHlsJsConfig(W),this.on(Ol,function(Z){/^blob/.test(Z)||(z.playerConfig.url=Z,z.register(Z))});try{Pr.defineGetterOrSetter(this.player,{url:{get:function(){try{return z.player.video.src}catch{return null}},configurable:!0}})}catch{}}},{key:"beforePlayerInit",value:function(){this.register(this.player.config.url)}},{key:"destroy",value:function(){this.hls&&this.hls.destroy();var z=this.player;Pr.defineGetterOrSetter(z,{url:{get:function(){try{return z.__url}catch{return null}},configurable:!0}})}},{key:"register",value:function(z){var W=this,Z=this.player;this.hls&&this.hls.destroy(),this.hls=new Xe(this.hlsOpts),this.hls.once(Xe.Events.MEDIA_ATTACHED,function(){W.hls.loadSource(z)}),this.hls.on(Xe.Events.ERROR,function(Ge,ee){var ne;if(Z.emit("HLS_ERROR",{errorType:ee.type,errorDetails:ee.details,errorFatal:ee.fatal}),ee.fatal)switch(ee.type){case Xe.ErrorTypes.NETWORK_ERROR:(ee==null||(ne=ee.networkDetails)===null||ne===void 0?void 0:ne.status)!==404&&W.hls.startLoad();break;case Xe.ErrorTypes.MEDIA_ERROR:W.hls.recoverMediaError();break;default:Z.emit("error",ee)}}),this.hls.attachMedia(this.player.media||this.player.video),this._statistics()}},{key:"_statistics",value:function(){var z={speed:0,playerType:"HlsPlayer"},W={videoDataRate:0,audioDataRate:0},Z=this.player,Ge=this.hls;Ge.on(Xe.Events.FRAG_LOAD_PROGRESS,function(ee,ne){z.speed=ne.stats.loaded/1e3}),Ge.on(Xe.Events.FRAG_PARSING_DATA,function(ee,ne){ne.type==="video"&&(W.fps=parseInt(ne.nb/(ne.endPTS-ne.startPTS)))}),Ge.on(Xe.Events.FRAG_PARSING_INIT_SEGMENT,function(ee,ne){if(W.hasAudio=!!(ne.tracks&&ne.tracks.audio),W.hasVideo=!!(ne.tracks&&ne.tracks.audio),W.hasAudio){var he=ne.tracks.audio;W.audioChannelCount=he.metadata&&he.metadata.channelCount?he.metadata.channelCount:0,W.audioCodec=he.codec}if(W.hasVideo){var We=ne.tracks.video;W.videoCodec=We.codec,W.width=We.metadata&&We.metadata.width?We.metadata.width:0,W.height=We.metadata&&We.metadata.height?We.metadata.height:0}W.duration=ne.frag&&ne.frag.duration?ne.frag.duration:0,W.level=ne.frag&&ne.frag.levels?ne.frag.levels:0,(W.videoCodec||W.audioCodec)&&(W.mimeType='video/hls; codecs="'.concat(W.videoCodec,";").concat(W.audioCodec,'"')),Z.mediainfo=W,Z.emit("media_info",W)}),this._statisticsTimmer=setInterval(function(){Z.emit("statistics_info",z),z.speed=0},1e3)}}],[{key:"pluginName",get:function(){return"HlsJsPlugin"}},{key:"defaultConfig",get:function(){return{hlsOpts:{}}}},{key:"isSupported",get:function(){return Xe.isSupported}}]),re}(Pr);const jl=["id"],zl=bl({name:"VabPlayerHls",__name:"VabPlayerHls",props:{config:{type:Object,default:()=>({id:"mse",url:""})}},emits:["player"],setup(B,{emit:X}){const re=B,$=_l(null),z=X,W=()=>{re.config.url&&re.config.url!==""&&($.value=new Ml({plugins:[ql],...re.config}),z("player",$.value))};return Il(re.config,()=>{W()},{deep:!0}),Dl(()=>{W()}),Cl(()=>{$.value&&typeof $.value.destroy=="function"&&$.value.destroy()}),(Z,Ge)=>(Pl(),kl("div",{id:B.config.id},null,8,jl))}});export{zl as default};
