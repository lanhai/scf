/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-11-05 21:04:18 
 */
import{$ as y}from"./http-08Dy-572.js";import{d as A,r,ab as N,S as u,o as _,T as a,b as m,Z as s,az as z,u as o,aA as D,ac as f,Y as d,aJ as M,aB as S,ad as I,bs as J,i as L,Q as O}from"./vsv-element-plus-uCf0_uY0.js";import{l as P,$ as Q,m as R,_ as U}from"./index-DMkebb7r.js";import"./vsv-icon-D20Jw_Ve.js";import"./vsv-nprogress-D-M_H-zP.js";const Y={style:{"padding-bottom":"20px","max-height":"calc(100vh - 320px)","overflow-y":"auto","overflow-x":"hidden"}},Z={class:"remark-ellipsis"},q=A({name:"AppVersions",__name:"AppVersions",props:{current:{type:Object,default:{app:"0.0.0",public:"0.0.0"}}},emits:["updated"],setup(g,{expose:h,emit:k}){const v=g,c=r(!1),n=r(!1),x=k,b=r([]),t=r({type:"",version:""}),$=async l=>{c.value=!0,t.value.type=l,await V()},V=async()=>{n.value=!0;const{data:l}=await y.get("/versions",{type:t.value.type},10*1e3).finally(()=>{n.value=!1});b.value=l},w=async l=>{P(`确定要更新所有节点的 ${t.value.type} 版本为 ${l} 吗？`,"操作确认",async()=>{t.value.version=l,n.value=!0;const{data:p}=await y.post("/update",Q(t.value),1e3*310).finally(()=>{n.value=!1});R(`${p}个节点更新完毕`,"success","hey"),c.value=!1,x("updated")})};return h({show:$}),N(async()=>{}),(l,p)=>{const i=D,B=M,C=S,E=I,T=z,j=O;return _(),u(j,{modelValue:o(c),"onUpdate:modelValue":p[0]||(p[0]=e=>L(c)?c.value=e:null),"append-to-body":"",draggable:"",title:"版本管理",width:"1100","close-on-click-modal":!1,"destroy-on-close":!0,"close-on-press-escape":!1,top:"10vh"},{default:a(()=>[m("div",Y,[s(T,{data:o(b),"v-loading":o(n)},{default:a(()=>[s(i,{prop:"version",label:"版本号",width:"100"}),s(i,{prop:"release_date",label:"发布时间",width:"200"},{default:a(({row:e})=>[f(d(e.release_date),1)]),_:1}),s(i,{prop:"file",label:"文件"},{default:a(({row:e})=>[f(d(o(t).type==="app"?e.app_object||"--":e.public_object||"--"),1)]),_:1}),s(i,{prop:"remark",label:"说明",width:"160"},{default:a(({row:e})=>[s(B,{trigger:"hover",placement:"top"},{reference:a(()=>[m("span",Z,d(e.remark),1)]),default:a(()=>[m("div",null,d(e.remark),1)]),_:2},1024)]),_:1}),s(i,{label:"操作",align:"center",width:"100"},{default:a(({row:e})=>[o(t).type==="app"&&v.current.app===e.version||o(t).type==="public"&&v.current.public===e.version?(_(),u(C,{key:0,type:"success"},{default:a(()=>p[1]||(p[1]=[f("当前版本")])),_:1})):(_(),u(E,{key:1,size:"small",icon:o(J),onClick:F=>w(e.version),loading:o(n)},null,8,["icon","onClick","loading"]))]),_:1})]),_:1},8,["data","v-loading"])])]),_:1},8,["modelValue"])}}}),ee=U(q,[["__scopeId","data-v-836f9071"]]);export{ee as default};
