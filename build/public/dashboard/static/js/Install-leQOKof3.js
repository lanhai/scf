/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-09-28 18:17:19 
 */
import x from"./LoginContainer-D6YjAo_a.js";import{d as C,r as d,f as h,ab as L,F as M,S as v,T as l,R as N,ag as q,o as b,b as m,Z as c,u as o,ah as F,ai as O,U as Y,aj as H,ak as K,ad as P,ac as U,Y as j}from"./vsv-element-plus-Cu8LirE2.js";import{$ as _,l as W}from"./storage-D_topuDp.js";import{d as Z,e as z,g as w,a as G,s as J,b as Q,o as X,c as ee,t as y,$ as te,_ as oe}from"./index-m_tYK7FI.js";import{$ as f}from"./http-Bya4--Jo.js";import"./bing-BzhKgjx2.js";import"./vsv-icon-DxrXNnxK.js";import"./vsv-nprogress-D-M_H-zP.js";const se=t=>{w.$baseMessage(`${t} 已复制到粘贴板`,"success","hey")},ae=t=>{w.$baseMessage(`${t} 拷贝失败`,"error","hey")},re=t=>{const{isSupported:n,copy:i}=Z({legacy:!0});n||z("clipboard-write"),i(t).then(()=>{se(t)}).catch(()=>{ae(t)})},le={class:"login-form"},ne=["src"],ie=C({name:"Install",__name:"Install",setup(t){const n=ee(),i=Q(),S=G(),{title:ce}=J(S),a=d(!1),I=d(void 0),p=d(null),r=h({code:_.get("_DASHBOARD_INSTALL_KEY_")||""}),R=h({code:[{required:!0,trigger:"blur",message:"安装秘钥不能为空"}]}),g=async()=>{const{data:s}=await f.get("/install_check",{timeout:12e4});parseInt(s)===1?(a.value=!1,te("面板登陆密码已复制到粘贴板,可以直接完成登录","安装完成",()=>{i.push({path:"/login",replace:!0}).then(()=>{})})):setTimeout(()=>{g()},1e3)},$=async()=>{p.value&&p.value.validate(async s=>{if(s)try{a.value=!0;const{data:e}=await f.post("/install",{key:r.code}).finally(()=>{a.value=!1});re(e.password),_.set("_PASSWORD_",e.password),_.set("_DASHBOARD_INSTALL_KEY_",r.code),a.value=!0,await g()}finally{}})};return L(async()=>{const{data:s}=await f.get("/install_check",{timeout:12e4});parseInt(s)===1&&i.push({path:"/login",replace:!0}).then(()=>{})}),M(()=>{I.value=n.query&&n.query.redirect||"/"}),X((s,e,u)=>{u()}),(s,e)=>{const u=N("vab-icon"),k=K,A=H,B=P,D=F,E=x,T=q("throttle");return b(),v(E,null,{default:l(()=>[m("div",le,[m("img",{alt:"",class:"left-img",src:o(W)},null,8,ne),c(D,{ref_key:"formRef",ref:p,"label-position":"left",model:o(r),rules:o(R),onSubmit:e[1]||(e[1]=O(()=>{},["prevent"]))},{default:l(()=>[e[2]||(e[2]=m("div",{class:"title-tips"},"应用安装",-1)),c(A,{prop:"code"},{default:l(()=>[c(k,{ref:"passwordRef",modelValue:o(r).code,"onUpdate:modelValue":e[0]||(e[0]=V=>o(r).code=V),modelModifiers:{trim:!0},clearable:"",placeholder:o(y)("输入安装秘钥"),"show-password":"",type:"textarea",autocomplete:"off",rows:10},{prefix:l(()=>[c(u,{icon:"lock-line"})]),_:1},8,["modelValue","placeholder"])]),_:1}),Y((b(),v(B,{class:"login-btn",loading:o(a),type:"primary"},{default:l(()=>[U(j(o(y)("安装")),1)]),_:1},8,["loading"])),[[T,$]])]),_:1},8,["model","rules"])])]),_:1})}}}),ve=oe(ie,[["__scopeId","data-v-36e55af9"]]);export{ve as default};
