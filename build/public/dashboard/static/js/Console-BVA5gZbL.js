/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-09-26 13:22:32 
 */
import{d as $,r as _,c as j,w as N,k as L,C as z,N as Q,R as W,a as A,o as l,b as B,Z as v,ac as S,T as m,bl as X,a2 as V,ap as H,S as f,bm as Y,X as Z,bh as G,bi as J,at as K,aD as P,Y as R,bj as ee,ad as te}from"./vsv-element-plus-Cu8LirE2.js";import{_ as oe}from"./index-CscBtGc8.js";import"./vsv-icon-DxrXNnxK.js";import"./vsv-nprogress-D-M_H-zP.js";const ne={class:"drawer-header"},le={class:"drawer-title"},ae=20,se=$({name:"Console",__name:"Console",props:{logs:{type:Array,default:()=>[]},nodes:{type:Array,default:()=>[]}},emits:["clear"],setup(k,{emit:O}){const g=k,d=_(""),u=j(()=>d.value?(g.logs||[]).filter(e=>(e.node||"master")===d.value):g.logs),D=O,i=_(null),p=_(!0),y=_(u.value?u.value.length:0),a=_(0),F=()=>{D("clear")};function I(e){return e.scrollHeight-e.scrollTop-e.clientHeight<=ae}function h(e,t=300){const s=e.scrollTop,r=e.scrollHeight,c=r-s;if(c<=0||t<=0){e.scrollTop=r;return}const w=performance.now(),x=n=>n<.5?2*n*n:-1+(4-2*n)*n;function b(n){const T=Math.min((n-w)/t,1),C=x(T);e.scrollTop=s+c*C,T<1&&requestAnimationFrame(b)}requestAnimationFrame(b)}function q(){const e=i.value;e&&(h(e,300),p.value=!0,a.value=0)}function M(){const e=i.value;e&&(p.value=I(e),p.value&&(a.value=0))}const U=N(u,async e=>{await L();const t=i.value;if(!t)return;const s=Array.isArray(e)?e.length:0,r=y.value||0,c=s-r;c>0&&(p.value?(h(t,300),a.value=0):a.value+=c),y.value=s},{deep:!0});return N(d,()=>{y.value=u.value?u.value.length:0,a.value=0,p.value=!0,L(()=>{const e=i.value;e&&h(e,300)})}),z(async()=>{await L();const e=i.value;e&&(h(e,300),y.value=Array.isArray(g.logs)?g.logs.length:0)}),Q(()=>{U()}),(e,t)=>{const s=W("vab-icon"),r=X,c=Y,w=G,x=P,b=K,n=J,T=ee,C=te;return l(),A(V,null,[B("div",ne,[B("h4",le,[t[1]||(t[1]=S(" 控制台日志 ")),v(s,{icon:"delete-bin-line",onClick:F})]),v(c,{class:"drawer-filter",placeholder:"所有节点",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),clearable:"",style:{width:"200px"}},{default:m(()=>[v(r,{label:"全部节点",value:""}),(l(!0),A(V,null,H(k.nodes,(o,E)=>(l(),f(r,{key:E,label:o.role==="master"?"主节点":o.ip,value:o.role==="master"?"master":o.ip},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),B("div",{ref_key:"containerRef",ref:i,style:{"padding-bottom":"10px","max-height":"calc(100vh - 90px)","overflow-y":"auto","overflow-x":"hidden",position:"relative"},onScroll:M},[k.logs.length?(l(),f(T,{key:1},{default:m(()=>[(l(!0),A(V,null,H(u.value,(o,E)=>(l(),f(n,{placement:"top",timestamp:`${o.time}@${o.node||"master"}`,key:E},{default:m(()=>[v(b,null,{default:m(()=>[v(x,null,{default:m(()=>[S(R(o.message.data),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(l(),f(w,{key:0,"image-size":150,description:"暂无日志"})),a.value>0?(l(),f(C,{key:2,class:"scroll-bottom-btn",type:"primary",onClick:q},{default:m(()=>[S(R(a.value)+" 条新日志，回到底部 ",1)]),_:1})):Z("",!0)],544)],64)}}}),me=oe(se,[["__scopeId","data-v-5b87047c"]]);export{me as default};
