/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-09-23 14:06:32 
 */
import{$ as y}from"./http-DMu5tCsW.js";import{d as N,r,ab as A,S as u,o as _,T as a,b as m,Z as s,aQ as D,u as o,aR as I,ac as f,Y as d,ar as M,aI as Q,ad as R,bk as S,i as z,Q as L}from"./vsv-element-plus-Cu8LirE2.js";import{k as O,p as P,l as U,_ as Y}from"./index-CuTV6r9-.js";import"./vsv-icon-DxrXNnxK.js";import"./vsv-nprogress-D-M_H-zP.js";const Z={style:{"padding-bottom":"20px","max-height":"calc(100vh - 320px)","overflow-y":"auto","overflow-x":"hidden"}},q={class:"remark-ellipsis"},F=N({name:"AppVersions",__name:"AppVersions",props:{current:{type:Object,default:{app:"0.0.0",public:"0.0.0"}}},emits:["updated"],setup(g,{expose:h,emit:k}){const v=g,c=r(!1),n=r(!1),x=k,b=r([]),t=r({type:"",version:""}),V=async l=>{c.value=!0,t.value.type=l,await $()},$=async()=>{n.value=!0;const{data:l}=await y.get("/versions",{type:t.value.type},10*1e3).finally(()=>{n.value=!1});b.value=l},w=async l=>{O(`确定要更新所有节点的 ${t.value.type} 版本为 ${l} 吗？`,"操作确认",async()=>{t.value.version=l,n.value=!0;const{data:p}=await y.post("/update",P(t.value),1e3*310).finally(()=>{n.value=!1});U(`${p}个节点更新完毕`,"success","hey"),c.value=!1,x("updated")})};return h({show:V}),A(async()=>{}),(l,p)=>{const i=I,C=M,E=Q,B=R,T=D,j=L;return _(),u(j,{modelValue:o(c),"onUpdate:modelValue":p[0]||(p[0]=e=>z(c)?c.value=e:null),"append-to-body":"",draggable:"",title:"版本管理",width:"1100","close-on-click-modal":!1,"destroy-on-close":!0,"close-on-press-escape":!1,top:"10vh"},{default:a(()=>[m("div",Z,[s(T,{data:o(b),"v-loading":o(n)},{default:a(()=>[s(i,{prop:"version",label:"版本号",width:"100"}),s(i,{prop:"release_date",label:"发布时间",width:"200"},{default:a(({row:e})=>[f(d(e.release_date),1)]),_:1}),s(i,{prop:"file",label:"文件"},{default:a(({row:e})=>[f(d(o(t).type==="app"?e.app_object||"--":e.public_object||"--"),1)]),_:1}),s(i,{prop:"remark",label:"说明",width:"160"},{default:a(({row:e})=>[s(C,{trigger:"hover",placement:"top"},{reference:a(()=>[m("span",q,d(e.remark),1)]),default:a(()=>[m("div",null,d(e.remark),1)]),_:2},1024)]),_:1}),s(i,{label:"操作",align:"center",width:"100"},{default:a(({row:e})=>[o(t).type==="app"&&v.current.app===e.version||o(t).type==="public"&&v.current.public===e.version?(_(),u(E,{key:0,type:"success"},{default:a(()=>p[1]||(p[1]=[f("当前版本")])),_:1})):(_(),u(B,{key:1,size:"small",icon:o(S),onClick:G=>w(e.version),loading:o(n)},null,8,["icon","onClick","loading"]))]),_:1})]),_:1},8,["data","v-loading"])])]),_:1},8,["modelValue"])}}}),ee=Y(F,[["__scopeId","data-v-836f9071"]]);export{ee as default};
