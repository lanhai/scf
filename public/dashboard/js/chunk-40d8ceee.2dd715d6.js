(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40d8ceee"],{"78ce":function(e,t,a){var s=a("5ca1");s(s.S,"Date",{now:function(){return(new Date).getTime()}})},a829:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"padding-left":"10px"},attrs:{slot:"title"},slot:"title"},[a("el-select",{attrs:{placeholder:"任务"},on:{change:e.displayTask},model:{value:e.selectedTaskIndex,callback:function(t){e.selectedTaskIndex=t},expression:"selectedTaskIndex"}},e._l(e.tasks,(function(e,t){return a("el-option",{key:e.namespace,attrs:{label:e.name,value:t}})})),1),a("i",{staticClass:"ml-5 c-blue cursor-pointer",class:{"el-icon-refresh":!e.isLoading,"el-icon-loading":e.isLoading},on:{click:e.load}})],1),e.selectedTask.namespace?a("div",{staticClass:"block pd-10"},[a("el-descriptions",{staticClass:"margin-top",attrs:{direction:"vertical",title:"",column:15,border:""}},[a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-c-scale-to-original"}),e._v("\n                    脚本\n                ")]),a("span",[e._v(e._s(e.selectedTask.namespace))])],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-time"}),e._v("\n                    创建时间\n                ")]),e._v("\n                "+e._s(e._f("HumanizedTime")(e.selectedTask.created))+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-attract"}),e._v("\n                    运行模式\n                ")]),e._v("\n                "+e._s(e._f("statusTransfer")(e.selectedTask.mode,"task_run_mode"))+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-time"}),e._v("\n                    运行时间\n                ")]),e._v("\n                "+e._s(1===e.selectedTask.mode||3===e.selectedTask.mode?"每"+e.selectedTask.interval_humanize:2===e.selectedTask.mode?e.selectedTask.override?e.selectedTask.override.times.join(","):e.selectedTask.times.join(","):"单次执行")+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-check"}),e._v("\n                    运行次数\n                ")]),e._v("\n                "+e._s(e.selectedTask.run_count)+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-time"}),e._v("\n                    最近运行\n                ")]),e._v("\n                "+e._s(e.selectedTask.last_run||"--")+"\n            ")],2),a("el-descriptions-item",{attrs:{contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-time"}),e._v("\n                    下次运行\n                ")]),e._v("\n                "+e._s(e._f("HumanizedTime")(e.selectedTask.next_run))+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-alarm-clock"}),e._v("\n                    计时器\n                ")]),e._v("\n                "+e._s(e.selectedTask.ticker||"--")+"\n            ")],2),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-magic-stick"}),e._v("\n                    任务\n                ")]),a("el-tag",{attrs:{type:1===e.selectedTask.real_status?"success":"info"}},[e._v(e._s(1===e.selectedTask.real_status?"启用":"停用"))])],2),1===e.selectedTask.real_status?a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-s-unfold"}),e._v("\n                    状态\n                ")]),a("el-tag",{attrs:{type:1===e.selectedTask.is_busy?"warning":"success"}},[e._v(e._s(1===e.selectedTask.is_busy?"正在执行":"准备就绪"))])],2):e._e(),a("el-descriptions-item",{attrs:{labelStyle:{"text-align":"center"},contentStyle:{"text-align":"center"}}},[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-menu"}),e._v("\n                    操作\n                ")]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"立即执行此任务一次,此操作不会重置下一次自动运行的时间",placement:"top"}},[a("el-button",{attrs:{icon:"el-icon-video-play",size:"mini",disabled:0!==e.selectedTask.is_busy},on:{click:e.run}})],1),a("el-button",{attrs:{icon:"el-icon-setting",size:"mini"},on:{click:e.editTask}})],2)],1),a("div",{staticClass:"pt-20 pb-20"},[a("el-date-picker",{staticClass:"fr",attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",editable:!1,clearable:!1,"picker-options":e.pickerOptions,placeholder:"选择日期"},on:{change:function(t){return e.changeDay()}},model:{value:e.searchParams.day,callback:function(t){e.$set(e.searchParams,"day",t)},expression:"searchParams.day"}})],1),a("el-divider"),e.logs.length?e._e():a("el-empty",{attrs:{"image-size":150,description:"暂无运行日志"}}),e.logs.length?a("el-timeline",e._l(e.logs,(function(t,s){return a("el-timeline-item",{key:s,attrs:{placement:"top",timestamp:t.date}},[a("el-card",[a("p",{staticStyle:{"margin-top":"5px","word-break":"break-all"}},[e._v(e._s(t.message))])])],1)})),1):e._e()],1):e._e(),e.logs.length?a("el-pagination",{attrs:{background:"","current-page":e.searchParams.page,"page-sizes":[6,20,50,100],"page-size":e.searchParams.size,layout:"total,sizes, prev, pager, next",total:e.searchParams.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.searchParams,"page",t)},"update:current-page":function(t){return e.$set(e.searchParams,"page",t)}}}):e._e(),a("el-dialog",{attrs:{title:"任务设置",visible:e.dialogVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.crontabConfig,"status-icon":"","label-width":"120px"}},[a("el-form-item",{attrs:{label:"任务脚本：",prop:"namespace"}},[e._v("\n                "+e._s(e.crontabConfig.namespace)+"\n            ")]),a("el-form-item",{attrs:{label:"任务名称：",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{type:"text",placeholder:"任务名称"},model:{value:e.crontabConfig.name,callback:function(t){e.$set(e.crontabConfig,"name",t)},expression:"crontabConfig.name"}})],1)],1),a("el-form-item",{attrs:{label:"执行方式：",prop:"mode"}},[a("el-col",{attrs:{span:24}},[a("el-radio-group",{model:{value:e.crontabConfig.mode,callback:function(t){e.$set(e.crontabConfig,"mode",t)},expression:"crontabConfig.mode"}},[a("el-radio",{attrs:{label:1}},[e._v("循环执行"+e._s(1===e.selectedTask.mode?"(默认)":""))]),a("el-radio",{attrs:{label:3}},[e._v("定时循环"+e._s(3===e.selectedTask.mode?"(默认)":""))]),a("el-radio",{attrs:{label:2}},[e._v("定时执行"+e._s(2===e.selectedTask.mode?"(默认)":""))])],1)],1)],1),2===e.crontabConfig.mode?a("el-form-item",{attrs:{label:"执行时间：",prop:"times"}},[a("el-col",{attrs:{span:24}},e._l(e.selectedTask.times,(function(t,s){return a("el-tag",{key:s,class:{"ml-5":0!==s}},[e._v(e._s(t))])})),1),a("el-col",{attrs:{span:24}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",size:"medium",placeholder:"执行时间"},model:{value:e.crontabConfig.times,callback:function(t){e.$set(e.crontabConfig,"times",t)},expression:"crontabConfig.times"}},e._l(e.timesOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):a("el-form-item",{attrs:{label:"间隔时间：",prop:"interval"}},[a("el-col",{attrs:{span:15}},[a("el-input",{attrs:{type:"number",placeholder:"单位:秒"},model:{value:e.crontabConfig.interval,callback:function(t){e.$set(e.crontabConfig,"interval",t)},expression:"crontabConfig.interval"}},[a("template",{slot:"append"},[e._v("秒")])],2),e._v("\n                    默认:"),a("b",[e._v(e._s(e.selectedTask.interval))]),e._v("秒\n                ")],1)],1),a("el-form-item",{attrs:{label:"任务状态：",prop:"status"}},[a("el-radio-group",{model:{value:e.crontabConfig.status,callback:function(t){e.$set(e.crontabConfig,"status",t)},expression:"crontabConfig.status"}},[a("el-radio",{attrs:{label:1}},[e._v("开启")]),a("el-radio",{attrs:{label:0}},[e._v("关闭")])],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:function(t){return e.saveTask()}}},[e._v("保 存")])],1)],1)],1)},i=[],n=(a("7f7f"),a("78ce"),a("c1df")),l=a.n(n),o={name:"Crontab",data:function(){return{isPageActivation:!1,refreshTimer:null,dialogVisible:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},isLoading:!1,selectedTaskIndex:"",tasks:[],selectedTask:{override:{}},params:{},searchParams:{keyword:"",page:1,count:1,size:6,type:"",day:l()().format("YYYY-MM-DD")},logs:[],timesOptions:[{value:"00:00",label:"00:00"},{value:"01:00",label:"01:00"},{value:"06:00",label:"06:00"},{value:"08:00",label:"08:00"},{value:"12:00",label:"12:00"},{value:"16:00",label:"16:00"},{value:"18:00",label:"18:00"},{value:"20:00",label:"20:00"},{value:"22:00",label:"22:00"},{value:"23:00",label:"23:00"}],crontabConfig:{}}},mounted:function(){this.load()},methods:{editTask:function(){this.dialogVisible=!0,this.crontabConfig=this.selectedTask.override||{name:this.selectedTask.name,namespace:this.selectedTask.namespace,mode:this.selectedTask.mode,interval:this.selectedTask.interval||0,times:this.selectedTask.times||[],status:1}},saveTask:function(){var e=this;this.isLoading=!0,this.$request.post("/crontab_override",this.$copy(this.crontabConfig)).then((function(t){t.errCode?(e.$message.error(t.message),e.isLoading=!1):(e.$message.success("配置已更新"),e.dialogVisible=!1)})).catch((function(t){e.$message.error(t)})).then((function(){e.isLoading=!1}))},changeDay:function(){this.searchParams.page=1,this.logs=[],this.getLogs()},getLogs:function(){var e=this;this.isLoading=!0,this.$request.get("/logs",this.searchParams).then((function(t){t.errCode?e.$message.error(t.message):(e.logs=t.data.list,e.searchParams.count=t.data.total)})).catch((function(t){e.$message.error(t)})).finally((function(){e.isLoading=!1}))},handleSizeChange:function(e){this.searchParams.size=e,this.getLogs()},handleCurrentChange:function(e){this.searchParams.page=e,this.getLogs()},load:function(){var e=this;this.isLoading=!0,this.$request.get("/crontabs",this.$copy(this.params)).then((function(t){if(t.errCode)e.$message.error(t.message),e.isLoading=!1;else{if(e.tasks=t.data,!e.tasks.length)return;""===e.selectedTaskIndex&&(e.selectedTaskIndex=0),e.displayTask()}})).catch((function(t){e.$message.error(t)})).then((function(){setTimeout((function(){e.isLoading=!1}),500)}))},displayTask:function(){var e=this;this.selectedTask=this.tasks[this.selectedTaskIndex],this.searchParams.page=1,this.searchParams.day=l()().format("YYYY-MM-DD"),this.searchParams.type=this.selectedTask.namespace,this.getLogs(),this.isPageActivation=!0,this.refreshTimer=window.setTimeout((function(){e.refresh()}),1e3)},run:function(){var e=this;this.isLoading=!0,this.$request.post("/crontab_run",{name:this.selectedTask.namespace}).then((function(t){t.errCode||e.$message.success("已请求立即执行"),setTimeout((function(){e.getLogs()}),3e3)})).finally((function(){e.isLoading=!1}))},refresh:function(){var e=this;clearTimeout(this.refreshTimer),this.selectedTask.namespace&&this.isPageActivation&&this.$request.post("/crontab_status",{name:this.selectedTask.namespace}).then((function(t){t.errCode||(e.selectedTask=t.data)})).finally((function(){e.isPageActivation&&(e.refreshTimer=window.setTimeout((function(){e.refresh()}),1e3))}))}},beforeDestroy:function(){window.clearTimeout(this.refreshTimer),this.refreshTimer=null,this.isPageActivation=!1},destroyed:function(){window.clearTimeout(this.refreshTimer),this.refreshTimer=null,this.isPageActivation=!1}},r=o,c=a("2877"),d=Object(c["a"])(r,s,i,!1,null,"761b8322",null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-40d8ceee.2dd715d6.js.map